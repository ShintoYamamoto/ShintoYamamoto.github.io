/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={23:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(249);class i extends r.Narve.Component{constructor(){super(),this.createBtn=(0,r.nr)("button",{},"新規作成"),this.children.set(this.createBtn),this.createBtn.elem.onclick=()=>{const e=prompt("試合名を入力");e&&this.onCreate(e)}}onCreate(e){}}t.default=i},24:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(249),s=n(929),o=n(449);class a extends i.Narve.Component{constructor(){super()}openWithId(e){return r(this,void 0,void 0,(function*(){const t=yield(0,s.getContents)(e);if(null!==t)try{const e=JSON.parse(t);(0,o.isUploadType)(e)}catch(e){}}))}}t.default=a},38:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=[];var r;t.LogLevel=void 0,(r=t.LogLevel||(t.LogLevel={}))[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT";const i={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},s=t.LogLevel.INFO,o={[t.LogLevel.DEBUG]:"log",[t.LogLevel.VERBOSE]:"log",[t.LogLevel.INFO]:"info",[t.LogLevel.WARN]:"warn",[t.LogLevel.ERROR]:"error"},a=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=o[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};t.Logger=class{constructor(e){this.name=e,this._logLevel=s,this._logHandler=a,this._userLogHandler=null,n.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in t.LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.DEBUG,...e),this._logHandler(this,t.LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.VERBOSE,...e),this._logHandler(this,t.LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.INFO,...e),this._logHandler(this,t.LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.WARN,...e),this._logHandler(this,t.LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,t.LogLevel.ERROR,...e),this._logHandler(this,t.LogLevel.ERROR,...e)}},t.setLogLevel=function(e){n.forEach((t=>{t.setLogLevel(e)}))},t.setUserLogHandler=function(e,r){for(const s of n){let n=null;r&&r.level&&(n=i[r.level]),s.userLogHandler=null===e?null:(r,i,...s)=>{const o=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");i>=(null!=n?n:r.logLevel)&&e({level:t.LogLevel[i].toLowerCase(),message:o,args:s,type:r.name})}}}},55:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultsFromPostinstall=()=>{}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var c=e[a],u=r.base?c[0]+r.base:c[0],l=s[u]||0,h="".concat(u," ").concat(l);s[u]=l+1;var d=n(h),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var p=i(f,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var c=r(e,i),u=0;u<s.length;u++){var l=n(s[u]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}s=c}}},95:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(347),i=n.n(r),s=n(628),o=n.n(s)()(i());o.push([e.id,"#player {\n    width: 80vw;\n    height: 100vh;\n}\n@media screen and (max-width: 1024px) and (orientation: landscape) {\n    #player {\n        width: 70vw;\n        height: 100vh;\n    }\n}",""]);const a=o},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},159:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(72),i=n.n(r),s=n(825),o=n.n(s),a=n(659),c=n.n(a),u=n(56),l=n.n(u),h=n(540),d=n.n(h),f=n(113),p=n.n(f),g=n(829),m={};m.styleTagTransform=p(),m.setAttributes=l(),m.insert=c().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=d(),i()(g.A,m);const y=g.A&&g.A.locals?g.A.locals:void 0},193:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(906);const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.Deferred;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return r(this,void 0,void 0,(function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}))}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}t.Component=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}},t.ComponentContainer=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}},t.Provider=o},195:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};function r(){return new Promise((e=>{const t=()=>{window.YT&&window.YT.Player?e():setTimeout(t,100)};t()}))}Object.defineProperty(t,"__esModule",{value:!0}),t.waitForYouTubeAPI=r,t.createYouTubePlayer=function(e,t,i){return n(this,void 0,void 0,(function*(){return yield r(),new Promise(((n,r)=>{if(!window.YT)return void r(new Error("YouTube APIがロードされていません"));const s=new window.YT.Player(e,{width:640,height:360,videoId:t,events:{onReady:()=>{null==i||i(),n(s)}}})}))}))}},249:function(e,t){var n,r,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function o(e,t){void 0===e&&(e="div");var n=document.createElement(e);return t&&Object.entries(t).forEach((function(e){var t=e[0],r=e[1];n.setAttribute(t,r)})),n}function a(e){var n;try{n=u(e.elem.cloneNode(!0))}catch(e){return console.warn("couldn't deepClone"),(0,t.nr)()}return n}function c(e){var t=new r.Component;return t.querySelector(e),t}function u(e){var t=new r.Component;if(t.elem=e,0===e.children.length)return t;for(var n=new Array,i=0;i<e.children.length;i++)n.push(u(e.children[i]));return t.children=new(l.bind.apply(l,s([void 0,t],n,!1))),t}Object.defineProperty(t,"__esModule",{value:!0}),t.Narve=t.nr=void 0,t.htmlToComponent=u,t.nr=function(e,t){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return new((n=r.Component).bind.apply(n,s([void 0,e,t],i,!1)))},function(e){e.q=c;var t=function(){function t(t,n){for(var r,i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];this.children=new l(this),this.elem=o(t,n||{}),i.every((function(t){return t instanceof e.Component}))?(r=this.children).set.apply(r,i):this.setInnerText(i.join(""))}return t.prototype.querySelector=function(e){var t=document.querySelector(e);return null===t?null:(this.elem=t||o("div"),this.children=u(this.elem).children,this)},t.prototype.replaceWith=function(e){e instanceof t?(this.elem.replaceWith(e.elem),this.elem=e.elem,this.children=e.children):(this.elem.replaceWith(e),this.elem=e,this.children=u(e).children)},t.prototype.removeChild=function(e){var t=this.children.findIndex((function(t){return t.elem===e.elem}));-1!==t&&this.children.delete(t,1)},t.prototype.removeElem=function(){this.elem.remove()},t.prototype.setInnerText=function(e){this.children=new l(this),this.elem.innerText=e},t.prototype.switchFocus=function(e,t){void 0===t&&(t="block"),this.children.forEach((function(e){return e.hide()})),e.display()},t.prototype.display=function(e){void 0===e&&(e="block"),this.elem.style.display=e},t.prototype.hide=function(){this.elem.style.display="none"},t}();e.Component=t}(r||(t.Narve=r={}));var l=function(e){function t(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=e.call(this)||this;return Object.setPrototypeOf(s,t.prototype),s.parent=n,r.forEach((function(e,t){s[t]=e})),s}return i(t,e),t.prototype.copyWithin=function(e,t,n){if(e=this.__REG_START__(e),t=this.__REG_START__(t),n=this.__REG_END__(n),t>=this.length)return this;if(n<=t)return this;if(e===t)return this;if(e<t)for(var r=0;r<n-t&&!(r+t>=this.length)&&!(r+e>=this.length);r++)this.replace(r+e,this[r+t]);else for(r=n-t-1;r>=0;r--)r+t>=this.length||r+e>=this.length||this.replace(r+e,this[r+t]);return this},t.prototype.fill=function(e,t,n){if(t=this.__REG_START__(t),n=this.__REG_END__(n),t>=this.length||n<=t)return this;for(var r=t;r<n;r++)this.replace(r,e);return this},t.prototype.pop=function(){var t=e.prototype.pop.call(this);if(void 0!==t)return t.removeElem(),t},t.prototype.push=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.prototype.push.apply(this,n),n.forEach((function(e){t.parent.elem.insertAdjacentElement("beforeend",e.elem)})),this.length},t.prototype.reverse=function(){for(var e=0,t=this.length-1;t-e>0;){var n=a(this[e]);this.replace(e,a(this[t])),this.replace(t,n),e++,t--}return this},t.prototype.shift=function(){var t=e.prototype.shift.call(this);if(void 0!==t)return t.removeElem(),t},t.prototype.sort=function(e){var t=this,n=s([],this.map((function(e){return a(e)})),!0);return h(n,e),n.forEach((function(e,n){return t.replace(n,e)})),this},t.prototype.splice=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.delete(e,t),this.insert.apply(this,s([e],n,!1)),this},t.prototype.unshift=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(e){return t.parent.elem.insertAdjacentElement("afterbegin",e.elem)})),e.prototype.unshift.apply(this,n),this.length},t.prototype.replace=function(e,t){(e=this.__REG_START__(e))>=this.length&&(e=this.length-1),this[e].replaceWith(t.elem.isConnected?a(t):t)},t.prototype.delete=function(t,n){if((t=this.__REG_START__(t))>=this.length)return[];void 0===n&&(n=this.length-t);var r=e.prototype.splice.call(this,t,n);return r.forEach((function(e){return e.removeElem()})),r},t.prototype.insert=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if((t=this.__REG_START__(t))>=this.length)return console.warn('The value of index is too large. "insert" is regarded as "append"'),void this.push.apply(this,n);var i=this[t].elem;return n.forEach((function(e){i.before(e.elem)})),e.prototype.splice.apply(this,s([t,0],n,!1)),this},t.prototype.set=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.delete(0),this.push.apply(this,e)},t.prototype.map=function(e){var t=Array();return this.forEach((function(n,r,i){t.push(e(n,r,i))})),t},t.prototype.__REG_START__=function(e){return void 0===e&&(e=0),e<0&&(e+=this.length),e<0&&(e=0),e},t.prototype.__REG_END__=function(e){return(void 0===e||e>=this.length)&&(e=this.length),e<0&&(e+=this.length),e<0&&(e=0),e},t}(Array);function h(e,t,n,r){var i;if(void 0===t&&(t=function(e,t){var n=JSON.stringify(e),r=JSON.stringify(t);return n>r?1:n<r?-1:0}),void 0===n&&(n=0),void 0===r&&(r=e.length-1),!(r<0||r>=e.length||n<0||n>=e.length||n>r)){for(var s=e[Math.floor((n+r)/2)],o=n,a=r;;){for(;t(e[o],s)<0;)o++;for(;t(e[a],s)>0;)a--;if(o<=a&&(i=[e[a],e[o]],e[o]=i[0],e[a]=i[1],o++,a--),o>a)break}return n<a&&h(e,t,n,a),o<r&&h(e,t,o,r),e}}},254:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(72),i=n.n(r),s=n(825),o=n.n(s),a=n(659),c=n.n(a),u=n(56),l=n.n(u),h=n(540),d=n.n(h),f=n(113),p=n.n(f),g=n(95),m={};m.styleTagTransform=p(),m.setAttributes=l(),m.insert=c().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=d(),i()(g.A,m);const y=g.A&&g.A.locals?g.A.locals:void 0},330:(e,t,n)=>{(function(){var t;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(n,(function(){this.blockSize=-1})),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},n.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s={};function o(e){return-128<=e&&128>e?function(e){var t=s;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new i([0|e],0>e?-1:0)}(e)}(e):new i([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return f(a(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new i(t,0)}var c=o(0),u=o(1),l=o(16777216);function h(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function f(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(u)}function p(e,t){return e.add(f(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function y(e,t){if(h(t))throw Error("division by zero");if(h(e))return new m(c,c);if(d(e))return t=y(f(e),t),new m(f(t.g),f(t.h));if(d(t))return t=y(e,f(t)),new m(f(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=v(n),r=v(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!h(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=w(r,1),n=w(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=a(n)).j(t);d(o)||0<o.l(e);)o=(s=a(n-=r)).j(t);h(s)&&(s=u),i=i.add(s),e=p(e,o)}return new m(i,e)}function v(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],o=0;o<r;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new i(s,e.h)}(t=i.prototype).m=function(){if(d(this))return-f(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},t.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(h(this))return"0";if(d(this))return"-"+f(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,r="";;){var i=y(n,t).g,s=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(h(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},t.l=function(e){return d(e=p(this,e))?-1:h(e)?0:1},t.abs=function(){return d(this)?f(this):this},t.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var o=r+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new i(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(e){if(h(this)||h(e))return c;if(d(this))return d(e)?f(this).j(f(e)):f(f(this).j(e));if(d(e))return f(this.j(f(e)));if(0>this.l(l)&&0>e.l(l))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var o=this.i(r)>>>16,u=65535&this.i(r),p=e.i(s)>>>16,m=65535&e.i(s);n[2*r+2*s]+=u*m,g(n,2*r+2*s),n[2*r+2*s+1]+=o*m,g(n,2*r+2*s+1),n[2*r+2*s+1]+=u*p,g(n,2*r+2*s+1),n[2*r+2*s+2]+=o*p,g(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},t.A=function(e){return y(this,e).h},t.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},t.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},t.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,e.exports.Md5=n,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=a,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return f(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=a(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+o),n);8>o?(o=a(Math.pow(n,o)),i=i.j(o).add(a(u))):i=(i=i.j(r)).add(a(u))}return i},e.exports.Integer=i}).apply(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},347:e=>{e.exports=function(e){return e[1]}},362:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(347),i=n.n(r),s=n(628),o=n.n(s)()(i());o.push([e.id,"main {\n    display: flex;\n}",""]);const a=o},365:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(347),i=n.n(r),s=n(628),o=n.n(s)()(i());o.push([e.id,":root {\n    font-family: Inter, Avenir, Helvetica, Arial, sans-serif;\n    font-size: 16px;\n    line-height: 24px;\n    font-weight: 400;\n  \n    color: #0f0f0f;\n    background-color: #f6f6f6;\n  \n    font-synthesis: none;\n    text-rendering: optimizeLegibility;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-text-size-adjust: 100%;\n  \n    color-scheme: light dark;\n}\nbody{\n    margin: 0px;\n    height: 100vh;\n}\n#app{\n    height: 100%;\n    padding: 0.5rem;\n    box-sizing: border-box;\n    & > .pages {\n        height: 100%;\n    }\n}\n\na {\n    font-weight: 500;\n    color: #646cff;\n    text-decoration: inherit;\n}\n  \na:hover {\n    color: #535bf2;\n}\n  \nh1 {\n    text-align: center;\n}\nul{\n    padding: 0px 0.5rem;\n}\nli {\n    list-style-type: none;\n    padding: 0.5rem 1rem;\n}\ninput,\ntextarea,\nbutton {\n    border-radius: 8px;\n    border: 1px solid transparent;\n    padding: 0.6em 1.2em;\n    font-size: 1em;\n    font-weight: 500;\n    font-family: inherit;\n    color: #0f0f0f;\n    background-color: #ffffff;\n    transition: border-color 0.25s;\n    box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);\n}\ntextarea {\n    box-shadow: 0 4px 4px rgba(0, 0, 0, 0.3);\n}\n  \nbutton {\n    cursor: pointer;\n}\n  \nbutton:hover {\n    border-color: #396cd8;\n}\nbutton:active {\n    border-color: #396cd8;\n    background-color: #e8e8e8;\n}\n  \ninput,\ntextarea,\nbutton {\n    outline: none;\n}\n  \n@media (prefers-color-scheme: dark) {\n    :root {\n        color: #f6f6f6;\n        background-color: #2f2f2f;\n    }\n  \n    a:hover {\n        color: #24c8db;\n    }\n  \n    input,\n    textarea,\n    button {\n        color: #ffffff;\n        background-color: #0f0f0f98;\n    }\n    button:active {\n        background-color: #0f0f0f69;\n    }\n}\n",""]);const a=o},374:(e,t,n)=>{(function(){var t,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))break e;n=n[o]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var s=s||{},o=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function c(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function u(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function h(e,t,n){return(h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?u:l).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function f(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function p(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(a(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function m(e){return/^[\s\xa0]*$/.test(e)}function y(){var e=o.navigator;return e&&(e=e.userAgent)?e:""}function v(e){return v[" "](e),e}v[" "]=function(){};var w=!(-1==y().indexOf("Gecko")||-1!=y().toLowerCase().indexOf("webkit")&&-1==y().indexOf("Edge")||-1!=y().indexOf("Trident")||-1!=y().indexOf("MSIE")||-1!=y().indexOf("Edge"));function b(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function _(e){const t={};for(const n in e)t[n]=e[n];return t}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<I.length;t++)n=I[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function T(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){o.setTimeout((()=>{throw e}),0)}function C(){var e=k;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var x=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new A),(e=>e.reset()));class A{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let D,N=!1,k=new class{constructor(){this.h=this.g=null}add(e,t){const n=x.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const e=o.Promise.resolve(void 0);D=()=>{e.then(M)}};var M=()=>{for(var e;e=C();){try{e.h.call(e.g)}catch(e){S(e)}var t=x;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}N=!1};function R(){this.s=this.s,this.C=this.C}function L(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},L.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function F(e,t){if(L.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(w){e:{try{v(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:V[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&F.aa.h.call(this)}}f(F,L);var V={2:"touch",3:"pen",4:"mouse"};F.prototype.h=function(){F.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var B="closure_listenable_"+(1e6*Math.random()|0),U=0;function q(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++U,this.da=this.fa=!1}function j(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(j(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function G(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}z.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=G(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new q(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),Q={};function H(e,t,n,r,i){if(r&&r.once)return J(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)H(e,t[s],n,r,i);return null}return n=re(n),e&&e[B]?e.K(t,n,c(r)?!!r.capture:!!r,i):W(e,t,n,!1,r,i)}function W(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=c(i)?!!i.capture:!!i,a=te(e);if(a||(e[K]=a=new z(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=ee;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)P||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Z(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function J(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)J(e,t[s],n,r,i);return null}return n=re(n),e&&e[B]?e.L(t,n,c(r)?!!r.capture:!!r,i):W(e,t,n,!0,r,i)}function Y(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Y(e,t[s],n,r,i);else r=c(r)?!!r.capture:!!r,n=re(n),e&&e[B]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=G(s=e.g[t],n,r,i))&&(j(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=te(e))&&(t=e.g[t.toString()],e=-1,t&&(e=G(t,n,r,i)),(n=-1<e?t[e]:null)&&X(n))}function X(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[B])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Z(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=te(t))?($(n,e),0==n.h&&(n.src=null,t[K]=null)):j(e)}}}function Z(e){return e in Q?Q[e]:Q[e]="on"+e}function ee(e,t){if(e.da)e=!0;else{t=new F(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&X(e),e=n.call(r,t)}return e}function te(e){return(e=e[K])instanceof z?e:null}var ne="__closure_events_fn_"+(1e9*Math.random()>>>0);function re(e){return"function"==typeof e?e:(e[ne]||(e[ne]=function(t){return e.handleEvent(t)}),e[ne])}function ie(){R.call(this),this.i=new z(this),this.M=this,this.F=null}function se(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new L(t,e);else if(t instanceof L)t.target=t.target||e;else{var i=t;E(t=new L(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=oe(o,r,!0,t)&&i}if(i=oe(o=t.g=e,r,!0,t)&&i,i=oe(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=oe(o=t.g=n[s],r,!1,t)&&i}function oe(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function ae(e,t,n){if("function"==typeof e)n&&(e=h(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=h(e.handleEvent,e)}return 2147483647<Number(t)?-1:o.setTimeout(e,t||0)}function ce(e){e.g=ae((()=>{e.g=null,e.i&&(e.i=!1,ce(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}f(ie,R),ie.prototype[B]=!0,ie.prototype.removeEventListener=function(e,t,n,r){Y(this,e,t,n,r)},ie.prototype.N=function(){if(ie.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)j(n[r]);delete t.g[e],t.h--}}this.F=null},ie.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ie.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ue extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ce(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function le(e){R.call(this),this.h=e,this.g={}}f(le,R);var he=[];function de(e){b(e.g,(function(e,t){this.g.hasOwnProperty(t)&&X(e)}),e),e.g={}}le.prototype.N=function(){le.aa.N.call(this),de(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=o.JSON.stringify,pe=o.JSON.parse,ge=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function me(){}function ye(e){return e.h||(e.h=e.i())}function ve(){}me.prototype.h=null;var we={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function be(){L.call(this,"d")}function _e(){L.call(this,"c")}f(be,L),f(_e,L);var Ie={},Ee=null;function Te(){return Ee=Ee||new ie}function Se(e){L.call(this,Ie.La,e)}function Ce(e){const t=Te();se(t,new Se(t,e))}function xe(e,t){L.call(this,Ie.STAT_EVENT,e),this.stat=t}function Ae(e){const t=Te();se(t,new xe(t,e))}function De(e,t){L.call(this,Ie.Ma,e),this.size=t}function Ne(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout((function(){e()}),t)}function ke(){this.g=!0}function Oe(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return fe(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Ie.La="serverreachability",f(Se,L),Ie.STAT_EVENT="statevent",f(xe,L),Ie.Ma="timingevent",f(De,L),ke.prototype.xa=function(){this.g=!1},ke.prototype.info=function(){};var Me,Re={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Le={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Pe(){}function Fe(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ve}function Ve(){this.i=null,this.g="",this.h=!1}f(Pe,me),Pe.prototype.g=function(){return new XMLHttpRequest},Pe.prototype.i=function(){return{}},Me=new Pe;var Be={},Ue={};function qe(e,t,n){e.L=1,e.v=ft(ct(t)),e.m=n,e.P=!0,je(e,null)}function je(e,t){e.F=Date.now(),Ge(e),e.A=ct(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),xt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ve,e.g=gn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ue(h(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(he[0]=i.toString()),i=he);for(var s=0;s<i.length;s++){var o=H(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?_(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ce(1),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function ze(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function $e(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ue:(n=Number(t.substring(n,r)),isNaN(n)?Be:(r+=1)+n>t.length?Ue:(t=t.slice(r,r+n),e.C=r+n,t))}function Ge(e){e.S=Date.now()+e.I,Ke(e,e.I)}function Ke(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ne(h(e.ba,e),t)}function Qe(e){e.B&&(o.clearTimeout(e.B),e.B=null)}function He(e){0==e.j.G||e.J||ln(e.j,e)}function We(e){Qe(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,de(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Je(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||tt(n.h,e)))if(!e.K&&tt(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;un(n),Xt(n)}on(n),Ae(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ne(h(n.Za,n),6e3));if(1>=et(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else dn(n,11)}else if((e.K||n.g==e)&&un(n),!m(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(nt(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,dt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=pn(r,r.J?r.ia:null,r.W),o.K){rt(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(Qe(a),Ge(a)),r.g=o}else sn(r);0<n.i.length&&en(n)}else"stop"!=u[0]&&"close"!=u[0]||dn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?dn(n,7):Yt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Ce(4)}catch(e){}}Fe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Qt(e)?t.j():this.Y(e)},Fe.prototype.Y=function(e){try{if(e==this.g)e:{const d=Qt(this.g);var t=this.g.Ba();const f=this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=d||7==t||Ce(8==t||0>=f?3:2),Qe(this);var n=this.g.Z();this.X=n;t:if(ze(this)){var r=Ht(this.g);e="";var i=r.length,s=4==Qt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){We(this),He(this);var a="";break t}this.h.i=new o.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ae(12),We(this),He(this);break e}Oe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Je(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=$e(this,a),e==Ue){4==d&&(this.s=4,Ae(14),n=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(e==Be){this.s=4,Ae(15),Oe(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Oe(this.i,this.l,e,null),Je(this,e)}if(ze(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ae(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),an(h),h.M=!0,Ae(11))}}else Oe(this.i,this.l,a,"[Invalid Chunked Response]"),We(this),He(this)}else Oe(this.i,this.l,a,null),Je(this,a);4==d&&We(this),this.o&&!this.J&&(4==d?ln(this.j,this):(this.o=!1,Ge(this)))}else(function(e){const t={};e=(e.g&&2<=Qt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(m(e[r]))continue;var n=T(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),We(this),He(this)}}}catch(e){}},Fe.prototype.cancel=function(){this.J=!0,We(this)},Fe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Ce(3),Ae(17)),We(this),this.s=2,He(this)):Ke(this,this.S-e)};var Ye=class{constructor(e,t){this.g=e,this.map=t}};function Xe(e){this.l=e||10,e=o.PerformanceNavigationTiming?0<(e=o.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ze(e){return!!e.h||!!e.g&&e.g.size>=e.j}function et(e){return e.h?1:e.g?e.g.size:0}function tt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function nt(e,t){e.g?e.g.add(t):e.h=t}function rt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function it(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return p(e.i)}function st(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(a(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}Xe.prototype.cancel=function(){if(this.i=it(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ot=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function at(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof at){this.h=e.h,ut(this,e.j),this.o=e.o,this.g=e.g,lt(this,e.s),this.l=e.l;var t=e.i,n=new Et;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ht(this,n),this.m=e.m}else e&&(t=String(e).match(ot))?(this.h=!1,ut(this,t[1]||"",!0),this.o=pt(t[2]||""),this.g=pt(t[3]||"",!0),lt(this,t[4]),this.l=pt(t[5]||"",!0),ht(this,t[6]||"",!0),this.m=pt(t[7]||"")):(this.h=!1,this.i=new Et(null,this.h))}function ct(e){return new at(e)}function ut(e,t,n){e.j=n?pt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function lt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ht(e,t,n){t instanceof Et?(e.i=t,function(e,t){t&&!e.j&&(Tt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(St(this,t),xt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=gt(t,_t)),e.i=new Et(t,e.h))}function dt(e,t,n){e.i.set(t,n)}function ft(e){return dt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function pt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function gt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,mt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function mt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}at.prototype.toString=function(){var e=[],t=this.j;t&&e.push(gt(t,vt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(gt(t,vt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(gt(n,"/"==n.charAt(0)?bt:wt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",gt(n,It)),e.join("")};var yt,vt=/[#\/\?@]/g,wt=/[#\?:]/g,bt=/[#\?]/g,_t=/[#\?@]/g,It=/#/g;function Et(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function St(e,t){Tt(e),t=At(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ct(e,t){return Tt(e),t=At(e,t),e.g.has(t)}function xt(e,t,n){St(e,t),0<n.length&&(e.i=null,e.g.set(At(e,t),p(n)),e.h+=n.length)}function At(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Dt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function Nt(){this.g=new ge}function kt(e,t,n){const r=n||"";try{st(e,(function(e,n){let i=e;c(e)&&(i=fe(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ot(e){this.l=e.Ub||null,this.j=e.eb||!1}function Mt(e,t){ie.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Rt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Lt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Pt(e)}function Pt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ft(e){let t="";return b(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Vt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Ft(n),"string"==typeof e?(encodeURIComponent(String(t)),null!=n&&encodeURIComponent(String(n))):dt(e,t,n))}function Bt(e){ie.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Et.prototype).add=function(e,t){Tt(this),this.i=null,e=At(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){Tt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},t.na=function(){Tt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},t.V=function(e){Tt(this);let t=[];if("string"==typeof e)Ct(this,e)&&(t=t.concat(this.g.get(At(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},t.set=function(e,t){return Tt(this),this.i=null,Ct(this,e=At(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},f(Ot,me),Ot.prototype.g=function(){return new Mt(this.l,this.j)},Ot.prototype.i=(yt={},function(){return yt}),f(Mt,ie),(t=Mt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Pt(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||o).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Lt(this)),this.readyState=0},t.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pt(this)),this.g&&(this.readyState=3,Pt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Rt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Lt(this):Pt(this),3==this.readyState&&Rt(this)}},t.Ra=function(e){this.g&&(this.response=this.responseText=e,Lt(this))},t.Qa=function(e){this.g&&(this.response=e,Lt(this))},t.ga=function(){this.g&&Lt(this)},t.setRequestHeader=function(e,t){this.u.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Mt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),f(Bt,ie);var Ut=/^https?$/i,qt=["POST","PUT"];function jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,zt(e),Gt(e)}function zt(e){e.A||(e.A=!0,se(e,"complete"),se(e,"error"))}function $t(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=Qt(e)||2!=e.Z()))if(e.u&&4==Qt(e))ae(e.Ea,0,e);else if(se(e,"readystatechange"),4==Qt(e)){e.h=!1;try{const s=e.Z();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){var i=String(e.D).match(ot)[1]||null;!i&&o.self&&o.self.location&&(i=o.self.location.protocol.slice(0,-1)),r=!Ut.test(i?i.toLowerCase():"")}n=r}if(n)se(e,"complete"),se(e,"success");else{e.m=6;try{var a=2<Qt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",zt(e)}}finally{Gt(e)}}}function Gt(e,t){if(e.g){Kt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||se(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Kt(e){e.I&&(o.clearTimeout(e.I),e.I=null)}function Qt(e){return e.g?e.g.readyState:0}function Ht(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Wt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Jt(e){this.Aa=0,this.i=[],this.j=new ke,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wt("baseRetryDelayMs",5e3,e),this.cb=Wt("retryDelaySeedMs",1e4,e),this.Wa=Wt("forwardChannelMaxRetries",2,e),this.wa=Wt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Xe(e&&e.concurrentRequestLimit),this.Da=new Nt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Yt(e){if(Zt(e),3==e.G){var t=e.U++,n=ct(e.I);if(dt(n,"SID",e.K),dt(n,"RID",t),dt(n,"TYPE","terminate"),nn(e,n),(t=new Fe(e,e.j,t)).L=2,t.v=ft(ct(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.v,n=!0),n||(t.g=gn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ge(t)}fn(e)}function Xt(e){e.g&&(an(e),e.g.cancel(),e.g=null)}function Zt(e){Xt(e),e.u&&(o.clearTimeout(e.u),e.u=null),un(e),e.h.cancel(),e.s&&("number"==typeof e.s&&o.clearTimeout(e.s),e.s=null)}function en(e){if(!Ze(e.h)&&!e.s){e.s=!0;var t=e.Ga;D||O(),N||(D(),N=!0),k.add(t,e),e.B=0}}function tn(e,t){var n;n=t?t.l:e.U++;const r=ct(e.I);dt(r,"SID",e.K),dt(r,"RID",n),dt(r,"AID",e.T),nn(e,r),e.m&&e.o&&Vt(r,e.m,e.o),n=new Fe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=rn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),nt(e.h,n),qe(n,r,t)}function nn(e,t){e.H&&b(e.H,(function(e,n){dt(t,n,e)})),e.l&&st({},(function(e,n){dt(t,n,e)}))}function rn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?h(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{kt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function sn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;D||O(),N||(D(),N=!0),k.add(t,e),e.v=0}}function on(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ne(h(e.Fa,e),hn(e,e.v)),e.v++,0))}function an(e){null!=e.A&&(o.clearTimeout(e.A),e.A=null)}function cn(e){e.g=new Fe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ct(e.qa);dt(t,"RID","rpc"),dt(t,"SID",e.K),dt(t,"AID",e.T),dt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&dt(t,"TO",e.ja),dt(t,"TYPE","xmlhttp"),nn(e,t),e.m&&e.o&&Vt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ft(ct(t)),n.m=null,n.P=!0,je(n,e)}function un(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function ln(e,t){var n=null;if(e.g==t){un(e),an(e),e.g=null;var r=2}else{if(!tt(e.h,t))return;n=t.D,rt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;se(r=Te(),new De(r,n,t,i)),en(e)}else sn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(et(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ne(h(e.Ga,e,t),hn(e,e.B)),e.B++,0)))}(e,t)||2==r&&on(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:dn(e,5);break;case 4:dn(e,10);break;case 3:dn(e,6);break;default:dn(e,2)}}function hn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function dn(e,t){if(e.j.info("Error code "+t),2==t){var n=h(e.fb,e),r=e.Xa;const t=!r;r=new at(r||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||ut(r,"https"),ft(r),t?function(e,t){const n=new ke;if(o.Image){const r=new Image;r.onload=d(Dt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=d(Dt,n,"TestLoadImage: error",!1,t,r),r.onabort=d(Dt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=d(Dt,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new ke;const n=new AbortController,r=setTimeout((()=>{n.abort(),Dt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Dt(0,0,!0,t):Dt(0,0,!1,t)})).catch((()=>{clearTimeout(r),Dt(0,0,!1,t)}))}(r.toString(),n)}else Ae(2);e.G=0,e.l&&e.l.sa(t),fn(e),Zt(e)}function fn(e){if(e.G=0,e.ka=[],e.l){const t=it(e.h);0==t.length&&0==e.i.length||(g(e.ka,t),g(e.ka,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.ra()}}function pn(e,t,n){var r=n instanceof at?ct(n):new at(n);if(""!=r.g)t&&(r.g=t+"."+r.g),lt(r,r.s);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new at(null);r&&ut(s,r),t&&(s.g=t),i&&lt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&dt(r,n,t),dt(r,"VER",e.la),nn(e,r),r}function gn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Bt(new Ot({eb:n})):new Bt(e.pa)).Ha(e.J),t}function mn(){}function yn(){}function vn(e,t){ie.call(this),this.g=new Jt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new _n(this)}function wn(e){be.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function bn(){_e.call(this),this.status=1}function _n(e){this.g=e}(t=Bt.prototype).Ha=function(e){this.J=e},t.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Me.g(),this.v=this.o?ye(this.o):ye(Me),this.g.onreadystatechange=h(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void jt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=o.FormData&&e instanceof o.FormData,!(0<=Array.prototype.indexOf.call(qt,t,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){jt(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,se(this,"complete"),se(this,"abort"),Gt(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gt(this,!0)),Bt.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?$t(this):this.bb())},t.bb=function(){$t(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<Qt(this)?this.g.status:-1}catch(e){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),pe(t)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Jt.prototype).la=8,t.G=1,t.connect=function(e,t,n,r){Ae(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=pn(this,null,this.W),en(this)},t.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Fe(this,this.j,e);let s=this.o;if(this.S&&(s?(s=_(s),E(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=rn(this,i,t),dt(n=ct(this.I),"RID",e),dt(n,"CVER",22),this.D&&dt(n,"X-HTTP-Session-Id",this.D),nn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Ft(s)))+"&"+t:this.m&&Vt(n,this.m,s)),nt(this.h,i),this.Ua&&dt(n,"TYPE","init"),this.P?(dt(n,"$req",t),dt(n,"SID","null"),i.T=!0,qe(i,n,null)):qe(i,n,t),this.G=2}}else 3==this.G&&(e?tn(this,e):0==this.i.length||Ze(this.h)||tn(this))},t.Fa=function(){if(this.u=null,cn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ne(h(this.ab,this),e)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Xt(this),cn(this))},t.Za=function(){null!=this.C&&(this.C=null,Xt(this),on(this),Ae(19))},t.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=mn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},yn.prototype.g=function(e,t){return new vn(e,t)},f(vn,ie),vn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},vn.prototype.close=function(){Yt(this.g)},vn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=fe(e),e=n);t.i.push(new Ye(t.Ya++,e)),3==t.G&&en(t)},vn.prototype.N=function(){this.g.l=null,delete this.j,Yt(this.g),delete this.g,vn.aa.N.call(this)},f(wn,be),f(bn,_e),f(_n,mn),_n.prototype.ua=function(){se(this.g,"a")},_n.prototype.ta=function(e){se(this.g,new wn(e))},_n.prototype.sa=function(e){se(this.g,new bn(e))},_n.prototype.ra=function(){se(this.g,"b")},yn.prototype.createWebChannel=yn.prototype.g,vn.prototype.send=vn.prototype.o,vn.prototype.open=vn.prototype.m,vn.prototype.close=vn.prototype.close,e.exports.createWebChannelTransport=function(){return new yn},e.exports.getStatEventTarget=function(){return Te()},e.exports.Event=Ie,e.exports.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Re.NO_ERROR=0,Re.TIMEOUT=8,Re.HTTP_ERROR=6,e.exports.ErrorCode=Re,Le.COMPLETE="complete",e.exports.EventType=Le,ve.EventType=we,we.OPEN="a",we.CLOSE="b",we.ERROR="c",we.MESSAGE="d",ie.prototype.listen=ie.prototype.K,e.exports.WebChannel=ve,e.exports.FetchXmlHttpFactory=Ot,Bt.prototype.listenOnce=Bt.prototype.L,Bt.prototype.getLastError=Bt.prototype.Ka,Bt.prototype.getLastErrorCode=Bt.prototype.Ba,Bt.prototype.getStatus=Bt.prototype.Z,Bt.prototype.getResponseJson=Bt.prototype.Oa,Bt.prototype.getResponseText=Bt.prototype.oa,Bt.prototype.send=Bt.prototype.ea,Bt.prototype.setWithCredentials=Bt.prototype.Ha,e.exports.XhrIo=Bt}).apply(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},449:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUploadType=function(e){return"object"==typeof e&&null!==e&&Array.isArray(e.transition)&&e.transition.every(r.isTransitionItem)&&"string"==typeof e.ytId};const r=n(687)},453:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(193),s=n(38),o=n(906),a=n(572);class c{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const u="@firebase/app",l="0.11.5",h=new s.Logger("@firebase/app"),d="@firebase/app-compat",f="@firebase/analytics-compat",p="@firebase/analytics",g="@firebase/app-check-compat",m="@firebase/app-check",y="@firebase/auth",v="@firebase/auth-compat",w="@firebase/database",b="@firebase/data-connect",_="@firebase/database-compat",I="@firebase/functions",E="@firebase/functions-compat",T="@firebase/installations",S="@firebase/installations-compat",C="@firebase/messaging",x="@firebase/messaging-compat",A="@firebase/performance",D="@firebase/performance-compat",N="@firebase/remote-config",k="@firebase/remote-config-compat",O="@firebase/storage",M="@firebase/storage-compat",R="@firebase/firestore",L="@firebase/vertexai",P="@firebase/firestore-compat",F="firebase",V="[DEFAULT]",B={[u]:"fire-core",[d]:"fire-core-compat",[p]:"fire-analytics",[f]:"fire-analytics-compat",[m]:"fire-app-check",[g]:"fire-app-check-compat",[y]:"fire-auth",[v]:"fire-auth-compat",[w]:"fire-rtdb",[b]:"fire-data-connect",[_]:"fire-rtdb-compat",[I]:"fire-fn",[E]:"fire-fn-compat",[T]:"fire-iid",[S]:"fire-iid-compat",[C]:"fire-fcm",[x]:"fire-fcm-compat",[A]:"fire-perf",[D]:"fire-perf-compat",[N]:"fire-rc",[k]:"fire-rc-compat",[O]:"fire-gcs",[M]:"fire-gcs-compat",[R]:"fire-fst",[P]:"fire-fst-compat",[L]:"fire-vertex","fire-js":"fire-js",[F]:"fire-js-all"},U=new Map,q=new Map,j=new Map;function z(e,t){try{e.container.addComponent(t)}catch(n){h.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function $(e){const t=e.name;if(j.has(t))return h.debug(`There were multiple attempts to register component ${t}.`),!1;j.set(t,e);for(const t of U.values())z(t,e);for(const t of q.values())z(t,e);return!0}function G(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function K(e){return void 0!==e.options}const Q=new o.ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class H{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.Component("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Q.create("app-deleted",{appName:this._name})}}function W(e,t){const n=o.base64Decode(e.split(".")[1]);null!==n?void 0!==JSON.parse(n).exp?1e3*JSON.parse(n).exp-(new Date).getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`):console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`)}class J extends H{constructor(e,t,n,r){const i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&W(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&W(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry((()=>{this.automaticCleanup()}))),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,Z(u,l,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){X(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Q.create("server-app-deleted")}}function Y(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:V,automaticDataCollectionEnabled:!1},t),s=r.name;if("string"!=typeof s||!s)throw Q.create("bad-app-name",{appName:String(s)});if(n||(n=o.getDefaultAppConfig()),!n)throw Q.create("no-options");const a=U.get(s);if(a){if(o.deepEqual(n,a.options)&&o.deepEqual(r,a.config))return a;throw Q.create("duplicate-app",{appName:s})}const c=new i.ComponentContainer(s);for(const e of j.values())c.addComponent(e);const u=new H(n,r,c);return U.set(s,u),u}function X(e){return r(this,void 0,void 0,(function*(){let t=!1;const n=e.name;U.has(n)?(t=!0,U.delete(n)):q.has(n)&&e.decRefCount()<=0&&(q.delete(n),t=!0),t&&(yield Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}))}function Z(e,t,n){var r;let s=null!==(r=B[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void h.warn(e.join(" "))}$(new i.Component(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const ee="firebase-heartbeat-store";let te=null;function ne(){return te||(te=a.openDB("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ee)}catch(e){console.warn(e)}}}).catch((e=>{throw Q.create("idb-open",{originalErrorMessage:e.message})}))),te}function re(e,t){return r(this,void 0,void 0,(function*(){try{const n=(yield ne()).transaction(ee,"readwrite"),r=n.objectStore(ee);yield r.put(t,ie(e)),yield n.done}catch(e){if(e instanceof o.FirebaseError)h.warn(e.message);else{const t=Q.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});h.warn(t.message)}}}))}function ie(e){return`${e.name}!${e.options.appId}`}class se{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ae(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}triggerHeartbeat(){return r(this,void 0,void 0,(function*(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=oe();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){h.warn(e)}}))}getHeartbeatsHeader(){return r(this,void 0,void 0,(function*(){var e;try{if(null===this._heartbeatsCache&&(yield this._heartbeatsCachePromise),null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=oe(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),ce(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ce(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=o.base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return h.warn(e),""}}))}}function oe(){return(new Date).toISOString().substring(0,10)}class ae{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return r(this,void 0,void 0,(function*(){return!!o.isIndexedDBAvailable()&&o.validateIndexedDBOpenable().then((()=>!0)).catch((()=>!1))}))}read(){return r(this,void 0,void 0,(function*(){if(yield this._canUseIndexedDBPromise){const e=yield function(e){return r(this,void 0,void 0,(function*(){try{const t=(yield ne()).transaction(ee),n=yield t.objectStore(ee).get(ie(e));return yield t.done,n}catch(e){if(e instanceof o.FirebaseError)h.warn(e.message);else{const t=Q.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});h.warn(t.message)}}}))}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}))}overwrite(e){return r(this,void 0,void 0,(function*(){var t;if(yield this._canUseIndexedDBPromise){const n=yield this.read();return re(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}))}add(e){return r(this,void 0,void 0,(function*(){var t;if(yield this._canUseIndexedDBPromise){const n=yield this.read();return re(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}))}}function ce(e){return o.base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:e})).length}$(new i.Component("platform-logger",(e=>new c(e)),"PRIVATE")),$(new i.Component("heartbeat",(e=>new se(e)),"PRIVATE")),Z(u,l,"node"),Z(u,l,"cjs2017"),Z("fire-js",""),Object.defineProperty(t,"FirebaseError",{enumerable:!0,get:function(){return o.FirebaseError}}),t.SDK_VERSION="11.6.1",t._DEFAULT_ENTRY_NAME=V,t._addComponent=z,t._addOrOverwriteComponent=function(e,t){e.container.addOrOverwriteComponent(t)},t._apps=U,t._clearComponents=function(){j.clear()},t._components=j,t._getProvider=G,t._isFirebaseApp=K,t._isFirebaseServerApp=function(e){return null!=e&&void 0!==e.settings},t._registerComponent=$,t._removeServiceInstance=function(e,t,n=V){G(e,t).clearInstance(n)},t._serverApps=q,t.deleteApp=X,t.getApp=function(e=V){const t=U.get(e);if(!t&&e===V&&o.getDefaultAppConfig())return Y();if(!t)throw Q.create("no-app",{appName:e});return t},t.getApps=function(){return Array.from(U.values())},t.initializeApp=Y,t.initializeServerApp=function(e,t){if(o.isBrowser()&&!o.isWebWorker())throw Q.create("invalid-server-app-environment");let n;void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),n=K(e)?e.options:e;const r=Object.assign(Object.assign({},t),n);if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw Q.create("finalization-registry-not-supported",{});const s=""+(a=JSON.stringify(r),[...a].reduce(((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0),0));var a;const c=q.get(s);if(c)return c.incRefCount(t.releaseOnDeref),c;const u=new i.ComponentContainer(s);for(const e of j.values())u.addComponent(e);const l=new J(n,t,s,u);return q.set(s,l),l},t.onLog=function(e,t){if(null!==e&&"function"!=typeof e)throw Q.create("invalid-log-argument");s.setUserLogHandler(e,t)},t.registerVersion=Z,t.setLogLevel=function(e){s.setLogLevel(e)}},467:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=n(453);r.registerVersion("firebase","11.6.1","app"),Object.keys(r).forEach((function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}))},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},572:(e,t,n)=>{n.r(t),n.d(t,{deleteDB:()=>m,openDB:()=>g,unwrap:()=>p,wrap:()=>f});const r=(e,t)=>t.some((t=>e instanceof t));let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),f(o.get(this))}:function(...e){return f(t.apply(p(this),e))}:function(e,...n){const r=t.call(p(this),e,...n);return c.set(r,e.sort?e.sort():[e]),f(r)}:(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}(e),r(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e);var t}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(f(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=d(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const p=e=>l.get(e);function g(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=f(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(f(o.result),e.oldVersion,e.newVersion,f(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}function m(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(e=>t(e.oldVersion,e))),f(n).then((()=>{}))}const y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!y.includes(n))return;const s=function(e,...t){return s=this,o=void 0,c=function*(){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(yield Promise.all([o[n](...t),i&&s.done]))[0]},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(n,r)}i((c=c.apply(s,o||[])).next())}));var s,o,a,c};return w.set(t,s),s}var _;_=h,h=Object.assign(Object.assign({},_),{get:(e,t,n)=>b(e,t)||_.get(e,t,n),has:(e,t)=>!!b(e,t)||_.has(e,t)})},608:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(249);n(159);class i extends r.Narve.Component{constructor(){super("div",{class:"transitionArea"}),this.transition=[],this.transitionUl=(0,r.nr)("ul",{class:"transitionUl"}),this.commentArea=(0,r.nr)("div",{class:"commentArea"}),this.children.set(this.transitionUl,this.commentArea)}test(){this.transition=[{comment:"大野SPM\nきちんと打ち切ってのミスなのでよし\nここで弱気なプレーでミスってたらアウト",leftScored:!1,second:68},{comment:"敵SM",leftScored:!0,second:96},{comment:"敵SPM",leftScored:!0,second:120},{comment:"大野B決",leftScored:!0,second:145},{comment:"敵SPM",leftScored:!0,second:175}],this.reloadTransition()}reloadTransition(){let e=[[0,0]];this.transition.forEach((t=>{e.push([...e[e.length-1]]),t.leftScored?e[e.length-1][0]++:e[e.length-1][1]++})),this.transitionUl.children.set(...this.transition.map(((t,n)=>{const i=t.comment.split("\n")[0],s=(0,r.nr)("li",{},(0,r.nr)("div",{class:t.leftScored?"left":"right"},e[n+1][t.leftScored?0:1].toString()),(0,r.nr)("p",{},i));return s.elem.onclick=()=>{this.focusItem(n),this.skipTo(t.second)},s})))}focusSecond(e){this.transitionUl.children.forEach(((t,n)=>{t.elem.classList.remove("focus"),this.transition[n].second<=e&&(n==this.transition.length-1||this.transition[n+1].second>e)&&(t.elem.classList.add("focus"),this.onFocusChanged(n))}))}focusItem(e){this.transitionUl.children.forEach((e=>{e.elem.classList.remove("focus")})),this.transitionUl.children[e].elem.classList.add("focus"),this.onFocusChanged(e)}onFocusChanged(e){this.commentArea.setInnerText(this.transition[e].comment)}skipTo(e){}}t.default=i},628:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var u=0;u<e.length;u++){var l=[].concat(e[u]);r&&o[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),t.push(l))}},t}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},687:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTransitionItem=function(e){return"object"==typeof e&&null!==e&&"boolean"==typeof e.leftScored&&"string"==typeof e.comment&&"number"==typeof e.second}},788:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(72),i=n.n(r),s=n(825),o=n.n(s),a=n(659),c=n.n(a),u=n(56),l=n.n(u),h=n(540),d=n.n(h),f=n(113),p=n.n(f),g=n(365),m={};m.styleTagTransform=p(),m.setAttributes=l(),m.insert=c().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=d(),i()(g.A,m);const y=g.A&&g.A.locals?g.A.locals:void 0},803:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var i=n(453),s=n(193),o=n(38),a=n(906),c=n(330),u=n(374);const l="@firebase/firestore",h="4.7.11";class d{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}d.UNAUTHENTICATED=new d(null),d.GOOGLE_CREDENTIALS=new d("google-credentials-uid"),d.FIRST_PARTY=new d("first-party-uid"),d.MOCK_USER=new d("mock-user");let f="11.6.1";const p=new o.Logger("@firebase/firestore");function g(){return p.logLevel}function m(e,...t){if(p.logLevel<=o.LogLevel.DEBUG){const n=t.map(w);p.debug(`Firestore (${f}): ${e}`,...n)}}function y(e,...t){if(p.logLevel<=o.LogLevel.ERROR){const n=t.map(w);p.error(`Firestore (${f}): ${e}`,...n)}}function v(e,...t){if(p.logLevel<=o.LogLevel.WARN){const n=t.map(w);p.warn(`Firestore (${f}): ${e}`,...n)}}function w(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function b(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,_(e,r,n)}function _(e,t,n){let r=`FIRESTORE (${f}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw y(r),new Error(r)}function I(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||_(t,i,r)}function E(e,t){return e}const T={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class S extends a.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class C{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class x{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class A{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(d.UNAUTHENTICATED)))}shutdown(){}}class D{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class N{constructor(e){this.t=e,this.currentUser=d.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){I(void 0===this.o,42304);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new C;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new C,e.enqueueRetryable((()=>i(this.currentUser)))};const o=()=>{const t=s;e.enqueueRetryable((()=>r(this,void 0,void 0,(function*(){yield t.promise,yield i(this.currentUser)}))))},a=e=>{m("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((e=>a(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(m("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new C)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(m("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(I("string"==typeof t.accessToken,31837,{l:t}),new x(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return I(null===e||"string"==typeof e,2055,{h:e}),new d(e)}}class k{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=d.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class O{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new k(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(d.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class M{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class R{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,i._isFirebaseServerApp(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){I(void 0===this.o,3512);const n=e=>{null!=e.error&&m("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,m("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{m("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):m("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new M(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(I("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new M(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function L(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function P(){return new TextEncoder}class F{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=L(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function V(e,t){return e<t?-1:e>t?1:0}function B(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return V(r,i);{const s=P(),o=q(s.encode(U(e,n)),s.encode(U(t,n)));return 0!==o?o:V(r,i)}}n+=r>65535?2:1}return V(e.length,t.length)}function U(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function q(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return V(e[n],t[n]);return V(e.length,t.length)}function j(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function z(e){return e+"\0"}const $=-62135596800,G=1e6;class K{static now(){return K.fromMillis(Date.now())}static fromDate(e){return K.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*G);return new K(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new S(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new S(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<$)throw new S(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new S(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/G}_compareTo(e){return this.seconds===e.seconds?V(this.nanoseconds,e.nanoseconds):V(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-$;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{static fromTimestamp(e){return new Q(e)}static min(){return new Q(new K(0,0))}static max(){return new Q(new K(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const H="__name__";class W{constructor(e,t,n){void 0===t?t=0:t>e.length&&b(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&b(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===W.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof W?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=W.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return V(e.length,t.length)}static compareSegments(e,t){const n=W.isNumericId(e),r=W.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?W.extractNumericId(e).compare(W.extractNumericId(t)):B(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return c.Integer.fromString(e.substring(4,e.length-2))}}class J extends W{construct(e,t,n){return new J(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new S(T.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new J(t)}static emptyPath(){return new J([])}}const Y=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class X extends W{construct(e,t,n){return new X(e,t,n)}static isValidIdentifier(e){return Y.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),X.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===H}static keyField(){return new X([H])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new S(T.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new S(T.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new S(T.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new S(T.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new X(t)}static emptyPath(){return new X([])}}class Z{constructor(e){this.path=e}static fromPath(e){return new Z(J.fromString(e))}static fromName(e){return new Z(J.fromString(e).popFirst(5))}static empty(){return new Z(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===J.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return J.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Z(new J(e.slice()))}}const ee=-1;class te{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function ne(e){return e.fields.find((e=>2===e.kind))}function re(e){return e.fields.filter((e=>2!==e.kind))}function ie(e,t){let n=V(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(n=oe(e.fields[r],t.fields[r]),0!==n)return n;return V(e.fields.length,t.fields.length)}te.UNKNOWN_ID=-1;class se{constructor(e,t){this.fieldPath=e,this.kind=t}}function oe(e,t){const n=X.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:V(e.kind,t.kind)}class ae{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ae(0,le.min())}}function ce(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(1e9===r?new K(n+1,0):new K(n,r));return new le(i,Z.empty(),t)}function ue(e){return new le(e.readTime,e.key,ee)}class le{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new le(Q.min(),Z.empty(),ee)}static max(){return new le(Q.max(),Z.empty(),ee)}}function he(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Z.comparator(e.documentKey,t.documentKey),0!==n?n:V(e.largestBatchId,t.largestBatchId))}const de="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}function pe(e){return r(this,void 0,void 0,(function*(){if(e.code!==T.FAILED_PRECONDITION||e.message!==de)throw e;m("LocalStore","Unexpectedly lost primary lease")}))}class ge{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&b(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ge(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ge?t:ge.resolve(t)}catch(e){return ge.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ge.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ge.reject(t)}static resolve(e){return new ge(((t,n)=>{t(e)}))}static reject(e){return new ge(((t,n)=>{n(e)}))}static waitFor(e){return new ge(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=ge.resolve(!1);for(const n of e)t=t.next((e=>e?ge.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new ge(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new ge(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}const me="SimpleDb";class ye{static open(e,t,n,r){try{return new ye(t,e.transaction(r,n))}catch(e){throw new _e(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new C,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new _e(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const n=Ce(t.target.error);this.S.reject(new _e(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(m(me,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ee(t)}}class ve{static delete(e){return m(me,"Removing database:",e),Te(a.getGlobal().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!a.isIndexedDBAvailable())return!1;if(ve.F())return!0;const e=a.getUA(),t=ve.M(e),n=0<t&&t<10,r=we(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static F(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===ve.M(a.getUA())&&y("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return r(this,void 0,void 0,(function*(){return this.db||(m(me,"Opening database:",this.name),this.db=yield new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new _e(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new S(T.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new S(T.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new _e(e,r))},r.onupgradeneeded=e=>{m(me,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,r.transaction,e.oldVersion,this.version).next((()=>{m(me,"Database upgrade to version "+this.version+" complete")}))}})),this.db.addEventListener("close",(e=>{const t=e.target;this.L=t.version}),{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}))}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return r(this,void 0,void 0,(function*(){const r="readonly"===t;let s=0;for(;;){++s;try{this.db=yield this.k(e);const t=ye.open(this.db,e,r?"readonly":"readwrite",n),s=i(t).next((e=>(t.v(),e))).catch((e=>(t.abort(e),ge.reject(e)))).toPromise();return s.catch((()=>{})),yield t.D,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(m(me,"Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}))}close(){this.db&&this.db.close(),this.db=void 0}}function we(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class be{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return Te(this.K.delete())}}class _e extends S{constructor(e,t){super(T.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ie(e){return"IndexedDbTransactionError"===e.name}class Ee{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(m(me,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(m(me,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Te(n)}add(e){return m(me,"ADD",this.store.name,e,e),Te(this.store.add(e))}get(e){return Te(this.store.get(e)).next((t=>(void 0===t&&(t=null),m(me,"GET",this.store.name,e,t),t)))}delete(e){return m(me,"DELETE",this.store.name,e),Te(this.store.delete(e))}count(){return m(me,"COUNT",this.store.name),Te(this.store.count())}J(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new ge(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.Y(e,((e,n)=>{t.push(n)})).next((()=>t))}}Z(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new ge(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}X(e,t){m(me,"DELETE ALL",this.store.name);const n=this.options(e,t);n.ee=!1;const r=this.cursor(n);return this.Y(r,((e,t,n)=>n.delete()))}te(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Y(r,t)}ne(e){const t=this.cursor({});return new ge(((n,r)=>{t.onerror=e=>{const t=Ce(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Y(e,t){const n=[];return new ge(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new be(i),o=t(i.primaryKey,i.value,s);if(o instanceof ge){const e=o.catch((e=>(s.done(),ge.reject(e))));n.push(e)}s.isDone?r():null===s.j?i.continue():i.continue(s.j)}})).next((()=>ge.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Te(e){return new ge(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Ce(e.target.error);n(t)}}))}let Se=!1;function Ce(e){const t=ve.M(a.getUA());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new S("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Se||(Se=!0,setTimeout((()=>{throw e}),0)),e}}return e}const xe="IndexBackfiller";class Ae{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){m(xe,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(()=>r(this,void 0,void 0,(function*(){this.task=null;try{const e=yield this.re.se();m(xe,`Documents written: ${e}`)}catch(e){Ie(e)?m(xe,"Ignoring IndexedDB error during index backfill: ",e):yield pe(e)}yield this.ie(6e4)}))))}}class De{constructor(e,t){this.localStore=e,this.persistence=t}se(){return r(this,arguments,void 0,(function*(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.oe(t,e)))}))}oe(e,t){const n=new Set;let r=t,i=!0;return ge.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return m(xe,`Processing collection: ${t}`),this._e(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ae(r,n))).next((n=>(m(xe,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ae(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=ue(t);he(r,n)>0&&(n=r)})),new le(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Ne{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Ne.le=-1;const ke=-1;function Oe(e){return null==e}function Me(e){return 0===e&&1/e==-1/0}function Re(e){return"number"==typeof e&&Number.isInteger(e)&&!Me(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Le="";function Pe(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ve(t)),t=Fe(e.get(n),t);return Ve(t)}function Fe(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case Le:n+="";break;default:n+=r}}return n}function Ve(e){return e+Le+""}function Be(e){const t=e.length;if(I(t>=2,64408,{path:e}),2===t)return I(e.charAt(0)===Le&&""===e.charAt(1),56145,{path:e}),J.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf(Le,s);switch((t<0||t>n)&&b(50515,{path:e}),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:b(61167,{path:e})}s=t+2}return new J(r)}const Ue="remoteDocuments",qe="owner",je="owner",ze="mutationQueues",$e="mutations",Ge="batchId",Ke="userMutationsIndex",Qe=["userId","batchId"];function He(e,t){return[e,Pe(t)]}function We(e,t,n){return[e,Pe(t),n]}const Je={},Ye="documentMutations",Xe="remoteDocumentsV14",Ze=["prefixPath","collectionGroup","readTime","documentId"],et="documentKeyIndex",tt=["prefixPath","collectionGroup","documentId"],nt="collectionGroupIndex",rt=["collectionGroup","readTime","prefixPath","documentId"],it="remoteDocumentGlobal",st="remoteDocumentGlobalKey",ot="targets",at="queryTargetsIndex",ct=["canonicalId","targetId"],ut="targetDocuments",lt=["targetId","path"],ht="documentTargetsIndex",dt=["path","targetId"],ft="targetGlobalKey",pt="targetGlobal",gt="collectionParents",mt=["collectionId","parent"],yt="clientMetadata",vt="bundles",wt="namedQueries",bt="indexConfiguration",_t="collectionGroupIndex",It="indexState",Et=["indexId","uid"],Tt="sequenceNumberIndex",St=["uid","sequenceNumber"],Ct="indexEntries",xt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],At="documentKeyIndex",Dt=["indexId","uid","orderedDocumentKey"],Nt="documentOverlays",kt=["userId","collectionPath","documentId"],Ot="collectionPathOverlayIndex",Mt=["userId","collectionPath","largestBatchId"],Rt="collectionGroupOverlayIndex",Lt=["userId","collectionGroup","largestBatchId"],Pt="globals",Ft=[ze,$e,Ye,Ue,ot,qe,pt,ut,yt,it,gt,vt,wt],Vt=[...Ft,Nt],Bt=[ze,$e,Ye,Xe,ot,qe,pt,ut,yt,it,gt,vt,wt,Nt],Ut=Bt,qt=[...Ut,bt,It,Ct],jt=qt,zt=[...qt,Pt];class $t extends fe{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function Gt(e,t){const n=E(e);return ve.N(n.he,t)}function Kt(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Qt(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ht(e,t){const n=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function Wt(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Jt{constructor(e,t){this.comparator=e,this.root=t||Xt.EMPTY}insert(e,t){return new Jt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xt.BLACK,null,null))}remove(e){return new Jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yt(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yt(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yt(this.root,e,this.comparator,!0)}}class Yt{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Xt{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Xt.RED,this.left=null!=r?r:Xt.EMPTY,this.right=null!=i?i:Xt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Xt(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Xt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Xt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Xt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Xt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw b(43730,{key:this.key,value:this.value});if(this.right.isRed())throw b(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw b(27949);return e+(this.isRed()?0:1)}}Xt.EMPTY=null,Xt.RED=!0,Xt.BLACK=!1,Xt.EMPTY=new class{constructor(){this.size=0}get key(){throw b(57766)}get value(){throw b(16141)}get color(){throw b(16727)}get left(){throw b(29726)}get right(){throw b(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new Xt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Zt{constructor(e){this.comparator=e,this.data=new Jt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new en(this.data.getIterator())}getIteratorFrom(e){return new en(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Zt))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Zt(this.comparator);return t.data=e,t}}class en{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function tn(e){return e.hasNext()?e.getNext():void 0}class nn{constructor(e){this.fields=e,e.sort(X.comparator)}static empty(){return new nn([])}unionWith(e){let t=new Zt(X.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new nn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return j(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class rn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new rn("Invalid base64 string: "+e):e}}(e);return new sn(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new sn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return V(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sn.EMPTY_BYTE_STRING=new sn("");const on=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function an(e){if(I(!!e,39018),"string"==typeof e){let t=0;const n=on.exec(e);if(I(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:cn(e.seconds),nanos:cn(e.nanos)}}function cn(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function un(e){return"string"==typeof e?sn.fromBase64String(e):sn.fromUint8Array(e)}const ln="server_timestamp",hn="__type__",dn="__previous_value__",fn="__local_write_time__";function pn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[hn])||void 0===n?void 0:n.stringValue)===ln}function gn(e){const t=e.mapValue.fields[dn];return pn(t)?gn(t):t}function mn(e){const t=an(e.mapValue.fields[fn].timestampValue);return new K(t.seconds,t.nanos)}class yn{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}const vn="(default)";class wn{constructor(e,t){this.projectId=e,this.database=t||vn}static empty(){return new wn("","")}get isDefaultDatabase(){return this.database===vn}isEqual(e){return e instanceof wn&&e.projectId===this.projectId&&e.database===this.database}}const bn="__type__",_n="__max__",In={mapValue:{fields:{__type__:{stringValue:_n}}}},En="__vector__",Tn="value",Sn={nullValue:"NULL_VALUE"};function Cn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?pn(e)?4:zn(e)?9007199254740991:qn(e)?10:11:b(28295,{value:e})}function xn(e,t){if(e===t)return!0;const n=Cn(e);if(n!==Cn(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return mn(e).isEqual(mn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=an(e.timestampValue),r=an(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return un(e.bytesValue).isEqual(un(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return cn(e.geoPointValue.latitude)===cn(t.geoPointValue.latitude)&&cn(e.geoPointValue.longitude)===cn(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return cn(e.integerValue)===cn(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=cn(e.doubleValue),r=cn(t.doubleValue);return n===r?Me(n)===Me(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return j(e.arrayValue.values||[],t.arrayValue.values||[],xn);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Kt(n)!==Kt(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!xn(n[e],r[e])))return!1;return!0}(e,t);default:return b(52216,{left:e})}}function An(e,t){return void 0!==(e.values||[]).find((e=>xn(e,t)))}function Dn(e,t){if(e===t)return 0;const n=Cn(e),r=Cn(t);if(n!==r)return V(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return V(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=cn(e.integerValue||e.doubleValue),r=cn(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Nn(e.timestampValue,t.timestampValue);case 4:return Nn(mn(e),mn(t));case 5:return B(e.stringValue,t.stringValue);case 6:return function(e,t){const n=un(e),r=un(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=V(n[e],r[e]);if(0!==t)return t}return V(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=V(cn(e.latitude),cn(t.latitude));return 0!==n?n:V(cn(e.longitude),cn(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return kn(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},c=null===(n=o[Tn])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Tn])||void 0===r?void 0:r.arrayValue,l=V((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:kn(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===In.mapValue&&t===In.mapValue)return 0;if(e===In.mapValue)return 1;if(t===In.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=B(r[e],s[e]);if(0!==t)return t;const o=Dn(n[r[e]],i[s[e]]);if(0!==o)return o}return V(r.length,s.length)}(e.mapValue,t.mapValue);default:throw b(23264,{Pe:n})}}function Nn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return V(e,t);const n=an(e),r=an(t),i=V(n.seconds,r.seconds);return 0!==i?i:V(n.nanos,r.nanos)}function kn(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Dn(n[e],r[e]);if(t)return t}return V(n.length,r.length)}function On(e){return Mn(e)}function Mn(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=an(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return un(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Z.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Mn(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Mn(e.fields[i])}`;return n+"}"}(e.mapValue):b(61005,{value:e})}function Rn(e){switch(Cn(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=gn(e);return t?16+Rn(t):16;case 5:return 2*e.stringValue.length;case 6:return un(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+Rn(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Qt(e.fields,((e,n)=>{t+=e.length+Rn(n)})),t}(e.mapValue);default:throw b(13486,{value:e})}}function Ln(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Pn(e){return!!e&&"integerValue"in e}function Fn(e){return!!e&&"arrayValue"in e}function Vn(e){return!!e&&"nullValue"in e}function Bn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Un(e){return!!e&&"mapValue"in e}function qn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[bn])||void 0===n?void 0:n.stringValue)===En}function jn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Qt(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=jn(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=jn(e.arrayValue.values[n]);return t}return Object.assign({},e)}function zn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===_n}const $n={mapValue:{fields:{[bn]:{stringValue:En},[Tn]:{arrayValue:{}}}}};function Gn(e){return"nullValue"in e?Sn:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Ln(wn.empty(),Z.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?qn(e)?$n:{mapValue:{}}:b(35942,{value:e})}function Kn(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Ln(wn.empty(),Z.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?$n:"mapValue"in e?qn(e)?{mapValue:{}}:In:b(61959,{value:e})}function Qn(e,t){const n=Dn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Hn(e,t){const n=Dn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Wn{constructor(e){this.value=e}static empty(){return new Wn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Un(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=jn(t)}setAll(e){let t=X.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=jn(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Un(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Un(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Qt(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Wn(jn(this.value))}}function Jn(e){const t=[];return Qt(e.fields,((e,n)=>{const r=new X([e]);if(Un(n)){const e=Jn(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new nn(t)}class Yn{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Yn(e,0,Q.min(),Q.min(),Q.min(),Wn.empty(),0)}static newFoundDocument(e,t,n,r){return new Yn(e,1,t,Q.min(),n,r,0)}static newNoDocument(e,t){return new Yn(e,2,t,Q.min(),Q.min(),Wn.empty(),0)}static newUnknownDocument(e,t){return new Yn(e,3,t,Q.min(),Q.min(),Wn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Q.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Wn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Wn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Yn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Yn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xn{constructor(e,t){this.position=e,this.inclusive=t}}function Zn(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Z.comparator(Z.fromName(o.referenceValue),n.key):Dn(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function er(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!xn(e.position[n],t.position[n]))return!1;return!0}class tr{constructor(e,t="asc"){this.field=e,this.dir=t}}function nr(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class rr{}class ir extends rr{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new pr(e,t,n):"array-contains"===t?new vr(e,n):"in"===t?new wr(e,n):"not-in"===t?new br(e,n):"array-contains-any"===t?new _r(e,n):new ir(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new gr(e,n):new mr(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Dn(t,this.value)):null!==t&&Cn(this.value)===Cn(t)&&this.matchesComparison(Dn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return b(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sr extends rr{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new sr(e,t)}matches(e){return or(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function or(e){return"and"===e.op}function ar(e){return"or"===e.op}function cr(e){return ur(e)&&or(e)}function ur(e){for(const t of e.filters)if(t instanceof sr)return!1;return!0}function lr(e){if(e instanceof ir)return e.field.canonicalString()+e.op.toString()+On(e.value);if(cr(e))return e.filters.map((e=>lr(e))).join(",");{const t=e.filters.map((e=>lr(e))).join(",");return`${e.op}(${t})`}}function hr(e,t){return e instanceof ir?function(e,t){return t instanceof ir&&e.op===t.op&&e.field.isEqual(t.field)&&xn(e.value,t.value)}(e,t):e instanceof sr?function(e,t){return t instanceof sr&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&hr(n,t.filters[r])),!0)}(e,t):void b(19439)}function dr(e,t){const n=e.filters.concat(t);return sr.create(n,e.op)}function fr(e){return e instanceof ir?function(e){return`${e.field.canonicalString()} ${e.op} ${On(e.value)}`}(e):e instanceof sr?function(e){return e.op.toString()+" {"+e.getFilters().map(fr).join(" ,")+"}"}(e):"Filter"}class pr extends ir{constructor(e,t,n){super(e,t,n),this.key=Z.fromName(n.referenceValue)}matches(e){const t=Z.comparator(e.key,this.key);return this.matchesComparison(t)}}class gr extends ir{constructor(e,t){super(e,"in",t),this.keys=yr(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class mr extends ir{constructor(e,t){super(e,"not-in",t),this.keys=yr(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function yr(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Z.fromName(e.referenceValue)))}class vr extends ir{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Fn(t)&&An(t.arrayValue,this.value)}}class wr extends ir{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&An(this.value.arrayValue,t)}}class br extends ir{constructor(e,t){super(e,"not-in",t)}matches(e){if(An(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!An(this.value.arrayValue,t)}}class _r extends ir{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Fn(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>An(this.value.arrayValue,e)))}}class Ir{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ie=null}}function Er(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Ir(e,t,n,r,i,s,o)}function Tr(e){const t=E(e);if(null===t.Ie){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>lr(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Oe(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>On(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>On(e))).join(",")),t.Ie=e}return t.Ie}function Sr(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!nr(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!hr(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!er(e.startAt,t.startAt)&&er(e.endAt,t.endAt)}function Cr(e){return Z.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function xr(e,t){return e.filters.filter((e=>e instanceof ir&&e.field.isEqual(t)))}function Ar(e,t,n){let r=Sn,i=!0;for(const n of xr(e,t)){let e=Sn,t=!0;switch(n.op){case"<":case"<=":e=Gn(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Sn}Qn({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Qn({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Dr(e,t,n){let r=In,i=!0;for(const n of xr(e,t)){let e=In,t=!0;switch(n.op){case">=":case">":e=Kn(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=In}Hn({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Hn({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Nr{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function kr(e,t,n,r,i,s,o,a){return new Nr(e,t,n,r,i,s,o,a)}function Or(e){return new Nr(e)}function Mr(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Rr(e){return null!==e.collectionGroup}function Lr(e){const t=E(e);if(null===t.Ee){t.Ee=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ee.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Zt(X.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ee.push(new tr(r,n))})),e.has(X.keyField().canonicalString())||t.Ee.push(new tr(X.keyField(),n))}return t.Ee}function Pr(e){const t=E(e);return t.de||(t.de=Vr(t,Lr(e))),t.de}function Fr(e){const t=E(e);return t.Ae||(t.Ae=Vr(t,e.explicitOrderBy)),t.Ae}function Vr(e,t){if("F"===e.limitType)return Er(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new tr(e.field,t)}));const n=e.endAt?new Xn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Xn(e.startAt.position,e.startAt.inclusive):null;return Er(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Br(e,t){const n=e.filters.concat([t]);return new Nr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ur(e,t,n){return new Nr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function qr(e,t){return Sr(Pr(e),Pr(t))&&e.limitType===t.limitType}function jr(e){return`${Tr(Pr(e))}|lt:${e.limitType}`}function zr(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>fr(e))).join(", ")}]`),Oe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>On(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>On(e))).join(",")),`Target(${t})`}(Pr(e))}; limitType=${e.limitType})`}function $r(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Z.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Lr(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Zn(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Lr(e),t)||e.endAt&&!function(e,t,n){const r=Zn(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Lr(e),t))}(e,t)}function Gr(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Kr(e){return(t,n)=>{let r=!1;for(const i of Lr(e)){const e=Qr(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Qr(e,t,n){const r=e.field.isKeyField()?Z.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Dn(r,i):b(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return b(19790,{direction:e.dir})}}class Hr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Qt(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Wt(this.inner)}size(){return this.innerSize}}const Wr=new Jt(Z.comparator);function Jr(){return Wr}const Yr=new Jt(Z.comparator);function Xr(...e){let t=Yr;for(const n of e)t=t.insert(n.key,n);return t}function Zr(e){let t=Yr;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ei(){return ni()}function ti(){return ni()}function ni(){return new Hr((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ri=new Jt(Z.comparator),ii=new Zt(Z.comparator);function si(...e){let t=ii;for(const n of e)t=t.add(n);return t}const oi=new Zt(V);function ai(){return oi}function ci(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Me(t)?"-0":t}}function ui(e){return{integerValue:""+e}}function li(e,t){return Re(t)?ui(t):ci(e,t)}class hi{constructor(){this._=void 0}}function di(e,t,n){return e instanceof gi?function(e,t){const n={fields:{[hn]:{stringValue:ln},[fn]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&pn(t)&&(t=gn(t)),t&&(n.fields[dn]=t),{mapValue:n}}(n,t):e instanceof mi?yi(e,t):e instanceof vi?wi(e,t):function(e,t){const n=pi(e,t),r=_i(n)+_i(e.Re);return Pn(n)&&Pn(e.Re)?ui(r):ci(e.serializer,r)}(e,t)}function fi(e,t,n){return e instanceof mi?yi(e,t):e instanceof vi?wi(e,t):n}function pi(e,t){return e instanceof bi?function(e){return Pn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class gi extends hi{}class mi extends hi{constructor(e){super(),this.elements=e}}function yi(e,t){const n=Ii(t);for(const t of e.elements)n.some((e=>xn(e,t)))||n.push(t);return{arrayValue:{values:n}}}class vi extends hi{constructor(e){super(),this.elements=e}}function wi(e,t){let n=Ii(t);for(const t of e.elements)n=n.filter((e=>!xn(e,t)));return{arrayValue:{values:n}}}class bi extends hi{constructor(e,t){super(),this.serializer=e,this.Re=t}}function _i(e){return cn(e.integerValue||e.doubleValue)}function Ii(e){return Fn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ei{constructor(e,t){this.field=e,this.transform=t}}class Ti{constructor(e,t){this.version=e,this.transformResults=t}}class Si{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Si}static exists(e){return new Si(void 0,e)}static updateTime(e){return new Si(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ci(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class xi{}function Ai(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Vi(e.key,Si.none()):new Mi(e.key,e.data,Si.none());{const n=e.data,r=Wn.empty();let i=new Zt(X.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Ri(e.key,r,new nn(i.toArray()),Si.none())}}function Di(e,t,n){e instanceof Mi?function(e,t,n){const r=e.value.clone(),i=Pi(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ri?function(e,t,n){if(!Ci(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Pi(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Li(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ni(e,t,n,r){return e instanceof Mi?function(e,t,n,r){if(!Ci(e.precondition,t))return n;const i=e.value.clone(),s=Fi(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ri?function(e,t,n,r){if(!Ci(e.precondition,t))return n;const i=Fi(e.fieldTransforms,r,t),s=t.data;return s.setAll(Li(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Ci(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ki(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=pi(r.transform,e||null);null!=i&&(null===n&&(n=Wn.empty()),n.set(r.field,i))}return n||null}function Oi(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&j(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof mi&&t instanceof mi||e instanceof vi&&t instanceof vi?j(e.elements,t.elements,xn):e instanceof bi&&t instanceof bi?xn(e.Re,t.Re):e instanceof gi&&t instanceof gi}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Mi extends xi{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ri extends xi{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Li(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Pi(e,t,n){const r=new Map;I(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,fi(o,a,n[i]))}return r}function Fi(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,di(e,s,t))}return r}class Vi extends xi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Bi extends xi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ui{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Di(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ni(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ni(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ti();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Ai(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Q.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),si())}isEqual(e){return this.batchId===e.batchId&&j(this.mutations,e.mutations,((e,t)=>Oi(e,t)))&&j(this.baseMutations,e.baseMutations,((e,t)=>Oi(e,t)))}}class qi{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){I(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let r=ri;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new qi(e,t,n,r)}}class ji{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class zi{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class $i{constructor(e,t){this.count=e,this.unchangedNames=t}}var Gi,Ki;function Qi(e){switch(e){case T.OK:return b(64938);case T.CANCELLED:case T.UNKNOWN:case T.DEADLINE_EXCEEDED:case T.RESOURCE_EXHAUSTED:case T.INTERNAL:case T.UNAVAILABLE:case T.UNAUTHENTICATED:return!1;case T.INVALID_ARGUMENT:case T.NOT_FOUND:case T.ALREADY_EXISTS:case T.PERMISSION_DENIED:case T.FAILED_PRECONDITION:case T.ABORTED:case T.OUT_OF_RANGE:case T.UNIMPLEMENTED:case T.DATA_LOSS:return!0;default:return b(15467,{code:e})}}function Hi(e){if(void 0===e)return y("GRPC error has no .code"),T.UNKNOWN;switch(e){case Gi.OK:return T.OK;case Gi.CANCELLED:return T.CANCELLED;case Gi.UNKNOWN:return T.UNKNOWN;case Gi.DEADLINE_EXCEEDED:return T.DEADLINE_EXCEEDED;case Gi.RESOURCE_EXHAUSTED:return T.RESOURCE_EXHAUSTED;case Gi.INTERNAL:return T.INTERNAL;case Gi.UNAVAILABLE:return T.UNAVAILABLE;case Gi.UNAUTHENTICATED:return T.UNAUTHENTICATED;case Gi.INVALID_ARGUMENT:return T.INVALID_ARGUMENT;case Gi.NOT_FOUND:return T.NOT_FOUND;case Gi.ALREADY_EXISTS:return T.ALREADY_EXISTS;case Gi.PERMISSION_DENIED:return T.PERMISSION_DENIED;case Gi.FAILED_PRECONDITION:return T.FAILED_PRECONDITION;case Gi.ABORTED:return T.ABORTED;case Gi.OUT_OF_RANGE:return T.OUT_OF_RANGE;case Gi.UNIMPLEMENTED:return T.UNIMPLEMENTED;case Gi.DATA_LOSS:return T.DATA_LOSS;default:return b(39323,{code:e})}}(Ki=Gi||(Gi={}))[Ki.OK=0]="OK",Ki[Ki.CANCELLED=1]="CANCELLED",Ki[Ki.UNKNOWN=2]="UNKNOWN",Ki[Ki.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ki[Ki.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ki[Ki.NOT_FOUND=5]="NOT_FOUND",Ki[Ki.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ki[Ki.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ki[Ki.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ki[Ki.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ki[Ki.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ki[Ki.ABORTED=10]="ABORTED",Ki[Ki.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ki[Ki.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ki[Ki.INTERNAL=13]="INTERNAL",Ki[Ki.UNAVAILABLE=14]="UNAVAILABLE",Ki[Ki.DATA_LOSS=15]="DATA_LOSS";let Wi=null;const Ji=new c.Integer([4294967295,4294967295],0);function Yi(e){const t=P().encode(e),n=new c.Md5;return n.update(t),new Uint8Array(n.digest())}function Xi(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new c.Integer([n,r],0),new c.Integer([i,s],0)]}class Zi{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new es(`Invalid padding: ${t}`);if(n<0)throw new es(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new es(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new es(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=c.Integer.fromNumber(this.pe)}we(e,t,n){let r=e.add(t.multiply(c.Integer.fromNumber(n)));return 1===r.compare(Ji)&&(r=new c.Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;const t=Yi(e),[n,r]=Xi(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,r,e);if(!this.be(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Zi(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.pe)return;const t=Yi(e),[n,r]=Xi(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,r,e);this.Se(t)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class es extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ts{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ns.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ts(Q.min(),r,new Jt(V),Jr(),si())}}class ns{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ns(n,t,si(),si(),si())}}class rs{constructor(e,t,n,r){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=r}}class is{constructor(e,t){this.targetId=e,this.Ce=t}}class ss{constructor(e,t,n=sn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class os{constructor(){this.Fe=0,this.Me=us(),this.xe=sn.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=si(),t=si(),n=si();return this.Me.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:b(38017,{changeType:i})}})),new ns(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=us()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,I(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class as{constructor(e){this.ze=e,this.je=new Map,this.He=Jr(),this.Je=cs(),this.Ye=cs(),this.Ze=new Jt(V)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,(t=>{const n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:b(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach(((e,n)=>{this.it(n)&&t(n)}))}ot(e){const t=e.targetId,n=e.Ce.count,r=this._t(t);if(r){const i=r.target;if(Cr(i))if(0===n){const e=new Z(i.path);this.tt(t,e,Yn.newNoDocument(e,Q.min()))}else I(1===n,20013,{expectedCount:n});else{const r=this.ut(t);if(r!==n){const n=this.ct(e),i=n?this.lt(n,e,r):1;if(0!==i){this.st(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}null==Wi||Wi.ht(function(e,t,n,r,i){var s,o,a,c,u,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(c=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(l=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.Ce,this.ze.Pt(),n,i))}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=un(n).toUint8Array()}catch(e){if(e instanceof rn)return v("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Zi(s,r,i)}catch(e){return v(e instanceof es?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.pe?null:o}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){const n=this.ze.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),r++)})),r}It(e){const t=new Map;this.je.forEach(((n,r)=>{const i=this._t(r);if(i){if(n.current&&Cr(i.target)){const t=new Z(i.target.path);this.Et(t).has(r)||this.dt(r,t)||this.tt(r,t,Yn.newNoDocument(t,e))}n.Le&&(t.set(r,n.qe()),n.Qe())}}));let n=si();this.Ye.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.He.forEach(((t,n)=>n.setReadTime(e)));const r=new ts(e,t,this.Ze,this.He,n);return this.He=Jr(),this.Je=cs(),this.Ye=cs(),this.Ze=new Jt(V),r}et(e,t){if(!this.it(e))return;const n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;const r=this.rt(e);this.dt(e,t)?r.$e(t,1):r.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new os,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new Zt(V),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new Zt(V),this.Je=this.Je.insert(e,t)),t}it(e){const t=null!==this._t(e);return t||m("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new os),this.ze.getRemoteKeysForTarget(e).forEach((t=>{this.tt(e,t,null)}))}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function cs(){return new Jt(Z.comparator)}function us(){return new Jt(Z.comparator)}const ls={asc:"ASCENDING",desc:"DESCENDING"},hs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ds={and:"AND",or:"OR"};class fs{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ps(e,t){return e.useProto3Json||Oe(t)?t:{value:t}}function gs(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ms(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ys(e,t){return gs(e,t.toTimestamp())}function vs(e){return I(!!e,49232),Q.fromTimestamp(function(e){const t=an(e);return new K(t.seconds,t.nanos)}(e))}function ws(e,t){return bs(e,t).canonicalString()}function bs(e,t){const n=function(e){return new J(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function _s(e){const t=J.fromString(e);return I($s(t),10190,{key:t.toString()}),t}function Is(e,t){return ws(e.databaseId,t.path)}function Es(e,t){const n=_s(t);if(n.get(1)!==e.databaseId.projectId)throw new S(T.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new S(T.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Z(xs(n))}function Ts(e,t){return ws(e.databaseId,t)}function Ss(e){const t=_s(e);return 4===t.length?J.emptyPath():xs(t)}function Cs(e){return new J(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function xs(e){return I(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function As(e,t,n){return{name:Is(e,t),fields:n.value.mapValue.fields}}function Ds(e,t,n){const r=Es(e,t.name),i=vs(t.updateTime),s=t.createTime?vs(t.createTime):Q.min(),o=new Wn({mapValue:{fields:t.fields}}),a=Yn.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Ns(e,t){let n;if(t instanceof Mi)n={update:As(e,t.key,t.value)};else if(t instanceof Vi)n={delete:Is(e,t.key)};else if(t instanceof Ri)n={update:As(e,t.key,t.data),updateMask:zs(t.fieldMask)};else{if(!(t instanceof Bi))return b(16599,{ft:t.type});n={verify:Is(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof gi)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof mi)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vi)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof bi)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw b(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ys(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:b(27497)}(e,t.precondition)),n}function ks(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Si.updateTime(vs(e.updateTime)):void 0!==e.exists?Si.exists(e.exists):Si.none()}(t.currentDocument):Si.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)I("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new gi;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new mi(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new vi(e)}else"increment"in t?n=new bi(e,t.increment):b(16584,{proto:t});const r=X.fromServerFormat(t.fieldPath);return new Ei(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Es(e,t.update.name),s=new Wn({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new nn(t.map((e=>X.fromServerFormat(e))))}(t.updateMask);return new Ri(i,s,e,n,r)}return new Mi(i,s,n,r)}if(t.delete){const r=Es(e,t.delete);return new Vi(r,n)}if(t.verify){const r=Es(e,t.verify);return new Bi(r,n)}return b(1463,{proto:t})}function Os(e,t){return{documents:[Ts(e,t.path)]}}function Ms(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ts(e,i);const s=function(e){if(0!==e.length)return js(sr.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Us(e.field),direction:Fs(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ps(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{gt:n,parent:i}}function Rs(e,t,n,r){const{gt:i,parent:s}=Ms(e,t),o={},a=[];let c=0;return n.forEach((e=>{const t=r?e.alias:"aggregate_"+c++;o[t]=e.alias,"count"===e.aggregateType?a.push({alias:t,count:{}}):"avg"===e.aggregateType?a.push({alias:t,avg:{field:Us(e.fieldPath)}}):"sum"===e.aggregateType&&a.push({alias:t,sum:{field:Us(e.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:i.structuredQuery},parent:i.parent},yt:o,parent:s}}function Ls(e){let t=Ss(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){I(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Ps(e);return t instanceof sr&&cr(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new tr(qs(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Oe(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Xn(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Xn(n,t)}(n.endAt)),kr(t,i,o,s,a,"F",c,u)}function Ps(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=qs(e.unaryFilter.field);return ir.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=qs(e.unaryFilter.field);return ir.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=qs(e.unaryFilter.field);return ir.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=qs(e.unaryFilter.field);return ir.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return b(61313);default:return b(60726)}}(e):void 0!==e.fieldFilter?function(e){return ir.create(qs(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return b(58110);default:return b(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return sr.create(e.compositeFilter.filters.map((e=>Ps(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return b(1026)}}(e.compositeFilter.op))}(e):b(30097,{filter:e})}function Fs(e){return ls[e]}function Vs(e){return hs[e]}function Bs(e){return ds[e]}function Us(e){return{fieldPath:e.canonicalString()}}function qs(e){return X.fromServerFormat(e.fieldPath)}function js(e){return e instanceof ir?function(e){if("=="===e.op){if(Bn(e.value))return{unaryFilter:{field:Us(e.field),op:"IS_NAN"}};if(Vn(e.value))return{unaryFilter:{field:Us(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Bn(e.value))return{unaryFilter:{field:Us(e.field),op:"IS_NOT_NAN"}};if(Vn(e.value))return{unaryFilter:{field:Us(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Us(e.field),op:Vs(e.op),value:e.value}}}(e):e instanceof sr?function(e){const t=e.getFilters().map((e=>js(e)));return 1===t.length?t[0]:{compositeFilter:{op:Bs(e.op),filters:t}}}(e):b(54877,{filter:e})}function zs(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function $s(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Gs{constructor(e,t,n,r,i=Q.min(),s=Q.min(),o=sn.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Gs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ks{constructor(e){this.wt=e}}function Qs(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Hs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Is(e,t.key),fields:t.data.value.mapValue.fields,updateTime:gs(e,t.version.toTimestamp()),createTime:gs(e,t.createTime.toTimestamp())}}(e.wt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ws(t.version)};else{if(!t.isUnknownDocument())return b(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:Ws(t.version)}}return r}function Hs(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ws(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Js(e){const t=new K(e.seconds,e.nanoseconds);return Q.fromTimestamp(t)}function Ys(e,t){const n=(t.baseMutations||[]).map((t=>ks(e.wt,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>ks(e.wt,t))),i=K.fromMillis(t.localWriteTimeMs);return new Ui(t.batchId,i,n,r)}function Xs(e){const t=Js(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Js(e.lastLimboFreeSnapshotVersion):Q.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){const t=e.documents.length;return I(1===t,1966,{count:t}),Pr(Or(Ss(e.documents[0])))}(e.query):function(e){return Pr(Ls(e))}(e.query),new Gs(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,sn.fromBase64String(e.resumeToken))}function Zs(e,t){const n=Ws(t.snapshotVersion),r=Ws(t.lastLimboFreeSnapshotVersion);let i;i=Cr(t.target)?Os(e.wt,t.target):Ms(e.wt,t.target).gt;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Tr(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function eo(e){const t=Ls({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ur(t,t.limit,"L"):t}function to(e,t){return new ji(t.largestBatchId,ks(e.wt,t.overlayMutation))}function no(e,t){const n=t.path.lastSegment();return[e,Pe(t.path.popLast()),n]}function ro(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:Ws(r.readTime),documentKey:Pe(r.documentKey.path),largestBatchId:r.largestBatchId}}class io{getBundleMetadata(e,t){return so(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:Js(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return so(e).put(function(e){return{bundleId:e.id,createTime:Ws(vs(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return oo(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:eo(e.bundledQuery),readTime:Js(e.readTime)}}(e)}))}saveNamedQuery(e,t){return oo(e).put(function(e){return{name:e.name,readTime:Ws(vs(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function so(e){return Gt(e,vt)}function oo(e){return Gt(e,wt)}class ao{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){const n=t.uid||"";return new ao(e,n)}getOverlay(e,t){return co(e).get(no(this.userId,t)).next((e=>e?to(this.serializer,e):null))}getOverlays(e,t){const n=ei();return ge.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new ji(t,i);r.push(this.St(e,s))})),ge.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Pe(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(co(e).X(Ot,r))})),ge.waitFor(i)}getOverlaysForCollection(e,t,n){const r=ei(),i=Pe(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return co(e).J(Ot,s).next((e=>{for(const t of e){const e=to(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=ei();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return co(e).te({index:Rt,range:o},((e,t,n)=>{const o=to(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}St(e,t){return co(e).put(function(e,t,n){const[r,i,s]=no(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Ns(e.wt,n.mutation)}}(this.serializer,this.userId,t))}}function co(e){return Gt(e,Nt)}class uo{Dt(e){return Gt(e,Pt)}getSessionToken(e){return this.Dt(e).get("sessionToken").next((e=>{const t=null==e?void 0:e.value;return t?sn.fromUint8Array(t):sn.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class lo{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(cn(e.integerValue));else if("doubleValue"in e){const n=cn(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),Me(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=an(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(un(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?zn(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):qn(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):b(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){const n=e.fields||{};this.Mt(t,55);for(const e of Object.keys(n))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,r;const i=e.fields||{};this.Mt(t,53);const s=Tn,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Mt(t,15),t.xt(cn(o)),this.Nt(s,t),this.Ct(i[s],t)}$t(e,t){const n=e.values||[];this.Mt(t,50);for(const e of n)this.Ct(e,t)}kt(e,t){this.Mt(t,37),Z.fromName(e).path.forEach((e=>{this.Mt(t,60),this.Kt(e,t)}))}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}lo.Wt=new lo;const ho=255;function fo(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function po(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=fo(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class go{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{const e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{const e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){const t=this.tn(e),n=po(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}rn(e){const t=this.tn(e),n=po(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}sn(){this._n(ho),this._n(255)}an(){this.un(ho),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}zt(e){const t=255&e;0===t?(this._n(0),this._n(255)):t===ho?(this._n(ho),this._n(0)):this._n(t)}Jt(e){const t=255&e;0===t?(this.un(0),this.un(255)):t===ho?(this.un(ho),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class mo{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class yo{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class vo{constructor(){this.ln=new go,this.hn=new mo(this.ln),this.Pn=new yo(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}class wo{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}In(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new wo(this.indexId,this.documentKey,this.arrayValue,n)}}function bo(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=_o(e.arrayValue,t.arrayValue),0!==n?n:(n=_o(e.directionalValue,t.directionalValue),0!==n?n:Z.comparator(e.documentKey,t.documentKey)))}function _o(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Io{constructor(e){this.En=new Zt(((e,t)=>X.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.An=[];for(const t of e.filters){const e=t;e.isInequality()?this.En=this.En.add(e):this.An.push(e)}}get Rn(){return this.En.size>1}Vn(e){if(I(e.collectionGroup===this.collectionId,49279),this.Rn)return!1;const t=ne(e);if(void 0!==t&&!this.mn(t))return!1;const n=re(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.mn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.En.size>0){const e=this.En.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.fn(e,t)||!this.gn(this.dn[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.dn.length||!this.gn(this.dn[s++],e))return!1}return!0}pn(){if(this.Rn)return null;let e=new Zt(X.comparator);const t=[];for(const n of this.An)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new se(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new se(n.field,0))}for(const n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new se(n.field,"asc"===n.dir?0:1)));return new te(te.UNKNOWN_ID,this.collectionId,t,ae.empty())}mn(e){for(const t of this.An)if(this.fn(t,e))return!0;return!1}fn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}gn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Eo(e){var t,n;if(I(e instanceof ir||e instanceof sr,20012),e instanceof ir){if(e instanceof wr){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>ir.create(e.field,"==",t))))||[];return sr.create(r,"or")}return e}const r=e.filters.map((e=>Eo(e)));return sr.create(r,e.op)}function To(e){if(0===e.getFilters().length)return[];const t=Ao(Eo(e));return I(xo(t),7391),So(t)||Co(t)?[t]:t.getFilters()}function So(e){return e instanceof ir}function Co(e){return e instanceof sr&&cr(e)}function xo(e){return So(e)||Co(e)||function(e){if(e instanceof sr&&ar(e)){for(const t of e.getFilters())if(!So(t)&&!Co(t))return!1;return!0}return!1}(e)}function Ao(e){if(I(e instanceof ir||e instanceof sr,34018),e instanceof ir)return e;if(1===e.filters.length)return Ao(e.filters[0]);const t=e.filters.map((e=>Ao(e)));let n=sr.create(t,e.op);return n=ko(n),xo(n)?n:(I(n instanceof sr,64498),I(or(n),40251),I(n.filters.length>1,57927),n.filters.reduce(((e,t)=>Do(e,t))))}function Do(e,t){let n;return I(e instanceof ir||e instanceof sr,38388),I(t instanceof ir||t instanceof sr,25473),n=e instanceof ir?t instanceof ir?function(e,t){return sr.create([e,t],"and")}(e,t):No(e,t):t instanceof ir?No(t,e):function(e,t){if(I(e.filters.length>0&&t.filters.length>0,48005),or(e)&&or(t))return dr(e,t.getFilters());const n=ar(e)?e:t,r=ar(e)?t:e,i=n.filters.map((e=>Do(e,r)));return sr.create(i,"or")}(e,t),ko(n)}function No(e,t){if(or(t))return dr(t,e.getFilters());{const n=t.filters.map((t=>Do(e,t)));return sr.create(n,"or")}}function ko(e){if(I(e instanceof ir||e instanceof sr,11850),e instanceof ir)return e;const t=e.getFilters();if(1===t.length)return ko(t[0]);if(ur(e))return e;const n=t.map((e=>ko(e))),r=[];return n.forEach((t=>{t instanceof ir?r.push(t):t instanceof sr&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:sr.create(r,e.op)}class Oo{constructor(){this.yn=new Mo}addToCollectionParentIndex(e,t){return this.yn.add(t),ge.resolve()}getCollectionParents(e,t){return ge.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return ge.resolve()}deleteFieldIndex(e,t){return ge.resolve()}deleteAllFieldIndexes(e){return ge.resolve()}createTargetIndexes(e,t){return ge.resolve()}getDocumentsMatchingTarget(e,t){return ge.resolve(null)}getIndexType(e,t){return ge.resolve(0)}getFieldIndexes(e,t){return ge.resolve([])}getNextCollectionGroupToUpdate(e){return ge.resolve(null)}getMinOffset(e,t){return ge.resolve(le.min())}getMinOffsetFromCollectionGroup(e,t){return ge.resolve(le.min())}updateCollectionGroup(e,t,n){return ge.resolve()}updateIndexEntries(e,t){return ge.resolve()}}class Mo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Zt(J.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Zt(J.comparator)).toArray()}}const Ro="IndexedDbIndexManager",Lo=new Uint8Array(0);class Po{constructor(e,t){this.databaseId=t,this.wn=new Mo,this.bn=new Hr((e=>Tr(e)),((e,t)=>Sr(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.wn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.wn.add(t)}));const i={collectionId:n,parent:Pe(r)};return Fo(e).put(i)}return ge.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[z(t),""],!1,!0);return Fo(e).J(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Be(r.parent))}return n}))}addFieldIndex(e,t){const n=Bo(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Uo(e);return i.next((e=>{n.put(ro(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Bo(e),r=Uo(e),i=Vo(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Bo(e),n=Vo(e),r=Uo(e);return t.X().next((()=>n.X())).next((()=>r.X()))}createTargetIndexes(e,t){return ge.forEach(this.Sn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new Io(t).pn();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Vo(e);let r=!0;const i=new Map;return ge.forEach(this.Sn(t),(t=>this.Dn(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=si();const r=[];return ge.forEach(i,((i,s)=>{m(Ro,`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(i)} to execute ${Tr(t)}`);const o=function(e,t){const n=ne(t);if(void 0===n)return null;for(const t of xr(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),a=function(e,t){const n=new Map;for(const r of re(t))for(const t of xr(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of re(t)){const t=0===i.kind?Ar(e,i.fieldPath,e.startAt):Dr(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Xn(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of re(t)){const t=0===i.kind?Dr(e,i.fieldPath,e.endAt):Ar(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Xn(n,r)}(s,i),l=this.vn(i,s,c),h=this.vn(i,s,u),d=this.Cn(i,s,a),f=this.Fn(i.indexId,o,l,c.inclusive,h,u.inclusive,d);return ge.forEach(f,(i=>n.Z(i,t.limit).next((t=>{t.forEach((t=>{const n=Z.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return ge.resolve(null)}))}Sn(e){let t=this.bn.get(e);return t||(t=0===e.filters.length?[e]:To(sr.create(e.filters,"and")).map((t=>Er(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.bn.set(e,t),t)}Fn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.Mn(t[l/c]):Lo,h=this.xn(e,a,n[l%c],r),d=this.On(e,a,i[l%c],s),f=o.map((t=>this.xn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}xn(e,t,n,r){const i=new wo(e,Z.empty(),t,n);return r?i:i.In()}On(e,t,n,r){const i=new wo(e,Z.empty(),t,n);return r?i.In():i}Dn(e,t){const n=new Io(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.Vn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.Sn(t);return ge.forEach(r,(t=>this.Dn(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Zt(X.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}Nn(e,t){const n=new vo;for(const r of re(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Tn(r.kind);lo.Wt.vt(e,i)}return n.cn()}Mn(e){const t=new vo;return lo.Wt.vt(e,t.Tn(0)),t.cn()}Bn(e,t){const n=new vo;return lo.Wt.vt(Ln(this.databaseId,t),n.Tn(function(e){const t=re(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.cn()}Cn(e,t,n){if(null===n)return[];let r=[];r.push(new vo);let i=0;for(const s of re(e)){const e=n[i++];for(const n of r)if(this.Ln(t,s.fieldPath)&&Fn(e))r=this.kn(r,s,e);else{const t=n.Tn(s.kind);lo.Wt.vt(e,t)}}return this.qn(r)}vn(e,t,n){return this.Cn(e,t,n.position)}qn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}kn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new vo;r.seed(n.cn()),lo.Wt.vt(e,r.Tn(t.kind)),i.push(r)}return i}Ln(e,t){return!!e.filters.find((e=>e instanceof ir&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Bo(e),r=Uo(e);return(t?n.J(_t,IDBKeyRange.bound(t,t)):n.J()).next((e=>{const t=[];return ge.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ae(t.sequenceNumber,new le(Js(t.readTime),new Z(Be(t.documentKey)),t.largestBatchId)):ae.empty(),r=e.fields.map((([e,t])=>new se(X.fromServerFormat(e),t)));return new te(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:V(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Bo(e),i=Uo(e);return this.Qn(e).next((e=>r.J(_t,IDBKeyRange.bound(t,t)).next((t=>ge.forEach(t,(t=>i.put(ro(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return ge.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?ge.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),ge.forEach(i,(n=>this.$n(e,t,n).next((t=>{const i=this.Un(r,n);return t.isEqual(i)?ge.resolve():this.Kn(e,r,n,t,i)})))))))}))}Wn(e,t,n,r){return Vo(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Bn(n,t.key),documentKey:t.key.path.toArray()})}Gn(e,t,n,r){return Vo(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Bn(n,t.key),t.key.path.toArray()])}$n(e,t,n){const r=Vo(e);let i=new Zt(bo);return r.te({index:At,range:IDBKeyRange.only([n.indexId,this.uid,this.Bn(n,t)])},((e,r)=>{i=i.add(new wo(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}Un(e,t){let n=new Zt(bo);const r=this.Nn(t,e);if(null==r)return n;const i=ne(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Fn(s))for(const i of s.arrayValue.values||[])n=n.add(new wo(t.indexId,e.key,this.Mn(i),r))}else n=n.add(new wo(t.indexId,e.key,Lo,r));return n}Kn(e,t,n,r,i){m(Ro,"Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=tn(s),c=tn(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=tn(o)):t?(i(a),a=tn(s)):(a=tn(s),c=tn(o))}}(r,i,bo,(r=>{s.push(this.Wn(e,t,n,r))}),(r=>{s.push(this.Gn(e,t,n,r))})),ge.waitFor(s)}Qn(e){let t=1;return Uo(e).te({index:Tt,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>bo(e,t))).filter(((e,t,n)=>!t||0!==bo(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=bo(i,e),s=bo(i,t);if(0===n)r[0]=e.In();else if(n>0&&s<0)r.push(i),r.push(i.In());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.zn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,Lo,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,Lo,[]];i.push(IDBKeyRange.bound(t,n))}return i}zn(e,t){return bo(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(qo)}getMinOffset(e,t){return ge.mapArray(this.Sn(t),(t=>this.Dn(e,t).next((e=>e||b(44426))))).next(qo)}}function Fo(e){return Gt(e,gt)}function Vo(e){return Gt(e,Ct)}function Bo(e){return Gt(e,bt)}function Uo(e){return Gt(e,It)}function qo(e){I(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;he(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new le(t.readTime,t.documentKey,n)}const jo={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zo=41943040;class $o{static withCacheSize(e){return new $o(e,$o.DEFAULT_COLLECTION_PERCENTILE,$o.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function Go(e,t,n){const r=e.store($e),i=e.store(Ye),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.te({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{I(1===a,47070,{batchId:n.batchId})})));const u=[];for(const e of n.mutations){const r=We(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ge.waitFor(s).next((()=>u))}function Ko(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw b(14731);t=e.noDocument}return JSON.stringify(t).length}$o.DEFAULT_COLLECTION_PERCENTILE=10,$o.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$o.DEFAULT=new $o(zo,$o.DEFAULT_COLLECTION_PERCENTILE,$o.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$o.DISABLED=new $o(-1,0,0);class Qo{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.jn={}}static bt(e,t,n,r){I(""!==e.uid,64387);const i=e.isAuthenticated()?e.uid:"";return new Qo(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Wo(e).te({index:Ke,range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Jo(e),s=Wo(e);return s.add({}).next((o=>{I("number"==typeof o,49019);const a=new Ui(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Ns(e.wt,t))),i=n.mutations.map((t=>Ns(e.wt,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let l=new Zt(((e,t)=>V(e.canonicalString(),t.canonicalString())));for(const e of r){const t=We(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Je))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.jn[o]=a.keys()})),ge.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Wo(e).get(t).next((e=>e?(I(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),Ys(this.serializer,e)):null))}Hn(e,t){return this.jn[t]?ge.resolve(this.jn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.jn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Wo(e).te({index:Ke,range:r},((e,t,r)=>{t.userId===this.userId&&(I(t.batchId>=n,47524,{Jn:n}),i=Ys(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=ke;return Wo(e).te({index:Ke,range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ke],[this.userId,Number.POSITIVE_INFINITY]);return Wo(e).J(Ke,t).next((e=>e.map((e=>Ys(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=He(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Jo(e).te({range:r},((n,r,s)=>{const[o,a,c]=n,u=Be(a);if(o===this.userId&&t.path.isEqual(u))return Wo(e).get(c).next((e=>{if(!e)throw b(61480,{Yn:n,batchId:c});I(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:c}),i.push(Ys(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Zt(V);const r=[];return t.forEach((t=>{const i=He(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Jo(e).te({range:s},((e,r,i)=>{const[s,o,a]=e,c=Be(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),ge.waitFor(r).next((()=>this.Zn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=He(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Zt(V);return Jo(e).te({range:s},((e,t,i)=>{const[s,a,c]=e,u=Be(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Zn(e,o)))}Zn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Wo(e).get(t).next((e=>{if(null===e)throw b(35274,{batchId:t});I(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(Ys(this.serializer,e))})))})),ge.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Go(e.he,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Xn(t.batchId)})),ge.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Xn(e){delete this.jn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ge.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Jo(e).te({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Be(e[1]);r.push(t)}else n.done()})).next((()=>{I(0===r.length,56720,{er:r.map((e=>e.canonicalString()))})}))}))}containsKey(e,t){return Ho(e,this.userId,t)}tr(e){return Yo(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:ke,lastStreamToken:""}))}}function Ho(e,t,n){const r=He(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Jo(e).te({range:s,ee:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Wo(e){return Gt(e,$e)}function Jo(e){return Gt(e,Ye)}function Yo(e){return Gt(e,ze)}class Xo{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new Xo(0)}static ir(){return new Xo(-1)}}class Zo{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.sr(e).next((t=>{const n=new Xo(t.highestTargetId);return t.highestTargetId=n.next(),this._r(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.sr(e).next((e=>Q.fromTimestamp(new K(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.sr(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.sr(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this._r(e,r))))}addTargetData(e,t){return this.ar(e,t).next((()=>this.sr(e).next((n=>(n.targetCount+=1,this.ur(t,n),this._r(e,n))))))}updateTargetData(e,t){return this.ar(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ea(e).delete(t.targetId))).next((()=>this.sr(e))).next((t=>(I(t.targetCount>0,8065),t.targetCount-=1,this._r(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return ea(e).te(((s,o)=>{const a=Xs(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>ge.waitFor(i))).next((()=>r))}forEachTarget(e,t){return ea(e).te(((e,n)=>{const r=Xs(n);t(r)}))}sr(e){return ta(e).get(ft).next((e=>(I(null!==e,2888),e)))}_r(e,t){return ta(e).put(ft,t)}ar(e,t){return ea(e).put(Zs(this.serializer,t))}ur(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.sr(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Tr(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ea(e).te({range:r,index:at},((e,n,r)=>{const s=Xs(n);Sr(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=na(e);return t.forEach((t=>{const s=Pe(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),ge.waitFor(r)}removeMatchingKeys(e,t,n){const r=na(e);return ge.forEach(t,(t=>{const i=Pe(t.path);return ge.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=na(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=na(e);let i=si();return r.te({range:n,ee:!0},((e,t,n)=>{const r=Be(e[1]),s=new Z(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Pe(t.path),r=IDBKeyRange.bound([n],[z(n)],!1,!0);let i=0;return na(e).te({index:ht,ee:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}Rt(e,t){return ea(e).get(t).next((e=>e?Xs(e):null))}}function ea(e){return Gt(e,ot)}function ta(e){return Gt(e,pt)}function na(e){return Gt(e,ut)}const ra="LruGarbageCollector",ia=1048576;function sa([e,t],[n,r]){const i=V(e,n);return 0===i?V(t,r):i}class oa{constructor(e){this.cr=e,this.buffer=new Zt(sa),this.lr=0}hr(){return++this.lr}Pr(e){const t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();sa(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class aa{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Tr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return null!==this.Tr}Ir(e){m(ra,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(()=>r(this,void 0,void 0,(function*(){this.Tr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ie(e)?m(ra,"Ignoring IndexedDB error during garbage collection: ",e):yield pe(e)}yield this.Ir(3e5)}))))}}class ca{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return ge.resolve(Ne.le);const n=new oa(t);return this.Er.forEachTarget(e,(e=>n.Pr(e.sequenceNumber))).next((()=>this.Er.Ar(e,(e=>n.Pr(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Er.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(m("LruGarbageCollector","Garbage collection skipped; disabled"),ge.resolve(jo)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(m("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jo):this.Rr(e,t)))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let n,r,i,s,a,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(m("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,a=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),g()<=o.LogLevel.DEBUG&&m("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(a-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),ge.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function ua(e,t){return new ca(e,t)}class la{constructor(e,t){this.db=e,this.garbageCollector=ua(this,t)}dr(e){const t=this.Vr(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Vr(e){let t=0;return this.Ar(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ar(e,t){return this.mr(e,((e,n)=>t(n)))}addReference(e,t,n){return ha(e,n)}removeReference(e,t,n){return ha(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ha(e,t)}gr(e,t){return function(e,t){let n=!1;return Yo(e).ne((r=>Ho(e,r,t).next((e=>(e&&(n=!0),ge.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.mr(e,((s,o)=>{if(o<=t){const t=this.gr(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Q.min()),na(e).delete(function(e){return[0,Pe(e.path)]}(s)))))}));r.push(t)}})).next((()=>ge.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ha(e,t)}mr(e,t){const n=na(e);let r,i=Ne.le;return n.te({index:ht},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Ne.le&&t(new Z(Be(r)),i),i=o,r=s):i=Ne.le})).next((()=>{i!==Ne.le&&t(new Z(Be(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ha(e,t){return na(e).put(function(e,t){return{targetId:0,path:Pe(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class da{constructor(){this.changes=new Hr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Yn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ge.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class fa{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ya(e).put(n)}removeEntry(e,t,n){return ya(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Hs(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.pr(e,n))))}getEntry(e,t){let n=Yn.newInvalidDocument(t);return ya(e).te({index:et,range:IDBKeyRange.only(va(t))},((e,r)=>{n=this.yr(t,r)})).next((()=>n))}wr(e,t){let n={size:0,document:Yn.newInvalidDocument(t)};return ya(e).te({index:et,range:IDBKeyRange.only(va(t))},((e,r)=>{n={document:this.yr(t,r),size:Ko(r)}})).next((()=>n))}getEntries(e,t){let n=Jr();return this.br(e,t,((e,t)=>{const r=this.yr(e,t);n=n.insert(e,r)})).next((()=>n))}Sr(e,t){let n=Jr(),r=new Jt(Z.comparator);return this.br(e,t,((e,t)=>{const i=this.yr(e,t);n=n.insert(e,i),r=r.insert(e,Ko(t))})).next((()=>({documents:n,Dr:r})))}br(e,t,n){if(t.isEmpty())return ge.resolve();let r=new Zt(ba);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(va(r.first()),va(r.last())),s=r.getIterator();let o=s.getNext();return ya(e).te({index:et,range:i},((e,t,r)=>{const i=Z.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&ba(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.H(va(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),Hs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ya(e).J(IDBKeyRange.bound(o,a,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=Jr();for(const i of e){const e=this.yr(Z.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&($r(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=Jr();const s=wa(t,n),o=wa(t,le.max());return ya(e).te({index:nt,range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.yr(Z.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new ga(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return ma(e).get(st).next((e=>(I(!!e,20021),e)))}pr(e,t){return ma(e).put(st,t)}yr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ds(e.wt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Z.fromSegments(t.noDocument.path),r=Js(t.noDocument.readTime);n=Yn.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return b(56709);{const e=Z.fromSegments(t.unknownDocument.path),r=Js(t.unknownDocument.version);n=Yn.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new K(e[0],e[1]);return Q.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Q.min()))return e}return Yn.newInvalidDocument(e)}}function pa(e){return new fa(e)}class ga extends da{constructor(e,t){super(),this.vr=e,this.trackRemovals=t,this.Cr=new Hr((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Zt(((e,t)=>V(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Cr.get(i);if(t.push(this.vr.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Qs(this.vr.serializer,s);r=r.add(i.path.popLast());const c=Ko(a);n+=c-o.size,t.push(this.vr.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Qs(this.vr.serializer,s.convertToNoDocument(Q.min()));t.push(this.vr.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.vr.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.vr.updateMetadata(e,n)),ge.waitFor(t)}getFromCache(e,t){return this.vr.wr(e,t).next((e=>(this.Cr.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.vr.Sr(e,t).next((({documents:e,Dr:t})=>(t.forEach(((t,n)=>{this.Cr.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function ma(e){return Gt(e,it)}function ya(e){return Gt(e,Xe)}function va(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function wa(e,t){const n=t.documentKey.path.toArray();return[e,Hs(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function ba(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=V(n[e],r[e]),i)return i;return i=V(n.length,r.length),i||(i=V(n[n.length-2],r[r.length-2]),i||V(n[n.length-1],r[r.length-1]))}class _a{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ia{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Ni(n.mutation,e,nn.empty(),K.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,si()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=si()){const r=ei();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Xr();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=ei();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,si())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Jr();const s=ni(),o=ni();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Ri)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Ni(o.mutation,t,o.mutation.getFieldMask(),K.now())):s.set(t.key,nn.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new _a(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=ni();let r=new Jt(((e,t)=>e-t)),i=si();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||nn.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||si()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ti();c.forEach((e=>{if(!i.has(e)){const r=Ai(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return ge.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Z.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Rr(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ge.resolve(ei());let o=ee,a=i;return s.next((t=>ge.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ge.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,si()))).next((e=>({batchId:o,changes:Zr(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Z(t)).next((e=>{let t=Xr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Xr();return this.indexManager.getCollectionParents(e,i).next((o=>ge.forEach(o,(o=>{const a=function(e,t){return new Nr(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Yn.newInvalidDocument(r)))}));let n=Xr();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Ni(s.mutation,r,nn.empty(),K.now()),$r(t,r)&&(n=n.insert(e,r))})),n}))}}class Ea{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return ge.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:vs(e.createTime)}}(t)),ge.resolve()}getNamedQuery(e,t){return ge.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,function(e){return{name:e.name,query:eo(e.bundledQuery),readTime:vs(e.readTime)}}(t)),ge.resolve()}}class Ta{constructor(){this.overlays=new Jt(Z.comparator),this.Or=new Map}getOverlay(e,t){return ge.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ei();return ge.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.St(e,t,r)})),ge.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Or.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Or.delete(n)),ge.resolve()}getOverlaysForCollection(e,t,n){const r=ei(),i=t.length+1,s=new Z(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ge.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Jt(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=ei(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=ei(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return ge.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Or.get(r.largestBatchId).delete(n.key);this.Or.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ji(t,n));let i=this.Or.get(t);void 0===i&&(i=si(),this.Or.set(t,i)),this.Or.set(t,i.add(n.key))}}class Sa{constructor(){this.sessionToken=sn.EMPTY_BYTE_STRING}getSessionToken(e){return ge.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ge.resolve()}}class Ca{constructor(){this.Nr=new Zt(xa.Br),this.Lr=new Zt(xa.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){const n=new xa(e,t);this.Nr=this.Nr.add(n),this.Lr=this.Lr.add(n)}qr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Qr(new xa(e,t))}$r(e,t){e.forEach((e=>this.removeReference(e,t)))}Ur(e){const t=new Z(new J([])),n=new xa(t,e),r=new xa(t,e+1),i=[];return this.Lr.forEachInRange([n,r],(e=>{this.Qr(e),i.push(e.key)})),i}Kr(){this.Nr.forEach((e=>this.Qr(e)))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){const t=new Z(new J([])),n=new xa(t,e),r=new xa(t,e+1);let i=si();return this.Lr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new xa(e,0),n=this.Nr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class xa{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return Z.comparator(e.key,t.key)||V(e.Gr,t.Gr)}static kr(e,t){return V(e.Gr,t.Gr)||Z.comparator(e.key,t.key)}}class Aa{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new Zt(xa.Br)}checkEmpty(e){return ge.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ui(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.zr=this.zr.add(new xa(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ge.resolve(s)}lookupMutationBatch(e,t){return ge.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Hr(n),i=r<0?0:r;return ge.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ge.resolve(0===this.mutationQueue.length?ke:this.Jn-1)}getAllMutationBatches(e){return ge.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new xa(t,0),r=new xa(t,Number.POSITIVE_INFINITY),i=[];return this.zr.forEachInRange([n,r],(e=>{const t=this.jr(e.Gr);i.push(t)})),ge.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Zt(V);return t.forEach((e=>{const t=new xa(e,0),r=new xa(e,Number.POSITIVE_INFINITY);this.zr.forEachInRange([t,r],(e=>{n=n.add(e.Gr)}))})),ge.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Z.isDocumentKey(i)||(i=i.child(""));const s=new xa(new Z(i),0);let o=new Zt(V);return this.zr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Gr)),!0)}),s),ge.resolve(this.Jr(o))}Jr(e){const t=[];return e.forEach((e=>{const n=this.jr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){I(0===this.Yr(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.zr;return ge.forEach(t.mutations,(r=>{const i=new xa(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.zr=n}))}Xn(e){}containsKey(e,t){const n=new xa(t,0),r=this.zr.firstAfterOrEqual(n);return ge.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ge.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}jr(e){const t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Da{constructor(e){this.Zr=e,this.docs=new Jt(Z.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Zr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ge.resolve(n?n.document.mutableCopy():Yn.newInvalidDocument(t))}getEntries(e,t){let n=Jr();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Yn.newInvalidDocument(e))})),ge.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Jr();const s=t.path,o=new Z(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||he(ue(o),n)<=0||(r.has(o.key)||$r(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ge.resolve(i)}getAllFromCollectionGroup(e,t,n,r){b(9500)}Xr(e,t){return ge.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Na(this)}getSize(e){return ge.resolve(this.size)}}class Na extends da{constructor(e){super(),this.vr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.vr.addEntry(e,r)):this.vr.removeEntry(n)})),ge.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}}class ka{constructor(e){this.persistence=e,this.ei=new Hr((e=>Tr(e)),Sr),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.ti=0,this.ni=new Ca,this.targetCount=0,this.ri=Xo.rr()}forEachTarget(e,t){return this.ei.forEach(((e,n)=>t(n))),ge.resolve()}getLastRemoteSnapshotVersion(e){return ge.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ge.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),ge.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ti&&(this.ti=t),ge.resolve()}ar(e){this.ei.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ri=new Xo(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,ge.resolve()}updateTargetData(e,t){return this.ar(t),ge.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,ge.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.ei.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ei.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),ge.waitFor(i).next((()=>r))}getTargetCount(e){return ge.resolve(this.targetCount)}getTargetData(e,t){const n=this.ei.get(t)||null;return ge.resolve(n)}addMatchingKeys(e,t,n){return this.ni.qr(t,n),ge.resolve()}removeMatchingKeys(e,t,n){this.ni.$r(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),ge.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),ge.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ni.Wr(t);return ge.resolve(n)}containsKey(e,t){return ge.resolve(this.ni.containsKey(t))}}class Oa{constructor(e,t){this.ii={},this.overlays={},this.si=new Ne(0),this.oi=!1,this.oi=!0,this._i=new Sa,this.referenceDelegate=e(this),this.ai=new ka(this),this.indexManager=new Oo,this.remoteDocumentCache=function(e){return new Da(e)}((e=>this.referenceDelegate.ui(e))),this.serializer=new Ks(t),this.ci=new Ea(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ta,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ii[e.toKey()];return n||(n=new Aa(t,this.referenceDelegate),this.ii[e.toKey()]=n),n}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,n){m("MemoryPersistence","Starting transaction:",e);const r=new Ma(this.si.next());return this.referenceDelegate.li(),n(r).next((e=>this.referenceDelegate.hi(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Pi(e,t){return ge.or(Object.values(this.ii).map((n=>()=>n.containsKey(e,t))))}}class Ma extends fe{constructor(e){super(),this.currentSequenceNumber=e}}class Ra{constructor(e){this.persistence=e,this.Ti=new Ca,this.Ii=null}static Ei(e){return new Ra(e)}get di(){if(this.Ii)return this.Ii;throw b(60996)}addReference(e,t,n){return this.Ti.addReference(n,t),this.di.delete(n.toString()),ge.resolve()}removeReference(e,t,n){return this.Ti.removeReference(n,t),this.di.add(n.toString()),ge.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),ge.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach((e=>this.di.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.di.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}li(){this.Ii=new Set}hi(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ge.forEach(this.di,(n=>{const r=Z.fromPath(n);return this.Ai(e,r).next((e=>{e||t.removeEntry(r,Q.min())}))})).next((()=>(this.Ii=null,t.apply(e))))}updateLimboDocument(e,t){return this.Ai(e,t).next((e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())}))}ui(e){return 0}Ai(e,t){return ge.or([()=>ge.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}}class La{constructor(e,t){this.persistence=e,this.Ri=new Hr((e=>Pe(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=ua(this,t)}static Ei(e,t){return new La(e,t)}li(){}hi(e){return ge.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Vr(e){let t=0;return this.Ar(e,(e=>{t++})).next((()=>t))}Ar(e,t){return ge.forEach(this.Ri,((n,r)=>this.gr(e,n,r).next((e=>e?ge.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Xr(e,(r=>this.gr(e,r,t).next((e=>{e||(n++,i.removeEntry(r,Q.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),ge.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),ge.resolve()}removeReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),ge.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),ge.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Rn(e.data.value)),t}gr(e,t,n){return ge.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.Ri.get(t);return ge.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Pa{constructor(e){this.serializer=e}q(e,t,n,r){const i=new ye("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(qe)}(e),function(e){e.createObjectStore(ze,{keyPath:"userId"}),e.createObjectStore($e,{keyPath:Ge,autoIncrement:!0}).createIndex(Ke,Qe,{unique:!0}),e.createObjectStore(Ye)}(e),Fa(e),function(e){e.createObjectStore(Ue)}(e));let s=ge.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(ut),e.deleteObjectStore(ot),e.deleteObjectStore(pt)}(e),Fa(e)),s=s.next((()=>function(e){const t=e.store(pt),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Q.min().toTimestamp(),targetCount:0};return t.put(ft,n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store($e).J().next((n=>{e.deleteObjectStore($e),e.createObjectStore($e,{keyPath:Ge,autoIncrement:!0}).createIndex(Ke,Qe,{unique:!0});const r=t.store($e),i=n.map((e=>r.put(e)));return ge.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore(yt,{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Vi(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore(it)}(e),this.mi(i))))),n<7&&r>=7&&(s=s.next((()=>this.fi(i)))),n<8&&r>=8&&(s=s.next((()=>this.gi(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.pi(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore(vt,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(wt,{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore(Nt,{keyPath:kt});t.createIndex(Ot,Mt,{unique:!1}),t.createIndex(Rt,Lt,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore(Xe,{keyPath:Ze});t.createIndex(et,tt),t.createIndex(nt,rt)}(e))).next((()=>this.yi(e,i))).next((()=>e.deleteObjectStore(Ue)))),n<14&&r>=14&&(s=s.next((()=>this.wi(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore(bt,{keyPath:"indexId",autoIncrement:!0}).createIndex(_t,"collectionGroup",{unique:!1}),e.createObjectStore(It,{keyPath:Et}).createIndex(Tt,St,{unique:!1}),e.createObjectStore(Ct,{keyPath:xt}).createIndex(At,Dt,{unique:!1})}(e)))),n<16&&r>=16&&(s=s.next((()=>{t.objectStore(It).clear()})).next((()=>{t.objectStore(Ct).clear()}))),n<17&&r>=17&&(s=s.next((()=>{!function(e){e.createObjectStore(Pt,{keyPath:"name"})}(e)}))),s}mi(e){let t=0;return e.store(Ue).te(((e,n)=>{t+=Ko(n)})).next((()=>{const n={byteSize:t};return e.store(it).put(st,n)}))}Vi(e){const t=e.store(ze),n=e.store($e);return t.J().next((t=>ge.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,ke],[t.userId,t.lastAcknowledgedBatchId]);return n.J(Ke,r).next((n=>ge.forEach(n,(n=>{I(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});const r=Ys(this.serializer,n);return Go(e,t.userId,r).next((()=>{}))}))))}))))}fi(e){const t=e.store(ut),n=e.store(Ue);return e.store(pt).get(ft).next((e=>{const r=[];return n.te(((n,i)=>{const s=new J(n),o=function(e){return[0,Pe(e)]}(s);r.push(t.get(o).next((n=>n?ge.resolve():(n=>t.put({targetId:0,path:Pe(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>ge.waitFor(r)))}))}gi(e,t){e.createObjectStore(gt,{keyPath:mt});const n=t.store(gt),r=new Mo,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Pe(r)})}};return t.store(Ue).te({ee:!0},((e,t)=>{const n=new J(e);return i(n.popLast())})).next((()=>t.store(Ye).te({ee:!0},(([e,t,n],r)=>{const s=Be(t);return i(s.popLast())}))))}pi(e){const t=e.store(ot);return t.te(((e,n)=>{const r=Xs(n),i=Zs(this.serializer,r);return t.put(i)}))}yi(e,t){const n=t.store(Ue),r=[];return n.te(((e,n)=>{const i=t.store(Xe),s=function(e){return e.document?new Z(J.fromString(e.document.name).popFirst(5)):e.noDocument?Z.fromSegments(e.noDocument.path):e.unknownDocument?Z.fromSegments(e.unknownDocument.path):b(36783)}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>ge.waitFor(r)))}wi(e,t){const n=t.store($e),r=pa(this.serializer),i=new Oa(Ra.Ei,this.serializer.wt);return n.J().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:si();Ys(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),ge.forEach(n,((e,n)=>{const s=new d(n),o=ao.bt(this.serializer,s),a=i.getIndexManager(s),c=Qo.bt(s,this.serializer,a,i.referenceDelegate);return new Ia(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new $t(t,Ne.le),e).next()}))}))}}function Fa(e){e.createObjectStore(ut,{keyPath:lt}).createIndex(ht,dt,{unique:!0}),e.createObjectStore(ot,{keyPath:"targetId"}).createIndex(at,ct,{unique:!0}),e.createObjectStore(pt)}const Va="IndexedDbPersistence",Ba=18e5,Ua=5e3,qa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ja="main";class za{constructor(e,t,n,r,i,s,o,a,c,u,l=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.bi=i,this.window=s,this.document=o,this.Si=c,this.Di=u,this.Ci=l,this.si=null,this.oi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Mi=null,this.xi=null,this.Oi=Number.NEGATIVE_INFINITY,this.Ni=e=>Promise.resolve(),!za.C())throw new S(T.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new la(this,r),this.Bi=t+ja,this.serializer=new Ks(a),this.Li=new ve(this.Bi,this.Ci,new Pa(this.serializer)),this._i=new uo,this.ai=new Zo(this.referenceDelegate,this.serializer),this.remoteDocumentCache=pa(this.serializer),this.ci=new io,this.window&&this.window.localStorage?this.ki=this.window.localStorage:(this.ki=null,!1===u&&y(Va,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.qi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new S(T.FAILED_PRECONDITION,qa);return this.Qi(),this.$i(),this.Ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.ai.getHighestSequenceNumber(e)))})).then((e=>{this.si=new Ne(e,this.Si)})).then((()=>{this.oi=!0})).catch((e=>(this.Li&&this.Li.close(),Promise.reject(e))))}Ki(e){return this.Ni=t=>r(this,void 0,void 0,(function*(){if(this.started)return e(t)})),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Li.U((t=>r(this,void 0,void 0,(function*(){null===t.newVersion&&(yield e())}))))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.bi.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){this.started&&(yield this.qi())})))))}qi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Ga(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Wi(e).next((e=>{e||(this.isPrimary=!1,this.bi.enqueueRetryable((()=>this.Ni(!1))))}))})).next((()=>this.Gi(e))).next((t=>this.isPrimary&&!t?this.zi(e).next((()=>!1)):!!t&&this.ji(e).next((()=>!0)))))).catch((e=>{if(Ie(e))return m(Va,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return m(Va,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.bi.enqueueRetryable((()=>this.Ni(e))),this.isPrimary=e}))}Wi(e){return $a(e).get(je).next((e=>ge.resolve(this.Hi(e))))}Ji(e){return Ga(e).delete(this.clientId)}Yi(){return r(this,void 0,void 0,(function*(){if(this.isPrimary&&!this.Zi(this.Oi,Ba)){this.Oi=Date.now();const e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Gt(e,yt);return t.J().next((e=>{const n=this.Xi(e,Ba),r=e.filter((e=>-1===n.indexOf(e)));return ge.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.ki)for(const t of e)this.ki.removeItem(this.es(t.clientId))}}))}Ui(){this.xi=this.bi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.qi().then((()=>this.Yi())).then((()=>this.Ui()))))}Hi(e){return!!e&&e.ownerId===this.clientId}Gi(e){return this.Di?ge.resolve(!0):$a(e).get(je).next((t=>{if(null!==t&&this.Zi(t.leaseTimestampMs,Ua)&&!this.ts(t.ownerId)){if(this.Hi(t)&&this.networkEnabled)return!0;if(!this.Hi(t)){if(!t.allowTabSynchronization)throw new S(T.FAILED_PRECONDITION,qa);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ga(e).J().next((e=>void 0===this.Xi(e,Ua).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&m(Va,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}shutdown(){return r(this,void 0,void 0,(function*(){this.oi=!1,this.ns(),this.xi&&(this.xi.cancel(),this.xi=null),this.rs(),this.ss(),yield this.Li.runTransaction("shutdown","readwrite",[qe,yt],(e=>{const t=new $t(e,Ne.le);return this.zi(t).next((()=>this.Ji(t)))})),this.Li.close(),this._s()}))}Xi(e,t){return e.filter((e=>this.Zi(e.updateTimeMs,t)&&!this.ts(e.clientId)))}us(){return this.runTransaction("getActiveClients","readonly",(e=>Ga(e).J().next((e=>this.Xi(e,Ba).map((e=>e.clientId))))))}get started(){return this.oi}getGlobalsCache(){return this._i}getMutationQueue(e,t){return Qo.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Po(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return ao.bt(this.serializer,e)}getBundleCache(){return this.ci}runTransaction(e,t,n){m(Va,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 17===e?zt:16===e?jt:15===e?qt:14===e?Ut:13===e?Bt:12===e?Vt:11===e?Ft:void b(60245)}(this.Ci);let s;return this.Li.runTransaction(e,r,i,(r=>(s=new $t(r,this.si?this.si.next():Ne.le),"readwrite-primary"===t?this.Wi(s).next((e=>!!e||this.Gi(s))).next((t=>{if(!t)throw y(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.bi.enqueueRetryable((()=>this.Ni(!1))),new S(T.FAILED_PRECONDITION,de);return n(s)})).next((e=>this.ji(s).next((()=>e)))):this.cs(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}cs(e){return $a(e).get(je).next((e=>{if(null!==e&&this.Zi(e.leaseTimestampMs,Ua)&&!this.ts(e.ownerId)&&!this.Hi(e)&&!(this.Di||this.allowTabSynchronization&&e.allowTabSynchronization))throw new S(T.FAILED_PRECONDITION,qa)}))}ji(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return $a(e).put(je,t)}static C(){return ve.C()}zi(e){const t=$a(e);return t.get(je).next((e=>this.Hi(e)?(m(Va,"Releasing primary lease."),t.delete(je)):ge.resolve()))}Zi(e,t){const n=Date.now();return!(e<n-t||e>n&&(y(`Detected an update time that is in the future: ${e} > ${n}`),1))}Qi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Mi=()=>{this.bi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.qi())))},this.document.addEventListener("visibilitychange",this.Mi),this.inForeground="visible"===this.document.visibilityState)}rs(){this.Mi&&(this.document.removeEventListener("visibilitychange",this.Mi),this.Mi=null)}$i(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Fi=()=>{this.ns();const e=/(?:Version|Mobile)\/1[456]/;a.isSafari()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.bi.enterRestrictedMode(!0),this.bi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Fi))}ss(){this.Fi&&(this.window.removeEventListener("pagehide",this.Fi),this.Fi=null)}ts(e){var t;try{const n=null!==(null===(t=this.ki)||void 0===t?void 0:t.getItem(this.es(e)));return m(Va,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return y(Va,"Failed to get zombied client id.",e),!1}}ns(){if(this.ki)try{this.ki.setItem(this.es(this.clientId),String(Date.now()))}catch(e){y("Failed to set zombie client id.",e)}}_s(){if(this.ki)try{this.ki.removeItem(this.es(this.clientId))}catch(e){}}es(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function $a(e){return Gt(e,qe)}function Ga(e){return Gt(e,yt)}function Ka(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Qa{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ls=n,this.hs=r}static Ps(e,t){let n=si(),r=si();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Qa(e,t.fromCache,n,r)}}class Ha{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Wa{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=a.isSafari()?8:we(a.getUA())>0?6:4}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Rs(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Vs(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Ha;return this.fs(e,t,n).next((r=>{if(i.result=r,this.Is)return this.gs(e,t,n,r.size)}))})).next((()=>i.result))}gs(e,t,n,r){return n.documentReadCount<this.Es?(g()<=o.LogLevel.DEBUG&&m("QueryEngine","SDK will not create cache indexes for query:",zr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),ge.resolve()):(g()<=o.LogLevel.DEBUG&&m("QueryEngine","Query:",zr(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(g()<=o.LogLevel.DEBUG&&m("QueryEngine","The SDK decides to create cache indexes for query:",zr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pr(t))):ge.resolve())}Rs(e,t){if(Mr(t))return ge.resolve(null);let n=Pr(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Ur(t,null,"F"),n=Pr(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=si(...r);return this.As.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ps(t,r);return this.ys(t,s,i,n.readTime)?this.Rs(e,Ur(t,null,"F")):this.ws(e,s,t,n)}))))})))))}Vs(e,t,n,r){return Mr(t)||r.isEqual(Q.min())?ge.resolve(null):this.As.getDocuments(e,n).next((i=>{const s=this.ps(t,i);return this.ys(t,s,n,r)?ge.resolve(null):(g()<=o.LogLevel.DEBUG&&m("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),zr(t)),this.ws(e,s,t,ce(r,ee)).next((e=>e)))}))}ps(e,t){let n=new Zt(Kr(e));return t.forEach(((t,r)=>{$r(e,r)&&(n=n.add(r))})),n}ys(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}fs(e,t,n){return g()<=o.LogLevel.DEBUG&&m("QueryEngine","Using full collection scan to execute query:",zr(t)),this.As.getDocumentsMatchingQuery(e,t,le.min(),n)}ws(e,t,n,r){return this.As.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const Ja="LocalStore";class Ya{constructor(e,t,n,r){this.persistence=e,this.bs=t,this.serializer=r,this.Ss=new Jt(V),this.Ds=new Hr((e=>Tr(e)),Sr),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(n)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ia(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ss)))}}function Xa(e,t,n,r){return new Ya(e,t,n,r)}function Za(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);return yield n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Fs(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=si();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Ms:e,removedBatchIds:i,addedBatchIds:s})))}))}))}))}function ec(e){const t=E(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.ai.getLastRemoteSnapshotVersion(e)))}function tc(e,t,n){let r=si(),i=si();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Jr();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Q.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):m(Ja,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{xs:r,Os:i}}))}function nc(e,t){const n=E(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=ke),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function rc(e,t){const n=E(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.ai.getTargetData(e,t).next((i=>i?(r=i,ge.resolve(r)):n.ai.allocateTargetId(e).next((i=>(r=new Gs(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.ai.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ss.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ss=n.Ss.insert(e.targetId,e),n.Ds.set(t,e.targetId)),e}))}function ic(e,t,n){return r(this,void 0,void 0,(function*(){const r=E(e),i=r.Ss.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i))))}catch(e){if(!Ie(e))throw e;m(Ja,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ss=r.Ss.remove(t),r.Ds.delete(i.target)}))}function sc(e,t,n){const r=E(e);let i=Q.min(),s=si();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=E(e),i=r.Ds.get(n);return void 0!==i?ge.resolve(r.Ss.get(i)):r.ai.getTargetData(t,n)}(r,e,Pr(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.ai.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.bs.getDocumentsMatchingQuery(e,t,n?i:Q.min(),n?s:si()))).next((e=>(cc(r,Gr(t),e),{documents:e,Ns:s})))))}function oc(e,t){const n=E(e),r=E(n.ai),i=n.Ss.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Rt(e,t).next((e=>e?e.target:null))))}function ac(e,t){const n=E(e),r=n.vs.get(t)||Q.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Cs.getAllFromCollectionGroup(e,t,ce(r,ee),Number.MAX_SAFE_INTEGER))).then((e=>(cc(n,t,e),e)))}function cc(e,t,n){let r=e.vs.get(t)||Q.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.vs.set(t,r)}function uc(e,t){return r(this,arguments,void 0,(function*(e,t,n=si()){const r=yield rc(e,Pr(eo(t.bundledQuery))),i=E(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=vs(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.ci.saveNamedQuery(e,t);const o=r.withResumeToken(sn.EMPTY_BYTE_STRING,s);return i.Ss=i.Ss.insert(o.targetId,o),i.ai.updateTargetData(e,o).next((()=>i.ai.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.ai.addMatchingKeys(e,n,r.targetId))).next((()=>i.ci.saveNamedQuery(e,t)))}))}))}const lc="firestore_clients";function hc(e,t){return`${lc}_${e}_${t}`}const dc="firestore_mutations";function fc(e,t,n){let r=`${dc}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}const pc="firestore_targets";function gc(e,t){return`${pc}_${e}_${t}`}const mc="SharedClientState";class yc{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static qs(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new S(r.error.code,r.error.message))),s?new yc(e,t,r.state,i):(y(mc,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Qs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vc{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static qs(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new S(n.error.code,n.error.message))),i?new vc(e,n.state,r):(y(mc,`Failed to parse target state for ID '${e}': ${t}`),null)}Qs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static qs(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ai();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Re(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new wc(e,i):(y(mc,`Failed to parse client data for instance '${e}': ${t}`),null)}}class bc{constructor(e,t){this.clientId=e,this.onlineState=t}static qs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new bc(t.clientId,t.onlineState):(y(mc,`Failed to parse online state: ${e}`),null)}}class _c{constructor(){this.activeTargetIds=ai()}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ic{constructor(e,t,n,r,i){this.window=e,this.bi=t,this.persistenceKey=n,this.Ks=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ws=this.Gs.bind(this),this.zs=new Jt(V),this.started=!1,this.js=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Hs=hc(this.persistenceKey,this.Ks),this.Js=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.zs=this.zs.insert(this.Ks,new _c),this.Ys=new RegExp(`^${lc}_${s}_([^_]*)$`),this.Zs=new RegExp(`^${dc}_${s}_(\\d+)(?:_(.*))?$`),this.Xs=new RegExp(`^${pc}_${s}_(\\d+)$`),this.eo=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.no=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ws)}static C(e){return!(!e||!e.localStorage)}start(){return r(this,void 0,void 0,(function*(){const e=yield this.syncEngine.us();for(const t of e){if(t===this.Ks)continue;const e=this.getItem(hc(this.persistenceKey,t));if(e){const n=wc.qs(t,e);n&&(this.zs=this.zs.insert(n.clientId,n))}}this.ro();const t=this.storage.getItem(this.eo);if(t){const e=this.io(t);e&&this.so(e)}for(const e of this.js)this.Gs(e);this.js=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}))}writeSequenceNumber(e){this.setItem(this.Js,JSON.stringify(e))}getAllActiveQueryTargets(){return this.oo(this.zs)}isActiveQueryTarget(e){let t=!1;return this.zs.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this._o(e,"pending")}updateMutationState(e,t,n){this._o(e,t,n),this.ao(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(gc(this.persistenceKey,e));if(t){const r=vc.qs(e,t);r&&(n=r.state)}}return t&&this.uo.$s(e),this.ro(),n}removeLocalQueryTarget(e){this.uo.Us(e),this.ro()}isLocalQueryTarget(e){return this.uo.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(gc(this.persistenceKey,e))}updateQueryState(e,t,n){this.co(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.ao(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.lo(e)}notifyBundleLoaded(e){this.ho(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ws),this.removeItem(this.Hs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return m(mc,"READ",e,t),t}setItem(e,t){m(mc,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){m(mc,"REMOVE",e),this.storage.removeItem(e)}Gs(e){const t=e;if(t.storageArea===this.storage){if(m(mc,"EVENT",t.key,t.newValue),t.key===this.Hs)return void y("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.bi.enqueueRetryable((()=>r(this,void 0,void 0,(function*(){if(this.started){if(null!==t.key)if(this.Ys.test(t.key)){if(null==t.newValue){const e=this.Po(t.key);return this.To(e,null)}{const e=this.Io(t.key,t.newValue);if(e)return this.To(e.clientId,e)}}else if(this.Zs.test(t.key)){if(null!==t.newValue){const e=this.Eo(t.key,t.newValue);if(e)return this.Ao(e)}}else if(this.Xs.test(t.key)){if(null!==t.newValue){const e=this.Ro(t.key,t.newValue);if(e)return this.Vo(e)}}else if(t.key===this.eo){if(null!==t.newValue){const e=this.io(t.newValue);if(e)return this.so(e)}}else if(t.key===this.Js){const e=function(e){let t=Ne.le;if(null!=e)try{const n=JSON.parse(e);I("number"==typeof n,30636,{mo:e}),t=n}catch(e){y(mc,"Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Ne.le&&this.sequenceNumberHandler(e)}else if(t.key===this.no){const e=this.fo(t.newValue);yield Promise.all(e.map((e=>this.syncEngine.po(e))))}}else this.js.push(t)}))))}}get uo(){return this.zs.get(this.Ks)}ro(){this.setItem(this.Hs,this.uo.Qs())}_o(e,t,n){const r=new yc(this.currentUser,e,t,n),i=fc(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Qs())}ao(e){const t=fc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}lo(e){const t={clientId:this.Ks,onlineState:e};this.storage.setItem(this.eo,JSON.stringify(t))}co(e,t,n){const r=gc(this.persistenceKey,e),i=new vc(e,t,n);this.setItem(r,i.Qs())}ho(e){const t=JSON.stringify(Array.from(e));this.setItem(this.no,t)}Po(e){const t=this.Ys.exec(e);return t?t[1]:null}Io(e,t){const n=this.Po(e);return wc.qs(n,t)}Eo(e,t){const n=this.Zs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return yc.qs(new d(i),r,t)}Ro(e,t){const n=this.Xs.exec(e),r=Number(n[1]);return vc.qs(r,t)}io(e){return bc.qs(e)}fo(e){return JSON.parse(e)}Ao(e){return r(this,void 0,void 0,(function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.yo(e.batchId,e.state,e.error);m(mc,`Ignoring mutation for non-active user ${e.user.uid}`)}))}Vo(e){return this.syncEngine.wo(e.targetId,e.state,e.error)}To(e,t){const n=t?this.zs.insert(e,t):this.zs.remove(e),r=this.oo(this.zs),i=this.oo(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.bo(s,o).then((()=>{this.zs=n}))}so(e){this.zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}oo(e){let t=ai();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Ec{constructor(){this.So=new _c,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,n){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new _c,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Tc{vo(e){}shutdown(){}}const Sc="ConnectivityMonitor";class Cc{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){m(Sc,"Network connectivity changed: AVAILABLE");for(const e of this.Oo)e(0)}xo(){m(Sc,"Network connectivity changed: UNAVAILABLE");for(const e of this.Oo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let xc=null;function Ac(){return null===xc?xc=268435456+Math.round(2147483648*Math.random()):xc++,"0x"+xc.toString(16)}const Dc="RestConnection",Nc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kc{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${n}/databases/${r}`,this.qo=this.databaseId.database===vn?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Qo(e,t,n,r,i){const s=Ac(),o=this.$o(e,t.toUriEncodedString());m(Dc,`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};return this.Uo(a,r,i),this.Ko(e,o,a,n).then((t=>(m(Dc,`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw v(Dc,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}Wo(e,t,n,r,i,s){return this.Qo(e,t,n,r,i)}Uo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+f,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}$o(e,t){const n=Nc[e];return`${this.Lo}/v1/${t}:${n}`}terminate(){}}class Oc{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}const Mc="WebChannelConnection";class Rc extends kc{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,n,r){const i=Ac();return new Promise(((s,o)=>{const a=new u.XhrIo;a.setWithCredentials(!0),a.listenOnce(u.EventType.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case u.ErrorCode.NO_ERROR:const t=a.getResponseJson();m(Mc,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case u.ErrorCode.TIMEOUT:m(Mc,`RPC '${e}' ${i} timed out`),o(new S(T.DEADLINE_EXCEEDED,"Request time out"));break;case u.ErrorCode.HTTP_ERROR:const n=a.getStatus();if(m(Mc,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(T).indexOf(t)>=0?t:T.UNKNOWN}(t.status);o(new S(e,t.message))}else o(new S(T.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new S(T.UNAVAILABLE,"Connection failed."));break;default:b(9055,{s_:e,streamId:i,o_:a.getLastErrorCode(),__:a.getLastError()})}}finally{m(Mc,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);m(Mc,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}a_(e,t,n){const r=Ac(),i=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=u.createWebChannelTransport(),o=u.getStatEventTarget(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Uo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=i.join("");m(Mc,`Creating RPC '${e}' stream ${r}: ${l}`,a);const h=s.createWebChannel(l,a);let d=!1,f=!1;const p=new Oc({Go:t=>{f?m(Mc,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(m(Mc,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),m(Mc,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},zo:()=>h.close()}),g=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return g(h,u.WebChannel.EventType.OPEN,(()=>{f||(m(Mc,`RPC '${e}' stream ${r} transport opened.`),p.t_())})),g(h,u.WebChannel.EventType.CLOSE,(()=>{f||(f=!0,m(Mc,`RPC '${e}' stream ${r} transport closed`),p.r_())})),g(h,u.WebChannel.EventType.ERROR,(t=>{f||(f=!0,v(Mc,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),p.r_(new S(T.UNAVAILABLE,"The operation could not be completed")))})),g(h,u.WebChannel.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];I(!!i,16349);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){m(Mc,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Gi[e];if(void 0!==t)return Hi(t)}(t),i=o.message;void 0===n&&(n=T.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,p.r_(new S(n,i)),h.close()}else m(Mc,`RPC '${e}' stream ${r} received:`,i),p.i_(i)}})),g(o,u.Event.STAT_EVENT,(t=>{t.stat===u.Stat.PROXY?m(Mc,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===u.Stat.NOPROXY&&m(Mc,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.n_()}),0),p}}function Lc(){return"undefined"!=typeof window?window:null}function Pc(){return"undefined"!=typeof document?document:null}function Fc(e){return new fs(e,!0)}class Vc{constructor(e,t,n=1e3,r=1.5,i=6e4){this.bi=e,this.timerId=t,this.u_=n,this.c_=r,this.l_=i,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();const t=Math.floor(this.h_+this.d_()),n=Math.max(0,Date.now()-this.T_),r=Math.max(0,t-n);r>0&&m("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,r,(()=>(this.T_=Date.now(),e()))),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){null!==this.P_&&(this.P_.skipDelay(),this.P_=null)}cancel(){null!==this.P_&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}const Bc="PersistentStream";class Uc{constructor(e,t,n,r,i,s,o,a){this.bi=e,this.R_=n,this.V_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new Vc(e,t)}w_(){return 1===this.state||5===this.state||this.b_()}b_(){return 2===this.state||3===this.state}start(){this.p_=0,4!==this.state?this.auth():this.S_()}stop(){return r(this,void 0,void 0,(function*(){this.w_()&&(yield this.close(0))}))}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&null===this.f_&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,(()=>this.C_())))}F_(e){this.M_(),this.stream.send(e)}C_(){return r(this,void 0,void 0,(function*(){if(this.b_())return this.close(0)}))}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}close(e,t){return r(this,void 0,void 0,(function*(){this.M_(),this.x_(),this.y_.cancel(),this.m_++,4!==e?this.y_.reset():t&&t.code===T.RESOURCE_EXHAUSTED?(y(t.toString()),y("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===T.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Zo(t)}))}O_(){}auth(){this.state=1;const e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.m_===t&&this.B_(e,n)}),(t=>{e((()=>{const e=new S(T.UNKNOWN,"Fetching auth token failed: "+t.message);return this.L_(e)}))}))}B_(e,t){const n=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo((()=>{n((()=>this.listener.jo()))})),this.stream.Jo((()=>{n((()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,(()=>(this.b_()&&(this.state=3),Promise.resolve()))),this.listener.Jo())))})),this.stream.Zo((e=>{n((()=>this.L_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.p_?this.q_(e):this.onNext(e)))}))}S_(){this.state=5,this.y_.E_((()=>r(this,void 0,void 0,(function*(){this.state=0,this.start()}))))}L_(e){return m(Bc,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget((()=>this.m_===e?t():(m(Bc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class qc extends Uc{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:b(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(I(void 0===t||"string"==typeof t,58123),sn.fromBase64String(t||"")):(I(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),sn.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?T.UNKNOWN:Hi(e.code);return new S(t,e.message||"")}(o);n=new ss(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Es(e,r.document.name),s=vs(r.document.updateTime),o=r.document.createTime?vs(r.document.createTime):Q.min(),a=new Wn({mapValue:{fields:r.document.fields}}),c=Yn.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new rs(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Es(e,r.document),s=r.readTime?vs(r.readTime):Q.min(),o=Yn.newNoDocument(i,s),a=r.removedTargetIds||[];n=new rs([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Es(e,r.document),s=r.removedTargetIds||[];n=new rs([],s,i,null)}else{if(!("filter"in t))return b(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new $i(r,i),o=e.targetId;n=new is(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Q.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Q.min():t.readTime?vs(t.readTime):Q.min()}(e);return this.listener.Q_(t,n)}U_(e){const t={};t.database=Cs(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Cr(r)?{documents:Os(e,r)}:{query:Ms(e,r).gt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ms(e,t.resumeToken);const r=ps(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Q.min())>0){n.readTime=gs(e,t.snapshotVersion.toTimestamp());const r=ps(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return b(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.F_(t)}K_(e){const t={};t.database=Cs(this.serializer),t.removeTarget=e,this.F_(t)}}class jc extends Uc{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return I(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,I(!e.writeResults||0===e.writeResults.length,55816),this.listener.z_()}onNext(e){I(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();const t=function(e,t){return e&&e.length>0?(I(void 0!==t,14353),e.map((e=>function(e,t){let n=e.updateTime?vs(e.updateTime):vs(t);return n.isEqual(Q.min())&&(n=vs(t)),new Ti(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=vs(e.commitTime);return this.listener.j_(n,t)}H_(){const e={};e.database=Cs(this.serializer),this.F_(e)}G_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ns(this.serializer,e)))};this.F_(t)}}class zc{}class $c extends zc{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.J_=!1}Y_(){if(this.J_)throw new S(T.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,n,r){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Qo(e,bs(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new S(T.UNKNOWN,e.toString())}))}Wo(e,t,n,r,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Wo(e,bs(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new S(T.UNKNOWN,e.toString())}))}terminate(){this.J_=!0,this.connection.terminate()}}class Gc{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){0===this.Z_&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve()))))}ia(e){"Online"===this.state?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,"Online"===e&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(y(t),this.ea=!1):m("OnlineStateTracker",t)}sa(){null!==this.X_&&(this.X_.cancel(),this.X_=null)}}const Kc="RemoteStore";class Qc{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=s,this.ca.vo((e=>{n.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){nu(this)&&(m(Kc,"Restarting streams for network reachability change."),yield function(e){return r(this,void 0,void 0,(function*(){const t=E(e);t.aa.add(4),yield Wc(t),t.la.set("Unknown"),t.aa.delete(4),yield Hc(t)}))}(this))}))))})),this.la=new Gc(n,i)}}function Hc(e){return r(this,void 0,void 0,(function*(){if(nu(e))for(const t of e.ua)yield t(!0)}))}function Wc(e){return r(this,void 0,void 0,(function*(){for(const t of e.ua)yield t(!1)}))}function Jc(e,t){const n=E(e);n._a.has(t.targetId)||(n._a.set(t.targetId,t),tu(n)?eu(n):_u(n).b_()&&Xc(n,t))}function Yc(e,t){const n=E(e),r=_u(n);n._a.delete(t),r.b_()&&Zc(n,t),0===n._a.size&&(r.b_()?r.v_():nu(n)&&n.la.set("Unknown"))}function Xc(e,t){if(e.ha.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Q.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}_u(e).U_(t)}function Zc(e,t){e.ha.Ke(t),_u(e).K_(t)}function eu(e){e.ha=new as({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e._a.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),_u(e).start(),e.la.ta()}function tu(e){return nu(e)&&!_u(e).w_()&&e._a.size>0}function nu(e){return 0===E(e).aa.size}function ru(e){e.ha=void 0}function iu(e){return r(this,void 0,void 0,(function*(){e.la.set("Online")}))}function su(e){return r(this,void 0,void 0,(function*(){e._a.forEach(((t,n)=>{Xc(e,t)}))}))}function ou(e,t){return r(this,void 0,void 0,(function*(){ru(e),tu(e)?(e.la.ia(t),eu(e)):e.la.set("Unknown")}))}function au(e,t,n){return r(this,void 0,void 0,(function*(){if(e.la.set("Online"),t instanceof ss&&2===t.state&&t.cause)try{yield function(e,t){return r(this,void 0,void 0,(function*(){const n=t.cause;for(const r of t.targetIds)e._a.has(r)&&(yield e.remoteSyncer.rejectListen(r,n),e._a.delete(r),e.ha.removeTarget(r))}))}(e,t)}catch(n){m(Kc,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield cu(e,n)}else if(t instanceof rs?e.ha.Xe(t):t instanceof is?e.ha.ot(t):e.ha.nt(t),!n.isEqual(Q.min()))try{const t=yield ec(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.ha.It(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e._a.get(r);i&&e._a.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e._a.get(t);if(!r)return;e._a.set(t,r.withResumeToken(sn.EMPTY_BYTE_STRING,r.snapshotVersion)),Zc(e,t);const i=new Gs(r.target,t,n,r.sequenceNumber);Xc(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(t){m(Kc,"Failed to raise snapshot:",t),yield cu(e,t)}}))}function cu(e,t,n){return r(this,void 0,void 0,(function*(){if(!Ie(t))throw t;e.aa.add(1),yield Wc(e),e.la.set("Offline"),n||(n=()=>ec(e.localStore)),e.asyncQueue.enqueueRetryable((()=>r(this,void 0,void 0,(function*(){m(Kc,"Retrying IndexedDB access"),yield n(),e.aa.delete(1),yield Hc(e)}))))}))}function uu(e,t){return t().catch((n=>cu(e,n,t)))}function lu(e){return r(this,void 0,void 0,(function*(){const t=E(e),n=Iu(t);let r=t.oa.length>0?t.oa[t.oa.length-1].batchId:ke;for(;hu(t);)try{const e=yield nc(t.localStore,r);if(null===e){0===t.oa.length&&n.v_();break}r=e.batchId,du(t,e)}catch(e){yield cu(t,e)}fu(t)&&pu(t)}))}function hu(e){return nu(e)&&e.oa.length<10}function du(e,t){e.oa.push(t);const n=Iu(e);n.b_()&&n.W_&&n.G_(t.mutations)}function fu(e){return nu(e)&&!Iu(e).w_()&&e.oa.length>0}function pu(e){Iu(e).start()}function gu(e){return r(this,void 0,void 0,(function*(){Iu(e).H_()}))}function mu(e){return r(this,void 0,void 0,(function*(){const t=Iu(e);for(const n of e.oa)t.G_(n.mutations)}))}function yu(e,t,n){return r(this,void 0,void 0,(function*(){const r=e.oa.shift(),i=qi.from(r,t,n);yield uu(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),yield lu(e)}))}function vu(e,t){return r(this,void 0,void 0,(function*(){t&&Iu(e).W_&&(yield function(e,t){return r(this,void 0,void 0,(function*(){if(function(e){return Qi(e)&&e!==T.ABORTED}(t.code)){const n=e.oa.shift();Iu(e).D_(),yield uu(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),yield lu(e)}}))}(e,t)),fu(e)&&pu(e)}))}function wu(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);n.asyncQueue.verifyOperationInProgress(),m(Kc,"RemoteStore received new credentials");const r=nu(n);n.aa.add(3),yield Wc(n),r&&n.la.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.aa.delete(3),yield Hc(n)}))}function bu(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);t?(n.aa.delete(2),yield Hc(n)):t||(n.aa.add(2),yield Wc(n),n.la.set("Unknown"))}))}function _u(e){return e.Pa||(e.Pa=function(e,t,n){const r=E(e);return r.Y_(),new qc(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{jo:iu.bind(null,e),Jo:su.bind(null,e),Zo:ou.bind(null,e),Q_:au.bind(null,e)}),e.ua.push((t=>r(this,void 0,void 0,(function*(){t?(e.Pa.D_(),tu(e)?eu(e):e.la.set("Unknown")):(yield e.Pa.stop(),ru(e))}))))),e.Pa}function Iu(e){return e.Ta||(e.Ta=function(e,t,n){const r=E(e);return r.Y_(),new jc(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{jo:()=>Promise.resolve(),Jo:gu.bind(null,e),Zo:vu.bind(null,e),z_:mu.bind(null,e),j_:yu.bind(null,e)}),e.ua.push((t=>r(this,void 0,void 0,(function*(){t?(e.Ta.D_(),yield lu(e)):(yield e.Ta.stop(),e.oa.length>0&&(m(Kc,`Stopping write stream with ${e.oa.length} pending writes`),e.oa=[]))}))))),e.Ta}class Eu{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new C,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Eu(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new S(T.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Tu(e,t){if(y("AsyncQueue",`${t}: ${e}`),Ie(e))return new S(T.UNAVAILABLE,`${t}: ${e}`);throw e}class Su{static emptySet(e){return new Su(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Z.comparator(t.key,n.key):(e,t)=>Z.comparator(e.key,t.key),this.keyedMap=Xr(),this.sortedSet=new Jt(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Su))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Su;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Cu{constructor(){this.Ia=new Jt(Z.comparator)}track(e){const t=e.doc.key,n=this.Ia.get(t);n?0!==e.type&&3===n.type?this.Ia=this.Ia.insert(t,e):3===e.type&&1!==n.type?this.Ia=this.Ia.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Ia=this.Ia.remove(t):1===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):b(63341,{Vt:e,Ea:n}):this.Ia=this.Ia.insert(t,e)}da(){const e=[];return this.Ia.inorderTraversal(((t,n)=>{e.push(n)})),e}}class xu{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new xu(e,t,Su.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Au{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some((e=>e.ma()))}}class Du{constructor(){this.queries=Nu(),this.onlineState="Unknown",this.fa=new Set}terminate(){!function(e,t){const n=E(e),r=n.queries;n.queries=Nu(),r.forEach(((e,n)=>{for(const e of n.Ra)e.onError(t)}))}(this,new S(T.ABORTED,"Firestore shutting down"))}}function Nu(){return new Hr((e=>jr(e)),qr)}function ku(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.Va()&&t.ma()&&(r=2):(s=new Au,r=t.ma()?0:1);try{switch(r){case 0:s.Aa=yield n.onListen(i,!0);break;case 1:s.Aa=yield n.onListen(i,!1);break;case 2:yield n.onFirstRemoteStoreListen(i)}}catch(e){const n=Tu(e,`Initialization of query '${zr(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.Ra.push(t),t.ga(n.onlineState),s.Aa&&t.pa(s.Aa)&&Lu(n)}))}function Ou(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Ra.indexOf(t);e>=0&&(s.Ra.splice(e,1),0===s.Ra.length?i=t.ma()?0:1:!s.Va()&&t.ma()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}))}function Mu(e,t){const n=E(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Ra)t.pa(e)&&(r=!0);i.Aa=e}}r&&Lu(n)}function Ru(e,t,n){const r=E(e),i=r.queries.get(t);if(i)for(const e of i.Ra)e.onError(n);r.queries.delete(t)}function Lu(e){e.fa.forEach((e=>{e.next()}))}var Pu,Fu;(Fu=Pu||(Pu={})).ya="default",Fu.Cache="cache";class Vu{constructor(e,t,n){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=n||{}}pa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new xu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){if(!e.fromCache)return!0;if(!this.ma())return!0;const n="Offline"!==t;return(!this.options.Fa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Da(e){if(e.docChanges.length>0)return!0;const t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ca(e){e=xu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==Pu.Cache}}class Bu{constructor(e,t){this.Ma=e,this.byteLength=t}xa(){return"metadata"in this.Ma}}class Uu{constructor(e){this.serializer=e}Bs(e){return Es(this.serializer,e)}Ls(e){return e.metadata.exists?Ds(this.serializer,e.document,!1):Yn.newNoDocument(this.Bs(e.metadata.name),this.ks(e.metadata.readTime))}ks(e){return vs(e)}}class qu{constructor(e,t,n){this.Oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ju(e)}Na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Ma.namedQuery)this.queries.push(e.Ma.namedQuery);else if(e.Ma.documentMetadata){this.documents.push({metadata:e.Ma.documentMetadata}),e.Ma.documentMetadata.exists||++t;const n=J.fromString(e.Ma.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Ma.document&&(this.documents[this.documents.length-1].document=e.Ma.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ba(e){const t=new Map,n=new Uu(this.serializer);for(const r of e)if(r.metadata.queries){const e=n.Bs(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||si()).add(e);t.set(n,r)}}return t}complete(){return r(this,void 0,void 0,(function*(){const e=yield function(e,t,n,i){return r(this,void 0,void 0,(function*(){const r=E(e);let s=si(),o=Jr();for(const e of n){const n=t.Bs(e.metadata.name);e.document&&(s=s.add(n));const r=t.Ls(e);r.setReadTime(t.ks(e.metadata.readTime)),o=o.insert(n,r)}const a=r.Cs.newChangeBuffer({trackRemovals:!0}),c=yield rc(r,function(e){return Pr(Or(J.fromString(`__bundle__/docs/${e}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",(e=>tc(e,a,o).next((t=>(a.apply(e),t))).next((t=>r.ai.removeMatchingKeysForTargetId(e,c.targetId).next((()=>r.ai.addMatchingKeys(e,s,c.targetId))).next((()=>r.localDocuments.getLocalViewOfDocuments(e,t.xs,t.Os))).next((()=>t.xs))))))}))}(this.localStore,new Uu(this.serializer),this.documents,this.Oa.id),t=this.Ba(this.documents);for(const e of this.queries)yield uc(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,La:this.collectionGroups,ka:e}}))}}function ju(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class zu{constructor(e){this.key=e}}class $u{constructor(e){this.key=e}}class Gu{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=si(),this.mutatedKeys=si(),this.Ua=Kr(e),this.Ka=new Su(this.Ua)}get Wa(){return this.qa}Ga(e,t){const n=t?t.za:new Cu,r=t?t.Ka:this.Ka;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=$r(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ja(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Ua(l,a)>0||c&&this.Ua(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ka:s,za:n,ys:o,mutatedKeys:i}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;const s=e.za.da();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return b(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.Ua(e.doc,t.doc))),this.Ha(n),r=null!=r&&r;const o=t&&!r?this.Ja():[],a=0===this.$a.size&&this.current&&!r?1:0,c=a!==this.Qa;return this.Qa=a,0!==s.length||c?{snapshot:new xu(this.query,e.Ka,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ya:o}:{Ya:o}}ga(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new Cu,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach((e=>this.qa=this.qa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.qa=this.qa.delete(e))),this.current=e.current)}Ja(){if(!this.current)return[];const e=this.$a;this.$a=si(),this.Ka.forEach((e=>{this.Za(e.key)&&(this.$a=this.$a.add(e.key))}));const t=[];return e.forEach((e=>{this.$a.has(e)||t.push(new $u(e))})),this.$a.forEach((n=>{e.has(n)||t.push(new zu(n))})),t}Xa(e){this.qa=e.Ns,this.$a=si();const t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return xu.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,0===this.Qa,this.hasCachedResults)}}const Ku="SyncEngine";class Qu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Hu{constructor(e){this.key=e,this.tu=!1}}class Wu{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.nu={},this.ru=new Hr((e=>jr(e)),qr),this.iu=new Map,this.su=new Set,this.ou=new Jt(Z.comparator),this._u=new Map,this.au=new Ca,this.uu={},this.cu=new Map,this.lu=Xo.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return!0===this.hu}}function Ju(e,t){return r(this,arguments,void 0,(function*(e,t,n=!0){const r=Sl(e);let i;const s=r.ru.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=yield Xu(r,t,n,!0),i}))}function Yu(e,t){return r(this,void 0,void 0,(function*(){const n=Sl(e);yield Xu(n,t,!0,!1)}))}function Xu(e,t,n,i){return r(this,void 0,void 0,(function*(){const r=yield rc(e.localStore,Pr(t)),s=r.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return i&&(a=yield Zu(e,t,s,"current"===o,r.resumeToken)),e.isPrimaryClient&&n&&Jc(e.remoteStore,r),a}))}function Zu(e,t,n,i,s){return r(this,void 0,void 0,(function*(){e.Pu=(t,n,i)=>function(e,t,n,i){return r(this,void 0,void 0,(function*(){let r=t.view.Ga(n);r.ys&&(r=yield sc(e.localStore,t.query,!1).then((({documents:e})=>t.view.Ga(e,r))));const s=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return hl(e,t.targetId,a.Ya),a.snapshot}))}(e,t,n,i);const o=yield sc(e.localStore,t,!0),a=new Gu(t,o.Ns),c=a.Ga(o.documents),u=ns.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),l=a.applyChanges(c,e.isPrimaryClient,u);hl(e,n,l.Ya);const h=new Qu(t,n,a);return e.ru.set(t,h),e.iu.has(n)?e.iu.get(n).push(t):e.iu.set(n,[t]),l.snapshot}))}function el(e,t,n){return r(this,void 0,void 0,(function*(){const r=E(e),i=r.ru.get(t),s=r.iu.get(i.targetId);if(s.length>1)return r.iu.set(i.targetId,s.filter((e=>!qr(e,t)))),void r.ru.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ic(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Yc(r.remoteStore,i.targetId),ul(r,i.targetId)})).catch(pe))):(ul(r,i.targetId),yield ic(r.localStore,i.targetId,!0))}))}function tl(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r=n.ru.get(t),i=n.iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Yc(n.remoteStore,r.targetId))}))}function nl(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);try{const e=yield function(e,t){const n=E(e),r=t.snapshotVersion;let i=n.Ss;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Cs.newChangeBuffer({trackRemovals:!0});i=n.Ss;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.ai.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.ai.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(sn.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.ai.updateTargetData(e,u))}));let a=Jr(),c=si();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(tc(e,s,t.documentUpdates).next((e=>{a=e.xs,c=e.Os}))),!r.isEqual(Q.min())){const t=n.ai.getLastRemoteSnapshotVersion(e).next((t=>n.ai.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return ge.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ss=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n._u.get(t);r&&(I(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.tu=!0:e.modifiedDocuments.size>0?I(r.tu,14607):e.removedDocuments.size>0&&(I(r.tu,42227),r.tu=!1))})),yield pl(n,e,t)}catch(e){yield pe(e)}}))}function rl(e,t,n){const r=E(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ru.forEach(((n,r)=>{const i=r.view.ga(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=E(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Ra)e.ga(t)&&(r=!0)})),r&&Lu(n)}(r.eventManager,t),e.length&&r.nu.Q_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function il(e,t,n){return r(this,void 0,void 0,(function*(){const r=E(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r._u.get(t),s=i&&i.key;if(s){let e=new Jt(Z.comparator);e=e.insert(s,Yn.newNoDocument(s,Q.min()));const n=si().add(s),i=new ts(Q.min(),new Map,new Jt(V),e,n);yield nl(r,i),r.ou=r.ou.remove(s),r._u.delete(t),fl(r)}else yield ic(r.localStore,t,!1).then((()=>ul(r,t,n))).catch(pe)}))}function sl(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r=t.batch.batchId;try{const e=yield function(e,t){const n=E(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ge.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);I(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=si();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);cl(n,r,null),al(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield pl(n,e)}catch(e){yield pe(e)}}))}function ol(e,t,n){return r(this,void 0,void 0,(function*(){const r=E(e);try{const e=yield function(e,t){const n=E(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(I(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);cl(r,t,n),al(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield pl(r,e)}catch(e){yield pe(e)}}))}function al(e,t){(e.cu.get(t)||[]).forEach((e=>{e.resolve()})),e.cu.delete(t)}function cl(e,t,n){const r=E(e);let i=r.uu[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.uu[r.currentUser.toKey()]=i}}function ul(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.iu.get(t))e.ru.delete(r),n&&e.nu.Tu(r,n);e.iu.delete(t),e.isPrimaryClient&&e.au.Ur(t).forEach((t=>{e.au.containsKey(t)||ll(e,t)}))}function ll(e,t){e.su.delete(t.path.canonicalString());const n=e.ou.get(t);null!==n&&(Yc(e.remoteStore,n),e.ou=e.ou.remove(t),e._u.delete(n),fl(e))}function hl(e,t,n){for(const r of n)r instanceof zu?(e.au.addReference(r.key,t),dl(e,r)):r instanceof $u?(m(Ku,"Document no longer in limbo: "+r.key),e.au.removeReference(r.key,t),e.au.containsKey(r.key)||ll(e,r.key)):b(19791,{Iu:r})}function dl(e,t){const n=t.key,r=n.path.canonicalString();e.ou.get(n)||e.su.has(r)||(m(Ku,"New document in limbo: "+n),e.su.add(r),fl(e))}function fl(e){for(;e.su.size>0&&e.ou.size<e.maxConcurrentLimboResolutions;){const t=e.su.values().next().value;e.su.delete(t);const n=new Z(J.fromString(t)),r=e.lu.next();e._u.set(r,new Hu(n)),e.ou=e.ou.insert(n,r),Jc(e.remoteStore,new Gs(Pr(Or(n.path)),r,"TargetPurposeLimboResolution",Ne.le))}}function pl(e,t,n){return r(this,void 0,void 0,(function*(){const i=E(e),s=[],o=[],a=[];i.ru.isEmpty()||(i.ru.forEach(((e,r)=>{a.push(i.Pu(r,t,n).then((e=>{var t;if((e||n)&&i.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(r.targetId))||void 0===t?void 0:t.current;i.sharedClientState.updateQueryState(r.targetId,s?"current":"not-current")}if(e){s.push(e);const t=Qa.Ps(r.targetId,e);o.push(t)}})))})),yield Promise.all(a),i.nu.Q_(s),yield function(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>ge.forEach(t,(t=>ge.forEach(t.ls,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>ge.forEach(t.hs,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ie(e))throw e;m(Ja,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ss.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ss=n.Ss.insert(t,i)}}}))}(i.localStore,o))}))}function gl(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);if(!n.currentUser.isEqual(t)){m(Ku,"User change. New user:",t.toKey());const e=yield Za(n.localStore,t);n.currentUser=t,function(e){e.cu.forEach((e=>{e.forEach((e=>{e.reject(new S(T.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.cu.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield pl(n,e.Ms)}}))}function ml(e,t){const n=E(e),r=n._u.get(t);if(r&&r.tu)return si().add(r.key);{let e=si();const r=n.iu.get(t);if(!r)return e;for(const t of r){const r=n.ru.get(t);e=e.unionWith(r.view.Wa)}return e}}function yl(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r=yield sc(n.localStore,t.query,!0),i=t.view.Xa(r);return n.isPrimaryClient&&hl(n,t.targetId,i.Ya),i}))}function vl(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);return ac(n.localStore,t).then((e=>pl(n,e)))}))}function wl(e,t,n,i){return r(this,void 0,void 0,(function*(){const r=E(e),s=yield function(e,t){const n=E(e),r=E(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Hn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):ge.resolve(null)))))}(r.localStore,t);null!==s?("pending"===n?yield lu(r.remoteStore):"acknowledged"===n||"rejected"===n?(cl(r,t,i||null),al(r,t),function(e,t){E(E(e).mutationQueue).Xn(t)}(r.localStore,t)):b(6720,"Unknown batchState",{Eu:n}),yield pl(r,s)):m(Ku,"Cannot apply mutation batch with id: "+t)}))}function bl(e,t,n){return r(this,void 0,void 0,(function*(){const n=E(e),r=[],i=[];for(const e of t){let t;const s=n.iu.get(e);if(s&&0!==s.length){t=yield rc(n.localStore,Pr(s[0]));for(const e of s){const t=n.ru.get(e),r=yield yl(n,t);r.snapshot&&i.push(r.snapshot)}}else{const r=yield oc(n.localStore,e);t=yield rc(n.localStore,r),yield Zu(n,_l(r),e,!1,t.resumeToken)}r.push(t)}return n.nu.Q_(i),r}))}function _l(e){return kr(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Il(e){return function(e){return E(E(e).persistence).us()}(E(e).localStore)}function El(e,t,n,i){return r(this,void 0,void 0,(function*(){const r=E(e);if(r.hu)return void m(Ku,"Ignoring unexpected query state notification.");const s=r.iu.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=yield ac(r.localStore,Gr(s[0])),i=ts.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,sn.EMPTY_BYTE_STRING);yield pl(r,e,i);break}case"rejected":yield ic(r.localStore,t,!0),ul(r,t,i);break;default:b(64155,n)}}))}function Tl(e,t,n){return r(this,void 0,void 0,(function*(){const r=Sl(e);if(r.hu){for(const e of t){if(r.iu.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){m(Ku,"Adding an already active target "+e);continue}const t=yield oc(r.localStore,e),n=yield rc(r.localStore,t);yield Zu(r,_l(t),n.targetId,!1,n.resumeToken),Jc(r.remoteStore,n)}for(const e of n)r.iu.has(e)&&(yield ic(r.localStore,e,!1).then((()=>{Yc(r.remoteStore,e),ul(r,e)})).catch(pe))}}))}function Sl(e){const t=E(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=nl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ml.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=il.bind(null,t),t.nu.Q_=Mu.bind(null,t.eventManager),t.nu.Tu=Ru.bind(null,t.eventManager),t}function Cl(e){const t=E(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=sl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ol.bind(null,t),t}class xl{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return r(this,void 0,void 0,(function*(){this.serializer=Fc(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),yield this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}))}mu(e,t){return null}fu(e,t){return null}Vu(e){return Xa(this.persistence,new Wa,e.initialUser,this.serializer)}Ru(e){return new Oa(Ra.Ei,this.serializer)}Au(e){return new Ec}terminate(){return r(this,void 0,void 0,(function*(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()}))}}xl.provider={build:()=>new xl};class Al extends xl{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){I(this.persistence.referenceDelegate instanceof La,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new aa(n,e.asyncQueue,t)}Ru(e){const t=void 0!==this.cacheSizeBytes?$o.withCacheSize(this.cacheSizeBytes):$o.DEFAULT;return new Oa((e=>La.Ei(e,t)),this.serializer)}}class Dl extends xl{constructor(e,t,n){super(),this.gu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return r(this,void 0,void 0,(function*(){yield t.initialize.call(this,e),yield this.gu.initialize(this,e),yield Cl(this.gu.syncEngine),yield lu(this.gu.remoteStore),yield this.persistence.Ki((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}))}Vu(e){return Xa(this.persistence,new Wa,e.initialUser,this.serializer)}mu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new aa(n,e.asyncQueue,t)}fu(e,t){const n=new De(t,this.persistence);return new Ae(e.asyncQueue,n)}Ru(e){const t=Ka(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?$o.withCacheSize(this.cacheSizeBytes):$o.DEFAULT;return new za(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Lc(),Pc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Au(e){return new Ec}}class Nl extends Dl{constructor(e,t){super(e,t,!1),this.gu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return r(this,void 0,void 0,(function*(){yield t.initialize.call(this,e);const n=this.gu.syncEngine;this.sharedClientState instanceof Ic&&(this.sharedClientState.syncEngine={yo:wl.bind(null,n),wo:El.bind(null,n),bo:Tl.bind(null,n),us:Il.bind(null,n),po:vl.bind(null,n)},yield this.sharedClientState.start()),yield this.persistence.Ki((e=>r(this,void 0,void 0,(function*(){yield function(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);if(Sl(n),Cl(n),!0===t&&!0!==n.hu){const e=n.sharedClientState.getAllActiveQueryTargets(),t=yield bl(n,e.toArray());n.hu=!0,yield bu(n.remoteStore,!0);for(const e of t)Jc(n.remoteStore,e)}else if(!1===t&&!1!==n.hu){const e=[];let t=Promise.resolve();n.iu.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(ul(n,i),ic(n.localStore,i,!0)))),Yc(n.remoteStore,i)})),yield t,yield bl(n,e),function(e){const t=E(e);t._u.forEach(((e,n)=>{Yc(t.remoteStore,n)})),t.au.Kr(),t._u=new Map,t.ou=new Jt(Z.comparator)}(n),n.hu=!1,yield bu(n.remoteStore,!1)}}))}(this.gu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))))}))}Au(e){const t=Lc();if(!Ic.C(t))throw new S(T.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ka(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ic(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class kl{initialize(e,t){return r(this,void 0,void 0,(function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>rl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gl.bind(null,this.syncEngine),yield bu(this.remoteStore,this.syncEngine.isPrimaryClient))}))}createEventManager(e){return new Du}createDatastore(e){const t=Fc(e.databaseInfo.databaseId),n=function(e){return new Rc(e)}(e.databaseInfo);return function(e,t,n,r){return new $c(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Qc(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>rl(this.syncEngine,e,0)),Cc.C()?new Cc:new Tc)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Wu(e,t,n,r,i,s);return o&&(a.hu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return r(this,void 0,void 0,(function*(){var e,t;yield function(e){return r(this,void 0,void 0,(function*(){const t=E(e);m(Kc,"RemoteStore shutting down."),t.aa.add(5),yield Wc(t),t.ca.shutdown(),t.la.set("Unknown")}))}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}))}}function Ol(e,t=10240){let n=0;return{read(){return r(this,void 0,void 0,(function*(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}}))},cancel(){return r(this,void 0,void 0,(function*(){}))},releaseLock(){},closed:Promise.resolve()}}kl.provider={build:()=>new kl};class Ml{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):y("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Rl{constructor(e,t){this.wu=e,this.serializer=t,this.metadata=new C,this.buffer=new Uint8Array,this.bu=new TextDecoder("utf-8"),this.Su().then((e=>{e&&e.xa()?this.metadata.resolve(e.Ma.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Ma)}`))}),(e=>this.metadata.reject(e)))}close(){return this.wu.cancel()}getMetadata(){return r(this,void 0,void 0,(function*(){return this.metadata.promise}))}du(){return r(this,void 0,void 0,(function*(){return yield this.getMetadata(),this.Su()}))}Su(){return r(this,void 0,void 0,(function*(){const e=yield this.Du();if(null===e)return null;const t=this.bu.decode(e),n=Number(t);isNaN(n)&&this.vu(`length string (${t}) is not valid number`);const r=yield this.Cu(n);return new Bu(JSON.parse(r),e.length+n)}))}Fu(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}Du(){return r(this,void 0,void 0,(function*(){for(;this.Fu()<0&&!(yield this.Mu()););if(0===this.buffer.length)return null;const e=this.Fu();e<0&&this.vu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}))}Cu(e){return r(this,void 0,void 0,(function*(){for(;this.buffer.length<e;)(yield this.Mu())&&this.vu("Reached the end of bundle when more is expected.");const t=this.bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}))}vu(e){throw this.wu.cancel(),new Error(`Invalid bundle format: ${e}`)}Mu(){return r(this,void 0,void 0,(function*(){const e=yield this.wu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}))}}class Ll{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return r(this,void 0,void 0,(function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new S(T.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=yield function(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r={documents:t.map((e=>Is(n.serializer,e)))},i=yield n.Wo("BatchGetDocuments",n.serializer.databaseId,J.emptyPath(),r,t.length),s=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){I(!!t.found,43571),t.found.name,t.found.updateTime;const n=Es(e,t.found.name),r=vs(t.found.updateTime),i=t.found.createTime?vs(t.found.createTime):Q.min(),s=new Wn({mapValue:{fields:t.found.fields}});return Yn.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){I(!!t.missing,3894),I(!!t.readTime,22933);const n=Es(e,t.missing),r=vs(t.readTime);return Yn.newNoDocument(n,r)}(e,t):b(7234,{result:t})}(n.serializer,e);s.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=s.get(e.toString());I(!!t,55234,{key:e}),o.push(t)})),o}))}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}))}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Vi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return r(this,void 0,void 0,(function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=Z.fromPath(t);this.mutations.push(new Bi(n,this.precondition(n)))})),yield function(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r={writes:t.map((e=>Ns(n.serializer,e)))};yield n.Qo("Commit",n.serializer.databaseId,J.emptyPath(),r)}))}(this.datastore,this.mutations),this.committed=!0}))}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw b(50498,{xu:e.constructor.name});t=Q.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new S(T.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Q.min())?Si.exists(!1):Si.updateTime(t):Si.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Q.min()))throw new S(T.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Si.updateTime(t)}return Si.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Pl{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Ou=n.maxAttempts,this.y_=new Vc(this.asyncQueue,"transaction_retry")}Nu(){this.Ou-=1,this.Bu()}Bu(){this.y_.E_((()=>r(this,void 0,void 0,(function*(){const e=new Ll(this.datastore),t=this.Lu(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.ku(e)}))))})).catch((e=>{this.ku(e)}))}))))}Lu(e){try{const t=this.updateFunction(e);return!Oe(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ku(e){this.Ou>0&&this.qu(e)?(this.Ou-=1,this.asyncQueue.enqueueAndForget((()=>(this.Bu(),Promise.resolve())))):this.deferred.reject(e)}qu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Qi(t)}return!1}}const Fl="FirestoreClient";class Vl{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=d.UNAUTHENTICATED,this.clientId=F.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(e=>r(this,void 0,void 0,(function*(){m(Fl,"Received user=",e.uid),yield this.authCredentialListener(e),this.user=e})))),this.appCheckCredentials.start(n,(e=>(m(Fl,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new C;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((()=>r(this,void 0,void 0,(function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Tu(t,"Failed to shutdown persistence");e.reject(n)}})))),e.promise}}function Bl(e,t){return r(this,void 0,void 0,(function*(){e.asyncQueue.verifyOperationInProgress(),m(Fl,"Initializing OfflineComponentProvider");const n=e.configuration;yield t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((e=>r(this,void 0,void 0,(function*(){i.isEqual(e)||(yield Za(t.localStore,e),i=e)})))),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}))}function Ul(e,t){return r(this,void 0,void 0,(function*(){e.asyncQueue.verifyOperationInProgress();const n=yield ql(e);m(Fl,"Initializing OnlineComponentProvider"),yield t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>wu(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>wu(t.remoteStore,n))),e._onlineComponents=t}))}function ql(e){return r(this,void 0,void 0,(function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){m(Fl,"Using user provided OfflineComponentProvider");try{yield Bl(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===T.FAILED_PRECONDITION||e.code===T.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;v("Error using user provided cache. Falling back to memory cache: "+n),yield Bl(e,new xl)}}else m(Fl,"Using default OfflineComponentProvider"),yield Bl(e,new Al(void 0));return e._offlineComponents}))}function jl(e){return r(this,void 0,void 0,(function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(m(Fl,"Using user provided OnlineComponentProvider"),yield Ul(e,e._uninitializedComponentsProvider._online)):(m(Fl,"Using default OnlineComponentProvider"),yield Ul(e,new kl))),e._onlineComponents}))}function zl(e){return ql(e).then((e=>e.persistence))}function $l(e){return ql(e).then((e=>e.localStore))}function Gl(e){return jl(e).then((e=>e.remoteStore))}function Kl(e){return jl(e).then((e=>e.syncEngine))}function Ql(e){return jl(e).then((e=>e.datastore))}function Hl(e){return r(this,void 0,void 0,(function*(){const t=yield jl(e),n=t.eventManager;return n.onListen=Ju.bind(null,t.syncEngine),n.onUnlisten=el.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Yu.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=tl.bind(null,t.syncEngine),n}))}function Wl(e,t,n={}){const i=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t,n,r,i){const s=new Ml({next:a=>{s.yu(),t.enqueueAndForget((()=>Ou(e,o)));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new S(T.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new S(T.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new Vu(Or(n.path),s,{includeMetadataChanges:!0,Fa:!0});return ku(e,o)}(yield Hl(e),e.asyncQueue,t,n,i)})))),i.promise}function Jl(e,t,n={}){const i=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t,n,r,i){const s=new Ml({next:n=>{s.yu(),t.enqueueAndForget((()=>Ou(e,o))),n.fromCache&&"server"===r.source?i.reject(new S(T.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Vu(n,s,{includeMetadataChanges:!0,Fa:!0});return ku(e,o)}(yield Hl(e),e.asyncQueue,t,n,i)})))),i.promise}function Yl(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Xl=new Map;function Zl(e,t,n){if(!n)throw new S(T.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function eh(e,t,n,r){if(!0===t&&!0===r)throw new S(T.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function th(e){if(!Z.isDocumentKey(e))throw new S(T.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function nh(e){if(Z.isDocumentKey(e))throw new S(T.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function rh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":b(12329,{type:typeof e})}function ih(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new S(T.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=rh(e);throw new S(T.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function sh(e,t){if(t<=0)throw new S(T.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const oh="firestore.googleapis.com",ah=!0;class ch{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new S(T.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oh,this.ssl=ah}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:ah;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=zo;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<ia)throw new S(T.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}eh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Yl(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new S(T.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new S(T.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new S(T.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class uh{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ch({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new S(T.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new S(T.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ch(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new A;switch(e.type){case"firstParty":return new O(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new S(T.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return r(this,void 0,void 0,(function*(){"notTerminated"===this._terminateTask?yield this._terminate():this._terminateTask="notTerminated"}))}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Xl.get(e);t&&(m("ComponentProvider","Removing Datastore"),Xl.delete(e),t.terminate())}(this),Promise.resolve()}}function lh(e,t,n,r={}){var i;const s=(e=ih(e,uh))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:e._getEmulatorOptions()}),c=`${t}:${n}`;s.host!==oh&&s.host!==c&&v("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},s),{host:c,ssl:!1,emulatorOptions:r});if(!a.deepEqual(u,o)&&(e._setSettings(u),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=d.MOCK_USER;else{t=a.createMockUserToken(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new S(T.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new d(s)}e._authCredentials=new D(new x(t,n))}}class hh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hh(this.firestore,e,this._query)}}class dh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new dh(this.firestore,e,this._key)}}class fh extends hh{constructor(e,t,n){super(e,t,Or(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new dh(this.firestore,null,new Z(e))}withConverter(e){return new fh(this.firestore,e,this._path)}}function ph(e,t,...n){if(e=a.getModularInstance(e),1===arguments.length&&(t=F.newId()),Zl("doc","path",t),e instanceof uh){const r=J.fromString(t,...n);return th(r),new dh(e,null,new Z(r))}{if(!(e instanceof dh||e instanceof fh))throw new S(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(J.fromString(t,...n));return th(r),new dh(e.firestore,e instanceof fh?e.converter:null,new Z(r))}}function gh(e,t){return e=a.getModularInstance(e),t=a.getModularInstance(t),e instanceof hh&&t instanceof hh&&e.firestore===t.firestore&&qr(e._query,t._query)&&e.converter===t.converter}const mh="AsyncQueue";class yh{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new Vc(this,"async_queue_retry"),this.ju=()=>{const e=Pc();e&&m(mh,"Visibility state changed to "+e.visibilityState),this.y_.A_()},this.Hu=e;const t=Pc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;const t=Pc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise((()=>{}));const t=new C;return this.Yu((()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qu.push(e),this.Zu())))}Zu(){return r(this,void 0,void 0,(function*(){if(0!==this.Qu.length){try{yield this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!Ie(e))throw e;m(mh,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_((()=>this.Zu()))}}))}Yu(e){const t=this.Hu.then((()=>(this.Wu=!0,e().catch((e=>{throw this.Ku=e,this.Wu=!1,y("INTERNAL UNHANDLED ERROR: ",vh(e)),e})).then((e=>(this.Wu=!1,e))))));return this.Hu=t,t}enqueueAfterDelay(e,t,n){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);const r=Eu.createAndSchedule(this,e,t,n,(e=>this.Xu(e)));return this.Uu.push(r),r}Ju(){this.Ku&&b(47125,{ec:vh(this.Ku)})}verifyOperationInProgress(){}tc(){return r(this,void 0,void 0,(function*(){let e;do{e=this.Hu,yield e}while(e!==this.Hu)}))}nc(e){for(const t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then((()=>{this.Uu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Uu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.tc()}))}sc(e){this.zu.push(e)}Xu(e){const t=this.Uu.indexOf(e);this.Uu.splice(t,1)}}function vh(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function wh(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(e)}class bh{constructor(){this._progressObserver={},this._taskCompletionResolver=new C,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class _h extends uh{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new yh,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return r(this,void 0,void 0,(function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yh(e),this._firestoreClient=void 0,yield e}}))}}function Ih(e){if(e._terminated)throw new S(T.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Eh(e),e._firestoreClient}function Eh(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new yn(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Yl(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Vl(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function Th(e,t,n){if((e=ih(e,_h))._firestoreClient||e._terminated)throw new S(T.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new S(T.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},Eh(e)}class Sh{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class Ch{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class xh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xh(sn.fromBase64String(e))}catch(e){throw new S(T.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new xh(sn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ah{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new S(T.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new X(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Dh{constructor(e){this._methodName=e}}class Nh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new S(T.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new S(T.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return V(this._lat,e._lat)||V(this._long,e._long)}}class kh{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Oh=/^__.*__$/;class Mh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ri(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mi(e,this.data,t,this.fieldTransforms)}}class Rh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ri(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Lh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw b(40011,{oc:e})}}class Ph{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this._c(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new Ph(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ac({path:n,cc:!1});return r.lc(e),r}hc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ac({path:n,cc:!1});return r._c(),r}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return nd(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(0===e.length)throw this.Tc("Document fields must not be empty");if(Lh(this.oc)&&Oh.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class Fh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Fc(e)}dc(e,t,n,r=!1){return new Ph({oc:e,methodName:t,Ec:n,path:X.emptyPath(),cc:!1,Ic:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Vh(e){const t=e._freezeSettings(),n=Fc(e._databaseId);return new Fh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Bh(e,t,n,r,i,s={}){const o=e.dc(s.merge||s.mergeFields?2:0,t,n,i);Xh("Data must be an object, but it was:",o,r);const a=Jh(r,o);let c,u;if(s.merge)c=new nn(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Zh(t,r,n);if(!o.contains(i))throw new S(T.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);rd(e,i)||e.push(i)}c=new nn(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Mh(new Wn(a),c,u)}class Uh extends Dh{_toFieldTransform(e){if(2!==e.oc)throw 1===e.oc?e.Tc(`${this._methodName}() can only appear at the top level of your update data`):e.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Uh}}function qh(e,t,n){return new Ph({oc:3,Ec:t.settings.Ec,methodName:e._methodName,cc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class jh extends Dh{_toFieldTransform(e){return new Ei(e.path,new gi)}isEqual(e){return e instanceof jh}}class zh extends Dh{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){const t=qh(this,e,!0),n=this.Ac.map((e=>Wh(e,t))),r=new mi(n);return new Ei(e.path,r)}isEqual(e){return e instanceof zh&&a.deepEqual(this.Ac,e.Ac)}}class $h extends Dh{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){const t=qh(this,e,!0),n=this.Ac.map((e=>Wh(e,t))),r=new vi(n);return new Ei(e.path,r)}isEqual(e){return e instanceof $h&&a.deepEqual(this.Ac,e.Ac)}}class Gh extends Dh{constructor(e,t){super(e),this.Rc=t}_toFieldTransform(e){const t=new bi(e.serializer,li(e.serializer,this.Rc));return new Ei(e.path,t)}isEqual(e){return e instanceof Gh&&this.Rc===e.Rc}}function Kh(e,t,n,r){const i=e.dc(1,t,n);Xh("Data must be an object, but it was:",i,r);const s=[],o=Wn.empty();Qt(r,((e,r)=>{const c=td(t,e,n);r=a.getModularInstance(r);const u=i.hc(c);if(r instanceof Uh)s.push(c);else{const e=Wh(r,u);null!=e&&(s.push(c),o.set(c,e))}}));const c=new nn(s);return new Rh(o,c,i.fieldTransforms)}function Qh(e,t,n,r,i,s){const o=e.dc(1,t,n),c=[Zh(t,r,n)],u=[i];if(s.length%2!=0)throw new S(T.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)c.push(Zh(t,s[e])),u.push(s[e+1]);const l=[],h=Wn.empty();for(let e=c.length-1;e>=0;--e)if(!rd(l,c[e])){const t=c[e];let n=u[e];n=a.getModularInstance(n);const r=o.hc(t);if(n instanceof Uh)l.push(t);else{const e=Wh(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new nn(l);return new Rh(h,d,o.fieldTransforms)}function Hh(e,t,n,r=!1){return Wh(n,e.dc(r?4:3,t))}function Wh(e,t){if(Yh(e=a.getModularInstance(e)))return Xh("Unsupported field value:",t,e),Jh(e,t);if(e instanceof Dh)return function(e,t){if(!Lh(t.oc))throw t.Tc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Tc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.cc&&4!==t.oc)throw t.Tc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Wh(i,t.Pc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=a.getModularInstance(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return li(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=K.fromDate(e);return{timestampValue:gs(t.serializer,n)}}if(e instanceof K){const n=new K(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:gs(t.serializer,n)}}if(e instanceof Nh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof xh)return{bytesValue:ms(t.serializer,e._byteString)};if(e instanceof dh){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Tc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ws(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof kh)return function(e,t){return{mapValue:{fields:{[bn]:{stringValue:En},[Tn]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Tc("VectorValues must only contain numeric values.");return ci(t.serializer,e)}))}}}}}}(e,t);throw t.Tc(`Unsupported field value: ${rh(e)}`)}(e,t)}function Jh(e,t){const n={};return Wt(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Qt(e,((e,r)=>{const i=Wh(r,t.uc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Yh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof K||e instanceof Nh||e instanceof xh||e instanceof dh||e instanceof Dh||e instanceof kh)}function Xh(e,t,n){if(!Yh(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=rh(n);throw"an object"===r?t.Tc(e+" a custom object"):t.Tc(e+" "+r)}}function Zh(e,t,n){if((t=a.getModularInstance(t))instanceof Ah)return t._internalPath;if("string"==typeof t)return td(e,t);throw nd("Field path arguments must be of type string or ",e,!1,void 0,n)}const ed=new RegExp("[~\\*/\\[\\]]");function td(e,t,n){if(t.search(ed)>=0)throw nd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ah(...t.split("."))._internalPath}catch(r){throw nd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function nd(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new S(T.INVALID_ARGUMENT,a+e+c)}function rd(e,t){return e.some((e=>e.isEqual(t)))}class id{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new dh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new sd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(od("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class sd extends id{data(){return super.data()}}function od(e,t){return"string"==typeof t?td(e,t):t instanceof Ah?t._internalPath:t._delegate._internalPath}function ad(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new S(T.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cd{}class ud extends cd{}class ld extends ud{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ld(e,t,n)}_apply(e){const t=this._parse(e);return wd(e._query,t),new hh(e.firestore,e.converter,Br(e._query,t))}_parse(e){const t=Vh(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new S(T.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){vd(o,s);const t=[];for(const n of o)t.push(yd(r,e,n));a={arrayValue:{values:t}}}else a=yd(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||vd(o,s),a=Hh(n,"where",o,"in"===s||"not-in"===s);return ir.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class hd extends cd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hd(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:sr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)wd(n,e),n=Br(n,e)}(e._query,t),new hh(e.firestore,e.converter,Br(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class dd extends ud{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new dd(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new S(T.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new S(T.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new tr(t,n)}(e._query,this._field,this._direction);return new hh(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Nr(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class fd extends ud{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new fd(e,t,n)}_apply(e){return new hh(e.firestore,e.converter,Ur(e._query,this._limit,this._limitType))}}class pd extends ud{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new pd(e,t,n)}_apply(e){const t=md(e,this.type,this._docOrFields,this._inclusive);return new hh(e.firestore,e.converter,function(e,t){return new Nr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class gd extends ud{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new gd(e,t,n)}_apply(e){const t=md(e,this.type,this._docOrFields,this._inclusive);return new hh(e.firestore,e.converter,function(e,t){return new Nr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function md(e,t,n,r){if(n[0]=a.getModularInstance(n[0]),n[0]instanceof id)return function(e,t,n,r,i){if(!r)throw new S(T.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Lr(e))if(n.field.isKeyField())s.push(Ln(t,r.key));else{const e=r.data.field(n.field);if(pn(e))throw new S(T.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new S(T.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Xn(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Vh(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new S(T.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new S(T.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Rr(e)&&-1!==c.indexOf("/"))throw new S(T.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(J.fromString(c));if(!Z.isDocumentKey(n))throw new S(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Z(n);a.push(Ln(t,i))}else{const e=Hh(n,r,c);a.push(e)}}return new Xn(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function yd(e,t,n){if("string"==typeof(n=a.getModularInstance(n))){if(""===n)throw new S(T.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Rr(t)&&-1!==n.indexOf("/"))throw new S(T.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(J.fromString(n));if(!Z.isDocumentKey(r))throw new S(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ln(e,new Z(r))}if(n instanceof dh)return Ln(e,n._key);throw new S(T.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rh(n)}.`)}function vd(e,t){if(!Array.isArray(e)||0===e.length)throw new S(T.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function wd(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new S(T.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new S(T.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function bd(e,t){if(!(t instanceof ld||t instanceof hd))throw new S(T.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class _d{convertValue(e,t="none"){switch(Cn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(un(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw b(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Qt(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Tn].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>cn(e.doubleValue)));return new kh(i)}convertGeoPoint(e){return new Nh(cn(e.latitude),cn(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=gn(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mn(e));default:return null}}convertTimestamp(e){const t=an(e);return new K(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=J.fromString(e);I($s(n),9688,{name:e});const r=new wn(n.get(1),n.get(3)),i=new Z(n.popFirst(5));return r.isEqual(t)||y(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Id(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Ed extends _d{constructor(e){super(),this.firestore=e}convertBytes(e){return new xh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new dh(this.firestore,null,t)}}function Td(){return new Sh("count")}class Sd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Cd extends id{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new xd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(od("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class xd extends Cd{data(e={}){return super.data(e)}}class Ad{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Sd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new xd(this._firestore,this._userDataWriter,n.key,n,new Sd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new S(T.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new xd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Sd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new xd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Sd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Dd(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Dd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return b(61501,{type:e})}}class Nd extends _d{constructor(e){super(),this.firestore=e}convertBytes(e){return new xh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new dh(this.firestore,null,t)}}function kd(e,t){return function(e,t){const n=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t,n){return r(this,void 0,void 0,(function*(){const r=Cl(e);try{const e=yield function(e,t){const n=E(e),r=K.now(),i=t.reduce(((e,t)=>e.add(t.key)),si());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Jr(),c=si();return n.Cs.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=ki(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Ri(e.key,t,Jn(t.value.mapValue),Si.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Zr(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.uu[e.currentUser.toKey()];r||(r=new Jt(V)),r=r.insert(t,n),e.uu[e.currentUser.toKey()]=r}(r,e.batchId,n),yield pl(r,e.changes),yield lu(r.remoteStore)}catch(e){const t=Tu(e,"Failed to persist write");n.reject(t)}}))}(yield Kl(e),t,n)})))),n.promise}(Ih(e),t)}function Od(e,t,n){const r=n.docs.get(t._key),i=new Nd(e);return new Cd(e,i,t._key,r,new Sd(n.hasPendingWrites,n.fromCache),t.converter)}function Md(e,t){const n=ih(e.firestore,_h),i=Ih(n),s=Ht(t,((e,t)=>new zi(t,e.aggregateType,e._internalFieldPath)));return function(e,t,n){const i=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){try{const s=yield Ql(e);i.resolve(function(e,t,n){return r(this,void 0,void 0,(function*(){var r;const i=E(e),{request:s,yt:o,parent:a}=Rs(i.serializer,Fr(t),n);i.connection.Bo||delete s.parent;const c=(yield i.Wo("RunAggregationQuery",i.serializer.databaseId,a,s,1)).filter((e=>!!e.result));I(1===c.length,64727);const u=null===(r=c[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(u).reduce(((e,t)=>(e[o[t]]=u[t],e)),{})}))}(s,t,n))}catch(e){i.reject(e)}})))),i.promise}(i,e._query,s).then((t=>function(e,t,n){const r=new Nd(e);return new Ch(t,r,n)}(n,e,t)))}class Rd{constructor(e){this.kind="memory",this._onlineComponentProvider=kl.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new Al(void 0)}}toJSON(){return{kind:this.kind}}}class Ld{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=Ud(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class Pd{constructor(){this.kind="memoryEager",this._offlineComponentProvider=xl.provider}toJSON(){return{kind:this.kind}}}class Fd{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Al(e)}}toJSON(){return{kind:this.kind}}}class Vd{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=kl.provider,this._offlineComponentProvider={build:t=>new Dl(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class Bd{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=kl.provider,this._offlineComponentProvider={build:t=>new Nl(t,null==e?void 0:e.cacheSizeBytes)}}}function Ud(e){return new Vd(null==e?void 0:e.forceOwnership)}const qd={maxAttempts:5};class jd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Vh(e)}set(e,t,n){this._verifyNotCommitted();const r=zd(e,this._firestore),i=Id(r.converter,t,n),s=Bh(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Si.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=zd(e,this._firestore);let s;return s="string"==typeof(t=a.getModularInstance(t))||t instanceof Ah?Qh(this._dataReader,"WriteBatch.update",i._key,t,n,r):Kh(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Si.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zd(e,this._firestore);return this._mutations=this._mutations.concat(new Vi(t._key,Si.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new S(T.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zd(e,t){if((e=a.getModularInstance(e)).firestore!==t)throw new S(T.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class $d{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Vh(e)}get(e){const t=zd(e,this._firestore),n=new Ed(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return b(24041);const r=e[0];if(r.isFoundDocument())return new id(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new id(this._firestore,n,t._key,null,t.converter);throw b(18433,{doc:r})}))}set(e,t,n){const r=zd(e,this._firestore),i=Id(r.converter,t,n),s=Bh(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=zd(e,this._firestore);let s;return s="string"==typeof(t=a.getModularInstance(t))||t instanceof Ah?Qh(this._dataReader,"Transaction.update",i._key,t,n,r):Kh(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=zd(e,this._firestore);return this._transaction.delete(t._key),this}}class Gd extends $d{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=zd(e,this._firestore),n=new Nd(this._firestore);return super.get(e).then((e=>new Cd(this._firestore,n,t._key,e._document,new Sd(!1,!1),t.converter)))}}function Kd(e,t){if("string"!=typeof e[t])throw new S(T.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class Qd{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Hd(e,t){(function(e,t){return e.asyncQueue.enqueue((()=>r(this,void 0,void 0,(function*(){return function(e,t){E(e).bs.Is=t}(yield $l(e),t)}))))})(Ih(e._firestore),t).then((e=>m(`setting persistent cache index auto creation isEnabled=${t} succeeded`))).catch((e=>v(`setting persistent cache index auto creation isEnabled=${t} failed`,e)))}const Wd=new WeakMap;class Jd{constructor(){this.Vc=new Map}static get instance(){return Yd||(Yd=new Jd,function(e){if(Wi)throw new Error("a TestingHooksSpi instance is already set");Wi=e}(Yd)),Yd}ht(e){this.Vc.forEach((t=>t(e)))}onExistenceFilterMismatch(e){const t=Symbol(),n=this.Vc;return n.set(t,e),()=>n.delete(t)}}let Yd=null;!function(e,t=!0){!function(e){f=e}(i.SDK_VERSION),i._registerComponent(new s.Component("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new _h(new N(e.getProvider("auth-internal")),new R(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new S(T.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wn(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),i.registerVersion(l,h,e),i.registerVersion(l,h,"cjs2017")}(),t.AbstractUserDataWriter=_d,t.AggregateField=Sh,t.AggregateQuerySnapshot=Ch,t.Bytes=xh,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=fh,t.DocumentReference=dh,t.DocumentSnapshot=Cd,t.FieldPath=Ah,t.FieldValue=Dh,t.Firestore=_h,t.FirestoreError=S,t.GeoPoint=Nh,t.LoadBundleTask=bh,t.PersistentCacheIndexManager=Qd,t.Query=hh,t.QueryCompositeFilterConstraint=hd,t.QueryConstraint=ud,t.QueryDocumentSnapshot=xd,t.QueryEndAtConstraint=gd,t.QueryFieldFilterConstraint=ld,t.QueryLimitConstraint=fd,t.QueryOrderByConstraint=dd,t.QuerySnapshot=Ad,t.QueryStartAtConstraint=pd,t.SnapshotMetadata=Sd,t.Timestamp=K,t.Transaction=Gd,t.VectorValue=kh,t.WriteBatch=jd,t._AutoId=F,t._ByteString=sn,t._DatabaseId=wn,t._DocumentKey=Z,t._EmptyAppCheckTokenProvider=class{getToken(){return Promise.resolve(new M(""))}invalidateToken(){}start(e,t){}shutdown(){}},t._EmptyAuthCredentialsProvider=A,t._FieldPath=X,t._TestingHooks=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Jd.instance.onExistenceFilterMismatch(e)}},t._cast=ih,t._debugAssert=function(e,t){e||b(57014,t)},t._internalAggregationQueryToProtoRunAggregationQueryRequest=function(e,t){var n;const r=Ht(t,((e,t)=>new zi(t,e.aggregateType,e._internalFieldPath))),i=null===(n=Ih(ih(e.firestore,_h))._onlineComponents)||void 0===n?void 0:n.datastore.serializer;return void 0===i?null:Rs(i,Fr(e._query),r,!0).request},t._internalQueryToProtoQueryTarget=function(e){var t;const n=null===(t=Ih(ih(e.firestore,_h))._onlineComponents)||void 0===t?void 0:t.datastore.serializer;return void 0===n?null:Ms(n,Pr(e._query)).gt},t._isBase64Available=function(){return"undefined"!=typeof atob},t._logWarn=v,t._validateIsNotUsedTogether=eh,t.addDoc=function(e,t){const n=ih(e.firestore,_h),r=ph(e),i=Id(e.converter,t);return kd(n,[Bh(Vh(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Si.exists(!1))]).then((()=>r))},t.aggregateFieldEqual=function(e,t){var n,r;return e instanceof Sh&&t instanceof Sh&&e.aggregateType===t.aggregateType&&(null===(n=e._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=t._internalFieldPath)||void 0===r?void 0:r.canonicalString())},t.aggregateQuerySnapshotEqual=function(e,t){return gh(e.query,t.query)&&a.deepEqual(e.data(),t.data())},t.and=function(...e){return e.forEach((e=>bd("and",e))),hd._create("and",e)},t.arrayRemove=function(...e){return new $h("arrayRemove",e)},t.arrayUnion=function(...e){return new zh("arrayUnion",e)},t.average=function(e){return new Sh("avg",Zh("average",e))},t.clearIndexedDbPersistence=function(e){if(e._initialized&&!e._terminated)throw new S(T.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new C;return e._queue.enqueueAndForgetEvenWhileRestricted((()=>r(this,void 0,void 0,(function*(){try{yield function(e){return r(this,void 0,void 0,(function*(){if(!ve.C())return Promise.resolve();const t=e+ja;yield ve.delete(t)}))}(Ka(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})))),t.promise},t.collection=function(e,t,...n){if(e=a.getModularInstance(e),Zl("collection","path",t),e instanceof uh){const r=J.fromString(t,...n);return nh(r),new fh(e,null,r)}{if(!(e instanceof dh||e instanceof fh))throw new S(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(J.fromString(t,...n));return nh(r),new fh(e.firestore,null,r)}},t.collectionGroup=function(e,t){if(e=ih(e,uh),Zl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new S(T.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hh(e,null,function(e){return new Nr(J.emptyPath(),e)}(t))},t.connectFirestoreEmulator=lh,t.count=Td,t.deleteAllPersistentCacheIndexes=function(e){(function(e){return e.asyncQueue.enqueue((()=>r(this,void 0,void 0,(function*(){return function(e){const t=E(e),n=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",(e=>n.deleteAllFieldIndexes(e)))}(yield $l(e))}))))})(Ih(e._firestore)).then((e=>m("deleting all persistent cache indexes succeeded"))).catch((e=>v("deleting all persistent cache indexes failed",e)))},t.deleteDoc=function(e){return kd(ih(e.firestore,_h),[new Vi(e._key,Si.none())])},t.deleteField=function(){return new Uh("deleteField")},t.disableNetwork=function(e){return function(e){return e.asyncQueue.enqueue((()=>r(this,void 0,void 0,(function*(){const t=yield zl(e),n=yield Gl(e);return t.setNetworkEnabled(!1),function(e){return r(this,void 0,void 0,(function*(){const t=E(e);t.aa.add(0),yield Wc(t),t.la.set("Offline")}))}(n)}))))}(Ih(e=ih(e,_h)))},t.disablePersistentCacheIndexAutoCreation=function(e){Hd(e,!1)},t.doc=ph,t.documentId=function(){return new Ah(H)},t.enableIndexedDbPersistence=function(e,t){v("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return Th(e,kl.provider,{build:e=>new Dl(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()},t.enableMultiTabIndexedDbPersistence=function(e){return r(this,void 0,void 0,(function*(){v("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();Th(e,kl.provider,{build:e=>new Nl(e,t.cacheSizeBytes)})}))},t.enableNetwork=function(e){return function(e){return e.asyncQueue.enqueue((()=>r(this,void 0,void 0,(function*(){const t=yield zl(e),n=yield Gl(e);return t.setNetworkEnabled(!0),function(e){const t=E(e);return t.aa.delete(0),Hc(t)}(n)}))))}(Ih(e=ih(e,_h)))},t.enablePersistentCacheIndexAutoCreation=function(e){Hd(e,!0)},t.endAt=function(...e){return gd._create("endAt",e,!0)},t.endBefore=function(...e){return gd._create("endBefore",e,!1)},t.ensureFirestoreConfigured=Ih,t.executeWrite=kd,t.getAggregateFromServer=Md,t.getCountFromServer=function(e){return Md(e,{count:Td()})},t.getDoc=function(e){e=ih(e,dh);const t=ih(e.firestore,_h);return Wl(Ih(t),e._key).then((n=>Od(t,e,n)))},t.getDocFromCache=function(e){e=ih(e,dh);const t=ih(e.firestore,_h),n=Ih(t),i=new Nd(t);return function(e,t){const n=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t,n){return r(this,void 0,void 0,(function*(){try{const r=yield function(e,t){const n=E(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new S(T.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Tu(e,`Failed to get document '${t} from cache`);n.reject(r)}}))}(yield $l(e),t,n)})))),n.promise}(n,e._key).then((n=>new Cd(t,i,e._key,n,new Sd(null!==n&&n.hasLocalMutations,!0),e.converter)))},t.getDocFromServer=function(e){e=ih(e,dh);const t=ih(e.firestore,_h);return Wl(Ih(t),e._key,{source:"server"}).then((n=>Od(t,e,n)))},t.getDocs=function(e){e=ih(e,hh);const t=ih(e.firestore,_h),n=Ih(t),r=new Nd(t);return ad(e._query),Jl(n,e._query).then((n=>new Ad(t,r,e,n)))},t.getDocsFromCache=function(e){e=ih(e,hh);const t=ih(e.firestore,_h),n=Ih(t),i=new Nd(t);return function(e,t){const n=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t,n){return r(this,void 0,void 0,(function*(){try{const r=yield sc(e,t,!0),i=new Gu(t,r.Ns),s=i.Ga(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Tu(e,`Failed to execute query '${t} against cache`);n.reject(r)}}))}(yield $l(e),t,n)})))),n.promise}(n,e._query).then((n=>new Ad(t,i,e,n)))},t.getDocsFromServer=function(e){e=ih(e,hh);const t=ih(e.firestore,_h),n=Ih(t),r=new Nd(t);return Jl(n,e._query,{source:"server"}).then((n=>new Ad(t,r,e,n)))},t.getFirestore=function(e,t){const n="object"==typeof e?e:i.getApp(),r="string"==typeof e?e:t||vn,s=i._getProvider(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=a.getDefaultEmulatorHostnameAndPort("firestore");e&&lh(s,...e)}return s},t.getPersistentCacheIndexManager=function(e){var t;e=ih(e,_h);const n=Wd.get(e);if(n)return n;if("persistent"!==(null===(t=Ih(e)._uninitializedComponentsProvider)||void 0===t?void 0:t._offline.kind))return null;const r=new Qd(e);return Wd.set(e,r),r},t.increment=function(e){return new Gh("increment",e)},t.initializeFirestore=function(e,t,n){n||(n=vn);const r=i._getProvider(e,"firestore");if(r.isInitialized(n)){const e=r.getImmediate({identifier:n}),i=r.getOptions(n);if(a.deepEqual(i,t))return e;throw new S(T.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new S(T.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<ia)throw new S(T.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})},t.limit=function(e){return sh("limit",e),fd._create("limit",e,"F")},t.limitToLast=function(e){return sh("limitToLast",e),fd._create("limitToLast",e,"L")},t.loadBundle=function(e,t){const n=Ih(e=ih(e,_h)),i=new bh;return function(e,t,n,i){const s=function(e,t){let n;return n="string"==typeof e?P().encode(e):e,function(e,t){return new Rl(e,t)}(function(e,t){if(e instanceof Uint8Array)return Ol(e,t);if(e instanceof ArrayBuffer)return Ol(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Fc(t));e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){!function(e,t,n){const i=E(e);(function(e,t,n){return r(this,void 0,void 0,(function*(){try{const r=yield t.getMetadata();if(yield function(e,t){const n=E(e),r=vs(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.ci.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return yield t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(ju(r));const i=new qu(r,e.localStore,t.serializer);let s=yield t.du();for(;s;){const e=yield i.Na(s);e&&n._updateProgress(e),s=yield t.du()}const o=yield i.complete();return yield pl(e,o.ka,void 0),yield function(e,t){const n=E(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.ci.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.La)}catch(e){return v(Ku,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}}))})(i,t,n).then((e=>{i.sharedClientState.notifyBundleLoaded(e)}))}(yield Kl(e),s,i)}))))}(n,e._databaseId,t,i),i},t.memoryEagerGarbageCollector=function(){return new Pd},t.memoryLocalCache=function(e){return new Rd(e)},t.memoryLruGarbageCollector=function(e){return new Fd(null==e?void 0:e.cacheSizeBytes)},t.namedQuery=function(e,t){return function(e,t){return e.asyncQueue.enqueue((()=>r(this,void 0,void 0,(function*(){return function(e,t){const n=E(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.ci.getNamedQuery(e,t)))}(yield $l(e),t)}))))}(Ih(e=ih(e,_h)),t).then((t=>t?new hh(e,null,t.query):null))},t.onSnapshot=function(e,...t){var n,i,s;e=a.getModularInstance(e);let o={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof t[c]||wh(t[c])||(o=t[c],c++);const u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(wh(t[c])){const e=t[c];t[c]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[c+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),t[c+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let l,h,d;if(e instanceof dh)h=ih(e.firestore,_h),d=Or(e._key.path),l={next:n=>{t[c]&&t[c](Od(h,e,n))},error:t[c+1],complete:t[c+2]};else{const n=ih(e,hh);h=ih(n.firestore,_h),d=n._query;const r=new Nd(h);l={next:e=>{t[c]&&t[c](new Ad(h,r,n,e))},error:t[c+1],complete:t[c+2]},ad(e._query)}return function(e,t,n,i){const s=new Ml(i),o=new Vu(t,s,n);return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return ku(yield Hl(e),o)})))),()=>{s.yu(),e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return Ou(yield Hl(e),o)}))))}}(Ih(h),d,u,l)},t.onSnapshotsInSync=function(e,t){return function(e,t){const n=new Ml(t);return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t){E(e).fa.add(t),t.next()}(yield Hl(e),n)})))),()=>{n.yu(),e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t){E(e).fa.delete(t)}(yield Hl(e),n)}))))}}(Ih(e=ih(e,_h)),wh(t)?t:{next:t})},t.or=function(...e){return e.forEach((e=>bd("or",e))),hd._create("or",e)},t.orderBy=function(e,t="asc"){const n=t,r=od("orderBy",e);return dd._create(r,n)},t.persistentLocalCache=function(e){return new Ld(e)},t.persistentMultipleTabManager=function(){return new Bd},t.persistentSingleTabManager=Ud,t.query=function(e,t,...n){let r=[];t instanceof cd&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof hd)).length,n=e.filter((e=>e instanceof ld)).length;if(t>1||t>0&&n>0)throw new S(T.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e},t.queryEqual=gh,t.refEqual=function(e,t){return e=a.getModularInstance(e),t=a.getModularInstance(t),(e instanceof dh||e instanceof fh)&&(t instanceof dh||t instanceof fh)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter},t.runTransaction=function(e,t,n){e=ih(e,_h);const i=Object.assign(Object.assign({},qd),n);return function(e){if(e.maxAttempts<1)throw new S(T.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(e,t,n){const i=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){const r=yield Ql(e);new Pl(e.asyncQueue,r,n,t,i).Nu()})))),i.promise}(Ih(e),(n=>t(new Gd(e,n))),i)},t.serverTimestamp=function(){return new jh("serverTimestamp")},t.setDoc=function(e,t,n){e=ih(e,dh);const r=ih(e.firestore,_h),i=Id(e.converter,t,n);return kd(r,[Bh(Vh(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Si.none())])},t.setIndexConfiguration=function(e,t){const n=Ih(e=ih(e,_h));if(!n._uninitializedComponentsProvider||"memory"===n._uninitializedComponentsProvider._offline.kind)return v("Cannot enable indexes when persistence is disabled"),Promise.resolve();const i=function(e){const t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new S(T.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,n=[];if(Array.isArray(t.indexes))for(const e of t.indexes){const t=Kd(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(const t of e.fields){const e=td("setIndexConfiguration",Kd(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new se(e,2)):"ASCENDING"===t.order?r.push(new se(e,0)):"DESCENDING"===t.order&&r.push(new se(e,1))}n.push(new te(te.UNKNOWN_ID,t,r,ae.empty()))}return n}(t);return function(e,t){return e.asyncQueue.enqueue((()=>r(this,void 0,void 0,(function*(){return function(e,t){return r(this,void 0,void 0,(function*(){const n=E(e),r=n.indexManager,i=[];return n.persistence.runTransaction("Configure indexes","readwrite",(e=>r.getFieldIndexes(e).next((n=>function(e,t,n,r,i){e=[...e],t=[...t],e.sort(n),t.sort(n);const s=e.length,o=t.length;let a=0,c=0;for(;a<o&&c<s;){const s=n(e[c],t[a]);s<0?i(e[c++]):s>0?r(t[a++]):(a++,c++)}for(;a<o;)r(t[a++]);for(;c<s;)i(e[c++])}(n,t,ie,(t=>{i.push(r.addFieldIndex(e,t))}),(t=>{i.push(r.deleteFieldIndex(e,t))})))).next((()=>ge.waitFor(i)))))}))}(yield $l(e),t)}))))}(n,i)},t.setLogLevel=function(e){p.setLogLevel(e)},t.snapshotEqual=function(e,t){return e instanceof Cd&&t instanceof Cd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Ad&&t instanceof Ad&&e._firestore===t._firestore&&gh(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)},t.startAfter=function(...e){return pd._create("startAfter",e,!1)},t.startAt=function(...e){return pd._create("startAt",e,!0)},t.sum=function(e){return new Sh("sum",Zh("sum",e))},t.terminate=function(e){return i._removeServiceInstance(e.app,"firestore",e._databaseId.database),e._delete()},t.updateDoc=function(e,t,n,...r){e=ih(e,dh);const i=ih(e.firestore,_h),s=Vh(i);let o;return o="string"==typeof(t=a.getModularInstance(t))||t instanceof Ah?Qh(s,"updateDoc",e._key,t,n,r):Kh(s,"updateDoc",e._key,t),kd(i,[o.toMutation(e._key,Si.exists(!0))])},t.vector=function(e){return new kh(e)},t.waitForPendingWrites=function(e){return function(e){const t=new C;return e.asyncQueue.enqueueAndForget((()=>r(this,void 0,void 0,(function*(){return function(e,t){return r(this,void 0,void 0,(function*(){const n=E(e);nu(n.remoteStore)||m(Ku,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=yield function(e){const t=E(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(e===ke)return void t.resolve();const r=n.cu.get(e)||[];r.push(t),n.cu.set(e,r)}catch(e){const n=Tu(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}))}(yield Kl(e),t)})))),t.promise}(Ih(e=ih(e,_h)))},t.where=function(e,t,n){const r=t,i=od("where",e);return ld._create(i,r,n)},t.writeBatch=function(e){return Ih(e=ih(e,_h)),new jd(e,(t=>kd(e,t)))}},814:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(249),o=i(n(926)),a=i(n(608)),c=n(929),u=n(449);class l extends s.Narve.Component{constructor(){super(),this.videoArea=new o.default,this.transitionArea=new a.default,this.children.set((0,s.nr)("main",{},this.videoArea,this.transitionArea)),this.transitionArea.skipTo=e=>{this.videoArea.skipTo(e)},setInterval((()=>{const e=this.videoArea.getCurrentSecond();void 0!==e&&this.transitionArea.focusSecond(e)}),1e3)}openWithId(e){return r(this,void 0,void 0,(function*(){const t=yield(0,c.getContents)(e);if(console.log(t),null!==t)try{const e=JSON.parse(t);(0,u.isUploadType)(e)&&(this.videoArea.changeVideoId(e.ytId),this.transitionArea.transition=e.transition,this.transitionArea.reloadTransition())}catch(e){}}))}}t.default=l},821:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(72),i=n.n(r),s=n(825),o=n.n(s),a=n(659),c=n.n(a),u=n(56),l=n.n(u),h=n(540),d=n.n(h),f=n(113),p=n.n(f),g=n(362),m={};m.styleTagTransform=p(),m.setAttributes=l(),m.insert=c().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=d(),i()(g.A,m);const y=g.A&&g.A.locals?g.A.locals:void 0},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},829:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(347),i=n.n(r),s=n(628),o=n.n(s)()(i());o.push([e.id,".transitionArea{\n    width: 20vw;\n    font-size: 1.2rem;\n    & > .transitionUl {\n        height: 25vh;\n        overflow: scroll;\n        & > li {\n            position: relative;\n            cursor: pointer;\n            border-radius: 10px;\n            & > div {\n                position: absolute;\n\n                width: 1.5em;\n                height: 1.5em;\n                background-color: orange;\n                text-align: center;\n                vertical-align: baseline;\n                border-radius: 3px;\n                box-sizing: border-box;\n\n                &.right{\n                    margin-left: 2em;\n                }\n            }\n            & > p {\n                margin: 0px;\n                margin-left:4em;\n            }\n            &.focus {\n                background-color: #62b349;\n            }\n        }\n    }\n    & > .commentArea {\n        padding: 1em;\n    }\n}\n@media screen and (max-width: 1024px) and (orientation: landscape) {\n    .transitionArea{\n        font-size: 0.8em;\n        width: 30vw;\n        & > .transitionUl {\n            height: 50vh;\n        }\n    }\n}",""]);const a=o},845:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=n(803);Object.keys(r).forEach((function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}))},859:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(249);n(788),n(821);const s=r(n(986)),o=r(n(814));class a extends i.Narve.Component{constructor(){if(super(),this.viewPage=new o.default,this.inputPage=new s.default,this.pages=(0,i.nr)("div",{class:"pages"},this.viewPage,this.inputPage),this.children.set(this.pages),this.pages.switchFocus((0,i.nr)()),"#view"===location.hash.slice(0,5)){const e=location.search.substring(1).split("&").reduce(((e,t)=>{const n=t.split("=")[0],r=t.split("=")[1];return e[n]=r,e}),{});if(void 0===e.v)return;this.viewPage.openWithId(e.v),this.pages.switchFocus(this.viewPage)}}}t.default=a},906:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=n(55);const i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new u;const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class u extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const l=function(e){const t=a(e);return c.encodeByteArray(t,!0)},h=function(e){return l(e).replace(/\./g,"")},d=function(e){try{return c.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function f(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=f(e[n],t[n]));return e}function p(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}const g=()=>{try{return r.getDefaultsFromPostinstall()||p().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},m=e=>{var t,n;return null===(n=null===(t=g())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]};class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function w(){var e;const t=null===(e=g())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function b(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}class _ extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,I.prototype.create)}}class I{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(E,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new _(r,o,n)}}const E=/\{\$([^}]+)}/g;function T(e){return JSON.parse(e)}const S=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=T(d(s[0])||""),n=T(d(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function C(e){return null!==e&&"object"==typeof e}class x{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=A),void 0===r.error&&(r.error=A),void 0===r.complete&&(r.complete=A);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function A(){}function D(e,t){return`${e} failed: ${t} argument `}const N=144e5;t.CONSTANTS=i,t.DecodeBase64StringError=u,t.Deferred=y,t.ErrorFactory=I,t.FirebaseError=_,t.MAX_VALUE_MILLIS=N,t.RANDOM_FACTOR=.5,t.Sha1=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],u=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):e<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const t=(s<<5|s>>>27)+r+u+i+n[e]&4294967295;u=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}},t.areCookiesEnabled=function(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)},t.assert=s,t.assertionError=o,t.async=function(e,t){return(...n)=>{Promise.resolve(!0).then((()=>{e(...n)})).catch((e=>{t&&t(e)}))}},t.base64=c,t.base64Decode=d,t.base64Encode=l,t.base64urlEncodeWithoutPadding=h,t.calculateBackoffMillis=function(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(N,r+i)},t.contains=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.createMockUserToken=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(s)),""].join(".")},t.createSubscribe=function(e,t){const n=new x(e,t);return n.subscribe.bind(n)},t.decode=S,t.deepCopy=function(e){return f(void 0,e)},t.deepEqual=function e(t,n){if(t===n)return!0;const r=Object.keys(t),i=Object.keys(n);for(const s of r){if(!i.includes(s))return!1;const r=t[s],o=n[s];if(C(r)&&C(o)){if(!e(r,o))return!1}else if(r!==o)return!1}for(const e of i)if(!r.includes(e))return!1;return!0},t.deepExtend=f,t.errorPrefix=D,t.extractQuerystring=function(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)},t.getDefaultAppConfig=()=>{var e;return null===(e=g())||void 0===e?void 0:e.config},t.getDefaultEmulatorHost=m,t.getDefaultEmulatorHostnameAndPort=e=>{const t=m(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},t.getDefaults=g,t.getExperimentalSetting=e=>{var t;return null===(t=g())||void 0===t?void 0:t[`_${e}`]},t.getGlobal=p,t.getModularInstance=function(e){return e&&e._delegate?e._delegate:e},t.getUA=v,t.isAdmin=function(e){const t=S(e).claims;return"object"==typeof t&&!0===t.admin},t.isBrowser=function(){return"undefined"!=typeof window||b()},t.isBrowserExtension=function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id},t.isCloudflareWorker=function(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent},t.isElectron=function(){return v().indexOf("Electron/")>=0},t.isEmpty=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},t.isIE=function(){const e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0},t.isIndexedDBAvailable=function(){try{return"object"==typeof indexedDB}catch(e){return!1}},t.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())},t.isNode=w,t.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},t.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},t.isSafari=function(){return!w()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")},t.isUWP=function(){return v().indexOf("MSAppHost/")>=0},t.isValidFormat=function(e){const t=S(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},t.isValidTimestamp=function(e){const t=S(e).claims,n=Math.floor((new Date).getTime()/1e3);let r=0,i=0;return"object"==typeof t&&(t.hasOwnProperty("nbf")?r=t.nbf:t.hasOwnProperty("iat")&&(r=t.iat),i=t.hasOwnProperty("exp")?t.exp:r+86400),!!n&&!!r&&!!i&&n>=r&&n<=i},t.isWebWorker=b,t.issuedAtTime=function(e){const t=S(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null},t.jsonEval=T,t.map=function(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r},t.ordinal=function(e){return Number.isFinite(e)?e+function(e){const t=(e=Math.abs(e))%100;if(t>=10&&t<=20)return"th";const n=e%10;return 1===n?"st":2===n?"nd":3===n?"rd":"th"}(e):`${e}`},t.promiseWithTimeout=function(e,t=2e3){const n=new y;return setTimeout((()=>n.reject("timeout!")),t),e.then(n.resolve,n.reject),n.promise},t.querystring=function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""},t.querystringDecode=function(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t},t.safeGet=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0},t.stringLength=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t},t.stringToByteArray=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,s(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},t.stringify=function(e){return JSON.stringify(e)},t.validateArgCount=function(e,t,n,r){let i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},t.validateCallback=function(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(D(e,t)+"must be a valid function.")},t.validateContextObject=function(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(D(e,t)+"must be a valid context object.")},t.validateIndexedDBOpenable=function(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))},t.validateNamespace=function(e,t,n){if((!n||t)&&"string"!=typeof t)throw new Error(D(e,"namespace")+"must be a valid firebase namespace.")}},926:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(249),i=n(195);n(254);class s extends r.Narve.Component{constructor(e){super(),this.player=null,this.playerElem=(0,r.nr)("div",{id:"player"}),this.children.set(this.playerElem),e&&this.changeVideoId(e)}changeVideoId(e){console.log("id",e),(0,i.createYouTubePlayer)("player",e,(()=>{})).then((e=>{this.player=e,console.log("YouTube Player Ready!")}))}skipTo(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}getCurrentSecond(){var e;return null===(e=this.player)||void 0===e?void 0:e.getCurrentTime()}onVideoReady(){null!==this.player&&this.player.playVideo()}}t.default=s},927:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(249),s=r(n(859));window.onload=()=>{i.Narve.q("body").children.set(new s.default)}},929:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createField=function(e){return r(this,void 0,void 0,(function*(){return(yield(0,s.addDoc)((0,s.collection)(a,"data"),{name:e,contents:""})).id}))},t.getName=function(e){return r(this,void 0,void 0,(function*(){var t;const n=(0,s.doc)(a,"data",e),r=yield(0,s.getDoc)(n);return r.exists()?null===(t=r.data())||void 0===t?void 0:t.name:null}))},t.getContents=function(e){return r(this,void 0,void 0,(function*(){var t;const n=(0,s.doc)(a,"data",e),r=yield(0,s.getDoc)(n);return r.exists()?null===(t=r.data())||void 0===t?void 0:t.contents:null}))},t.postContents=function(e,t){return r(this,void 0,void 0,(function*(){const n=(0,s.doc)(a,"data",e);yield(0,s.updateDoc)(n,{contents:t})}))},t.rename=function(e,t){return r(this,void 0,void 0,(function*(){const n=(0,s.doc)(a,"data",e);yield(0,s.updateDoc)(n,{name:t})}))};const i=n(467),s=n(845),o=(0,i.initializeApp)({apiKey:"AIzaSyAyS-1S2yDIDuuG5YHAC-1ALrKiVfUCbnE",authDomain:"trans-vi.firebaseapp.com",projectId:"trans-vi",storageBucket:"trans-vi.firebasestorage.app",messagingSenderId:"1011034615667",appId:"1:1011034615667:web:564bface61910dcedd9f06"}),a=(0,s.getFirestore)(o)},986:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(249),s=r(n(23)),o=n(929),a=r(n(24));class c extends i.Narve.Component{constructor(){super(),this.home=new s.default,this.edit=new a.default,this.pages=(0,i.nr)("div",{class:"pages"},this.home,this.edit),this.children.set(this.pages),this.pages.switchFocus(this.home);const e=location.search.substring(1).split("&").reduce(((e,t)=>{const n=t.split("=")[0],r=t.split("=")[1];return e[n]=r,e}),{});void 0!==e.id&&e.id,this.home.onCreate=e=>{(0,o.createField)(e)}}}t.default=c}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0,n(927)})();
